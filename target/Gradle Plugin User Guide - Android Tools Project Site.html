<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><!-- saved from url=(0062)http://tools.android.com/tech-docs/new-build-system/user-guide -->

<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage"><head><meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<script async="" src="./../source-others/analytics.js"></script>
<link rel="shortcut icon" type="image/x-icon" href="http://www.google.com/images/icons/product/sites-16.ico">
<link rel="apple-touch-icon" href="http://www.gstatic.com/sites/p/fa469b/system/app/images/apple-touch-icon.png" type="image/png">
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d=window,e="length",h="",k="__duration__",l="function";function m(c){return document.getElementById(c)}d.byId=m;function n(c){return c.replace(/^\s+|\s+$/g,h)}d.trim=n;var p=[],q=0;d.JOT_addListener=function(c,a,b){var f=new String(q++);c={eventName:c,handler:a,compId:b,key:f};p.push(c);return f};d.JOT_removeListenerByKey=function(c){for(var a=0;a<p[e];a++)if(p[a].key==c){p.splice(a,1);break}};d.JOT_removeAllListenersForName=function(c){for(var a=0;a<p[e];a++)p[a].eventName==c&&p.splice(a,1)};
d.JOT_postEvent=function(c,a,b){var f={eventName:c,eventSrc:a||{},payload:b||{}};if(d.JOT_fullyLoaded)for(a=p[e],b=0;b<a&&b<p[e];b++){var g=p[b];g&&g.eventName==c&&(f.listenerCompId=g.compId||h,(g=typeof g.handler==l?g.handler:d[g.handler])&&g(f))}else d.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};d.JOT_delayedEvents=[];d.JOT_fullyLoaded=!1;
d.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var f=0;60<=b&&(b/=60,f=2);2<=b&&f++;return a?d.JOT_siteRelTimeStrs[f].replace(k,Math.floor(b)):d.JOT_userRelTimeStrs[f].replace(k,Math.floor(b))}; })()
</script>
<script>


var webspace = {"scottyUrl":"/_/upload","isConsumer":false,"canPublishScriptToAnyone":true,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"sharingUrlPrefix":"/_/sharing","csiReportUri":"http://csi.gstatic.com/csi","sharingPolicy":"OPENED","siteNoticeUrlEnabled":null,"siteNoticeUrlAddress":null,"analyticsAccountId":"UA-19996407-1","baseUri":"","enableUniversalAnalytics":false,"name":"tools","features":{"copySiteProgressUpdates":true,"asyncPermanentDelete":true,"colorsAndFontsFix":true,"docosHideNotificationSettings":true,"driveImageLinkFromOnepick":false,"siteNoticeUrl":true,"asyncPageKeyFix":true,"fileCabinetScreenReaderFix":false,"pdfEmbedSupport":false,"siteMapBottomPaginationButtonsFix":true,"newMyMapsEmbeds":false,"plusBadge":false,"analyticsTrackingForCorp":false,"freebirdFormEmbedDocTypeFix":true,"webspaceUrlScrubOnlyOnBlur":true,"addShortcutToTextBoxDialog":true,"htmlEmbed":true,"newCountDownDialog":true,"pageTreeKeyboardFix":true,"domainAnalyticsInGAOnly":false,"languageSelectDefaultTextSetToDefault":true},"domain":"android.com","adsensePublisherId":null,"gvizVersion":1,"siteTitle":"Android Tools Project Site","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttp://sites.google.com/a/android.com/tools/tech-docs/new-build-system/user-guide\u0026service\u003djotspot","pageSharingId":"jotspot_page","plusPageId":"","onepickBaseUrl":"https://docs.google.com","siteNoticeRevision":null,"termsUrl":"http://sites.google.com/site/sites/system/app/pages/meta/terms?apps\u003d1","enableAnalytics":true,"isPublic":true,"siteNoticeMessage":null,"plusPageUrl":"","homePath":"/","sharingId":"jotspot","isAdsenseEnabled":true,"adsensePromoClickedOrSiteIneligible":true,"isStartPageEnabled":true,"domainAnalyticsAccountId":""};



webspace.gadgets = {"baseUri":"/system/app/pages/gadgets"};


webspace.user = {"uid":"","renderMobile":false,"namespaceUser":false,"sessionIndex":"","primaryEmail":"guest","displayNameOrEmail":"guest","namespace":"","hasAdminAccess":false,"guest_":true,"keyboardShortcuts":true,"hasWriteAccess":false,"domain":"","dasherUser":false,"userName":"guest"};

webspace.page = {"canDeleteWebspace":null,"locale":"zh_CN","state":"","wuid":"wuid:gx:2ba8119816f3cc7d","pageInheritsPermissions":null,"timeZone":"America/Los_Angeles","properties":{},"type":"text","canChangePath":true,"parentWuid":"wuid:gx:7f79556dd5cace7","revision":75,"title":"Gradle Plugin User Guide","isRtlLocale":false,"bidiEnabled":false,"siteLocale":"en","name":"user-guide","path":"/tech-docs/new-build-system/user-guide","isSiteRtlLocale":false,"parentPath":"/tech-docs/new-build-system"};
webspace.page.breadcrumbs = [{"title":"Technical docs","dir":"ltr","path":"/tech-docs","deleted":false},{"title":"New Build System","dir":"ltr","path":"/tech-docs/new-build-system","deleted":false},{"title":"Gradle Plugin User Guide","dir":"ltr","path":"/tech-docs/new-build-system/user-guide","deleted":false}];


webspace.editorResources = {
  text: [
    'http://www.gstatic.com/sites/p/fa469b/system/js/codemirror.js',
    'http://www.gstatic.com/sites/p/fa469b/system/app/css/codemirror_css.css',
    'http://www.gstatic.com/sites/p/fa469b/system/js/trog_edit__zh_cn.js',
    'http://www.gstatic.com/sites/p/fa469b/system/app/css/trogedit.css',
    '/_/rsrc/1416929664000/system/app/css/editor.css',
    'http://www.gstatic.com/sites/p/fa469b/system/app/css/codeeditor.css',
    '/_/rsrc/1416929664000/system/app/css/camelot/editor-jfk.css'
  ],
  sitelayout: [
    'http://www.gstatic.com/sites/p/fa469b/system/app/css/sitelayouteditor.css'
  ]
};

var JOT_clearDotPath = 'http://www.gstatic.com/sites/p/fa469b/system/app/images/cleardot.gif';


var JOT_userRelTimeStrs = ["1 \u5206\u949f\u524d","__duration__ \u5206\u949f\u4e4b\u524d","1 \u5c0f\u65f6\u524d","__duration__ \u5c0f\u65f6\u524d"];


webspace.siteTemplateId = false;


webspace.page.currentTemplate = {"title":"\u7f51\u9875","path":"/system/app/pagetemplates/text"};



var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Gradle 插件用户指南 - Android 工具项目站点">
<meta itemprop="name" content="Gradle 插件用户指南 - Android 工具项目站点">
<meta property="og:title" content="Gradle 插件用户指南 - Android 工具项目站点">
<meta name="description" content="Android tools 项目信息站点">
<meta itemprop="description" content="Android tools 项目信息站点">
<meta id="meta-tag-description" property="og:description" content="Android tools 项目信息站点">
<style type="text/css">
</style><!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<link rel="stylesheet" type="text/css" href="./../source-others/standard-css-iceberg-ltr-ltr.css">
<link rel="stylesheet" type="text/css" href="./../source-others/overlay.css">
<link rel="stylesheet" type="text/css" href="./../source-others/allthemes-view.css">

<title>Gradle 插件用户指南 - Android 工具项目站点</title>
<meta itemprop="image" content="/site/sites/system/app/images/cleardot.gif">
<meta property="og:image" content="/site/sites/system/app/images/cleardot.gif">
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="">
<tbody><tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="http://tools.android.com/" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="http://www.google.com/a/cpanel/android.com/images/logo.gif?service=google_default" alt="Android Tools 项目站点" class="sites-logo  sites-domain-logo"></a><h2><a href="http://tools.android.com/" dir="ltr" id="sites-chrome-userheader-title">Android Tools 项目站点</a></h2></div></td><td class="sites-layout-searchbox "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="http://tools.android.com/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site"><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site"><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0" style="-webkit-user-select: none;">搜索此网站</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
<div class="sites-header-nav"><ul class="sites-header-nav-container-boxes"></ul><div style="clear: both;"></div></div>
</td>
</tr>
</tbody></table> 
</div> 
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tbody><tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_2bd" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotid="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/overview" jotid="wuid:gx:44ff8c8722cc5d9b" class="sites-navigation-link">项目概述</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/screenshots" jotid="wuid:gx:6914b706d692f646" class="sites-navigation-link">屏幕截图</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/release" jotid="wuid:gx:7ac5d78c9458ca81" class="sites-navigation-link">发布状态</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/roadmap" jotid="wuid:gx:60ea3587cace173b" class="sites-navigation-link">路线图</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/download" jotid="wuid:gx:5b9a06a7bd768d08" class="sites-navigation-link">下载</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/preview-channel" jotid="wuid:gx:65c33e76aa1e249e" class="sites-navigation-link">预览通道</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/recent" jotid="wuid:gx:2d257f949510e1ed" class="sites-navigation-link">最近更新</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/tech-docs" jotid="wuid:gx:68695c8c797f5a75" class="sites-navigation-link">技术文档</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/tech-docs/new-build-system" jotid="wuid:gx:7f79556dd5cace7" class="sites-navigation-link">新构建系统</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_09830101249604128" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotid="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/knownissues" jotid="wuid:gx:2a2ed1d61165c57f" class="sites-navigation-link">已知问题</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/tips" jotid="wuid:gx:11629b864408db4c" class="sites-navigation-link">提示</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_42875732108950615" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotid="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/build" jotid="wuid:gx:138a85800bd6b1df" class="sites-navigation-link">构建概况</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/contributing" jotid="wuid:gx:1f3267453e2dafcc" class="sites-navigation-link">贡献</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/feedback" jotid="wuid:gx:5b9bc58701d69f2" class="sites-navigation-link">反馈</a></div></li></ul></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<a dir="ltr" href="http://tools.android.com/tech-docs">技术文档</a>&gt;<a dir="ltr" href="http://tools.android.com/tech-docs/new-build-system">新构建系统</a>&gt;
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr">Gradle 插件用户指南</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><div><img src="./../source-others/cleardot.gif" style="display:inline;float:right;margin:5px 0 5px 20px"><div class="sites-embed-align-left-wrapping-off"><div class="sites-embed-border-off sites-embed" style="width:400px;"><div class="sites-embed-content sites-embed-type-toc"><div class="goog-toc sites-embed-toc-maxdepth-6"><p>目录</p><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Introduction"><strong>1 </strong>简介</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Goals-of-the-new-Build-System"><strong>1.1 </strong>新构建系统的目标</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Why-Gradle-"><strong>1.2 </strong>为什么是 Gradle ？</a></li></ol></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Requirements"><strong>2 </strong>要求</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Basic-Project"><strong>3 </strong>基本项目</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Simple-build-files"><strong>3.1 </strong>简单的构建文件</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Project-Structure"><strong>3.2 </strong>项目结构</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Configuring-the-Structure"><strong>3.2.1 </strong>配置项目结构</a></li></ol></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Build-Tasks"><strong>3.3 </strong> 构建任务</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-General-Tasks"><strong>3.3.1 </strong>常规任务</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Java-project-tasks"><strong>3.3.2 </strong>Java 项目任务</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Android-tasks"><strong>3.3.3 </strong>Android 任务</a></li></ol></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Basic-Build-Customization"><strong>3.4 </strong>基本生成的自定义</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Manifest-entries"><strong>3.4.1 </strong>清单条目</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Build-Types"><strong>3.4.2 </strong>Build Types</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Signing-Configurations"><strong>3.4.3 </strong>签名配置</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Running-ProGuard"><strong>3.4.4 </strong>执行混淆</a></li></ol></li></ol></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Dependencies-Android-Libraries-and-Multi-project-setup"><strong>4 </strong>依赖、 Android 类库和多项目设置</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Dependencies-on-binary-packages"><strong>4.1 </strong>二进制包的依赖</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Local-packages"><strong>4.1.1 </strong>本地包</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Remote-artifacts"><strong>4.1.2 </strong>远程文件</a></li></ol></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Multi-project-setup"><strong>4.2 </strong>多项目设置</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Library-projects"><strong>4.3 </strong>库项目</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Creating-a-Library-Project"><strong>4.3.1 </strong>创建一个库项目</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Differences-between-a-Project-and-a-Library-Project"><strong>4.3.2 </strong>普通项目和库项目之间的区别</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Referencing-a-Library"><strong>4.3.3 </strong>引用库项目</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Library-Publication"><strong>4.3.4 </strong>库项目的发布</a></li></ol></li></ol></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Testing"><strong>5 </strong>测试</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Basics-and-Configuration"><strong>5.1 </strong>基础知识和配置</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Running-tests"><strong>5.2 </strong>运行测试</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Testing-Android-Libraries"><strong>5.3 </strong>测试 Android 库项目</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Test-reports"><strong>5.4 </strong>测试报告</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Single-projects"><strong>5.4.1 </strong>单个项目的报告</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Multi-projects-reports"><strong>5.4.2 </strong>多项目报告</a></li></ol></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Lint-support"><strong>5.5 </strong>Lint 支持</a></li></ol></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Build-Variants"><strong>6 </strong>Build Variants</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Product-flavors"><strong>6.1 </strong>Product flavors</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Build-Type-Product-Flavor-Build-Variant"><strong>6.2 </strong>Build Type + Product Flavor = Build Variant</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Product-Flavor-Configuration"><strong>6.3 </strong>Product Flavor 配置</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Sourcesets-and-Dependencies"><strong>6.4 </strong>Sourcesets 和 Dependencies</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Building-and-Tasks"><strong>6.5 </strong>Building 和 Tasks</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Testing1"><strong>6.6 </strong>测试</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Multi-flavor-variants"><strong>6.7 </strong>Multi-flavor variants</a></li></ol></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Advanced-Build-Customization"><strong>7 </strong>高级构建自定义</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Build-options"><strong>7.1 </strong>构建选项</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Java-Compilation-options"><strong>7.1.1 </strong>Java 编译选项</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-aapt-options"><strong>7.1.2 </strong>aapt 选项</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-dex-options"><strong>7.1.3 </strong>dex 选项</a></li></ol></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Manipulating-tasks"><strong>7.2 </strong>操纵任务</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-BuildType-and-Product-Flavor-property-reference"><strong>7.3 </strong>BuildType 和 Product Flavor 的属性引用</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Using-sourceCompatibility-1.7"><strong>7.4 </strong>使用 sourceCompatibility 1.7</a></li></ol></li></ol></div></div></div></div></div><h2><a name="TOC-Introduction"></a>简介</h2><div><b><font color="#ff0000">本文档是 Gradle 插件 0.9 版本的文档。在 1.0 之前，我们所介绍的早期版本可能由于不兼容问题会有所不同。</font></b></div><h3><a name="TOC-Goals-of-the-new-Build-System"></a>新构建系统的目标</h3><div>新的构建系统的目标是：<br><ul><li><span style="font-size:10pt;line-height:1.6">可以很容易地重用代码和资源</span></li><li><span style="line-height:1.6;font-size:10pt">可以很容易地创建应用程序的几个变种，无论是多APK分发还是不同定制版的应用程序</span></li><li><span style="line-height:1.6;font-size:10pt">可以很容易地配置、 扩展和自定义构建过程</span></li><li><span style="line-height:1.6;font-size:10pt">好的 IDE 集成</span></li></ul></div><div><h3><a name="TOC-Why-Gradle-"></a>为什么是 Gradle ？</h3></div><div>Gradle 是一个先进的构建系统和构建工具，它允许通过插件创建自定义的构建逻辑。<br><br>基于Gradle的以下特点，我们选择了它： <br><ul><li><span style="font-size:10pt;line-height:1.6">域特定语言 （DSL） 来描述和处理构建逻辑</span></li><li><span style="line-height:1.6;font-size:10pt">构建文件基于 Groovy ，并允许通过 DSL来混合声明性元素，以及使用代码来处理 DSL 元素以提供自定义逻辑。</span></li><li><span style="line-height:1.6;font-size:10pt">基于 Maven 和 Ivy 的内置依赖管理。</span></li><li><span style="line-height:1.6;font-size:10pt">非常灵活。允许使用最佳实现，但并不强制自己的实现方式。</span></li><li><span style="line-height:1.6;font-size:10pt">插件可以提供自己的 DSL 和API供构建文件使用。</span></li><li><span style="line-height:1.6;font-size:10pt">良好的Tooling API 供 IDE 集成</span></li></ul><h2><a name="TOC-Requirements"></a>要求</h2><div><ul><li><span style="line-height:1.6;font-size:10pt">Gradle 版本需要 1.10，1.11或 1.12。插件版本需要 0.11.1 </span></li><li><span style="line-height:1.6;font-size:10pt">SDK Build Tools版本要求为 19.0.0。某些功能可能需要更高版本。</span></li></ul></div><h2><a name="TOC-Basic-Project"></a>基本项目</h2></div><div>Gradle 项目在项目的根文件夹里的<i>build.gradle</i>文件中描述它的构建逻辑。<br><h3><a name="TOC-Simple-build-files"></a>简单的构建文件</h3></div><div>最简单的 纯Java项目的<i>build.gradle</i>如下所示：<br><br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">  apply plugin: 'java'</font></span></div></blockquote><div><br>这里配置使用了Gradle内置的 Java 插件。该插件提供用于构建并测试 Java 应用程序所需要的东西。<br><br>最简单的 Android 项目的 build.gradle 则是以下内容：<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">buildscript {</font></span></div><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; repositories {</font></span></div><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">mavenCentral()<br></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">}</span><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; dependencies {</font></span></div><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; classpath 'com.android.tools.build:gradle:0.11.1'</font></span></div><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; }</font></span></div><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">}</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">apply plugin: 'android'</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; compileSdkVersion 19</font></span></div></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; buildToolsVersion "19.0.0"<br></font></span></div></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">}</font></span></div></blockquote><div><br></div><div>在这个 Android 构建文件中，有3个主要部分： <br><br><font color="#38761d" face="courier new, monospace"><b>buildscript { ... }</b></font>配置了驱动构建的代码。 <br>在上面的这种情况中，它声明了使用 Maven 中央库，并且对一个Maven 文件有一个类路径依赖。这个文件是包含 Gradle Android 插件的 0.11.1 版本的库 <br>注： 这只会影响运行构建的代码，不会影响项目的源代码。项目本身需要定义它自己的仓库和依赖关系。稍后会提及这部分。<br><br>然后，和先前的提到的 Java 插件一样，这里配置使用了 <font color="#38761d" face="courier new, monospace"> <b>android</b></font>插件。 <br><br>最后， <font color="#38761d" face="courier new, monospace"> <b>android { ... }</b></font>配置了用于 android 构建的所有参数。这是Android DSL的入口。<br>默认情况下，只需要配置编译目标，以及build-tools的版本。它通过<font color="#38761d" face="courier new, monospace"><b>compileSdkVersion</b></font>和<b style="background-color:transparent;line-height:1.6;font-size:10pt;color:rgb(56,118,29);font-family:courier new,monospace">buildtoolsVersion</b><span style="background-color:transparent;line-height:1.6;font-size:10pt">属性来完成。</span></div><div>编译目标相当于旧的构建系统中project.properties 文件内的<font color="#38761d" face="courier new, monospace"><b>target</b></font>属性。这个新的属性可以设置为一个 int 值 (表示api 级别），或者是和以前的<b><font color="#38761d" face="courier new, monospace">target</font></b>的值一样，设置为字符串。<br><br><b>重要提示：</b>你应该只配置使用这个<font color="#38761d" face="courier new, monospace"><b>android</b></font>插件。如果同时配置使用了<b><font color="#38761d" face="courier new, monospace">java</font></b>插件也会导致构建错误。<br><br><b>注：</b>您还需要一个<i>local.properties</i>文件，通过<font color="#38761d" face="courier new, monospace"><b>sdk.dir</b></font>属性来设置 SDK 的位置，并且所设置的这个SDK要求存在。 <br>或者，您也可以设置一个<font color="#38761d" face="courier new, monospace"><b>ANDROID_HOME</b></font>环境变量。这两种方法之间没什么差别，你喜欢，你选择。</div><div><h3><a name="TOC-Project-Structure"></a>项目结构</h3></div><div><span style="line-height:1.6;font-size:10pt">上述的基本构建文件要求有一个默认的文件夹结构。Gradle 遵循约定大于配置的概念，在可能的情况下提供了合理的默认选项值。</span></div><div><br>基本项目开始于两个名为“source sets”的组件。即主源代码和测试代码。它们分别在：</div><span style="line-height:1.6;font-size:10pt"><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">src/main/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">src/androidTest/</font></span></li></ul></span><div><span style="line-height:1.6;font-size:10pt">里面的每个文件夹中都存在对应的源代码组件的文件夹。</span><br>对于 Java 和 Android 插件，Java 源代码和 Java 资源的位置如下： <br><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">java/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">resources/</font></span></li></ul></div><div>对于Android 插件，Android所特有的额外的文件和文件夹是：<br><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">AndroidManifest.xml</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">res/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">assets/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">aidl/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">rs/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">jni/</font></span></li></ul>注： <font face="courier new, monospace">src/</font><span style="font-family:courier new,monospace">androidTest</span><font face="courier new, monospace">/AndroidManifest.xml</font>是不需要的，因为它会被自动创建。<br><h4><a name="TOC-Configuring-the-Structure"></a>配置项目结构</h4></div><div>When the default project structure isn’t adequate, it is possible to configure it. 根据 Gradle 文档，为一个Java 项目<span style="line-height:1.6;font-size:10pt">重新配置 <i>sourceSets</i>可以通过如下方法实现：</span><br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace" style="font-style:normal">sourceSets {</font></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp; &nbsp; main {</font></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp; &nbsp;&nbsp;</font><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp;&nbsp;</span><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">java {</span></div><font face="courier new, monospace" style="font-style:normal">&nbsp;&nbsp;</font><span style="font-size:10pt;line-height:1.6;font-family:courier new,monospace;font-style:normal">&nbsp;&nbsp;</span><font face="courier new, monospace" style="line-height:1.6;font-size:10pt;font-style:normal">&nbsp;&nbsp;</font><span style="line-height:1.6;font-size:10pt;font-style:normal;font-family:courier new,monospace">&nbsp;&nbsp;</span><font face="courier new, monospace" style="line-height:1.6;font-size:10pt;font-style:normal">&nbsp;&nbsp;</font><span style="line-height:1.6;font-size:10pt;font-style:normal;font-family:courier new,monospace">&nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">srcDir 'src/java'</span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><font face="courier new, monospace" style="font-style:normal">&nbsp;&nbsp;</font><span style="font-size:10pt;line-height:1.6;font-family:courier new,monospace;font-style:normal">&nbsp;&nbsp;</span><font face="courier new, monospace" style="line-height:1.6;font-size:10pt;font-style:normal">&nbsp;&nbsp;</font><span style="line-height:1.6;font-size:10pt;font-style:normal;font-family:courier new,monospace">&nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">}</span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><font face="courier new, monospace" style="font-style:normal">&nbsp;&nbsp;</font><span style="font-size:10pt;line-height:1.6;font-family:courier new,monospace;font-style:normal">&nbsp;&nbsp;</span><font face="courier new, monospace" style="line-height:1.6;font-size:10pt;font-style:normal">&nbsp;&nbsp;</font><span style="line-height:1.6;font-size:10pt;font-style:normal;font-family:courier new,monospace">&nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">resources {</span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><font face="courier new, monospace" style="font-style:normal">&nbsp;&nbsp;</font><span style="font-size:10pt;line-height:1.6;font-family:courier new,monospace;font-style:normal">&nbsp;&nbsp;</span><font face="courier new, monospace" style="line-height:1.6;font-size:10pt;font-style:normal">&nbsp;&nbsp;</font><span style="line-height:1.6;font-size:10pt;font-style:normal;font-family:courier new,monospace">&nbsp;&nbsp;</span><font face="courier new, monospace" style="line-height:1.6;font-size:10pt;font-style:normal">&nbsp;&nbsp;</font><span style="line-height:1.6;font-size:10pt;font-style:normal;font-family:courier new,monospace">&nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">srcDir 'src/resources'</span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><font face="courier new, monospace" style="font-style:normal">&nbsp;&nbsp;</font><span style="font-size:10pt;line-height:1.6;font-family:courier new,monospace;font-style:normal">&nbsp;&nbsp;</span><font face="courier new, monospace" style="line-height:1.6;font-size:10pt;font-style:normal">&nbsp;&nbsp;</font><span style="line-height:1.6;font-size:10pt;font-style:normal;font-family:courier new,monospace">&nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">}</span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><font face="courier new, monospace" style="font-style:normal">&nbsp;&nbsp;</font><span style="font-size:10pt;line-height:1.6;font-family:courier new,monospace;font-style:normal">&nbsp;&nbsp;</span><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span><div><font face="courier new, monospace" style="font-style:normal">}</font></div></blockquote><div><br>注： <font color="#38761d" face="courier new, monospace"> <b>srcDir</b></font>实际上会将给定的文件夹添加到现有的源文件夹列表中 （这在Gradle 文档中没有提及，但这是实际的行为）。<br><br>如果要替换默认的源文件夹，您就要使用传入一个路径数组的<font color="#38761d" face="courier new, monospace"><b>srcDirs</b></font>来代替。以下是使用涉及的对象的另一种不同的方法：<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">sourceSets {</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; main.java.srcDirs = ['src/java']</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; main.resources.srcDirs = ['src/resources']</span></div><div><span style="font-style:normal"><font face="courier new, monospace">}</font></span></div></blockquote><br><span style="line-height:1.6;font-size:10pt">欲了解更多信息，请参阅 Gradle 文档中关于 Java 插件的内容，</span><a href="http://gradle.org/docs/current/userguide/java_plugin.html" style="line-height:1.6;font-size:10pt">见这里</a><span style="line-height:1.6;font-size:10pt">。</span><br><br>Android 插件使用类似的语法，但因为它使用它自己的<i>sourceSets</i>，所以在<font color="#38761d" face="courier new, monospace"><b>android</b></font>对象里面来实现。 <br><span style="line-height:1.6;font-size:10pt">这里有一个例子，使用旧的项目结构的主源码并重新映射<font color="#38761d" face="courier new, monospace"><b>androidTest</b> </font> <i>sourceSet</i> 到</span><font face="courier new, monospace">tests</font><span style="line-height:1.6;font-size:10pt">文件夹：</span><br><br><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><span style="font-style:normal"><font face="courier new, monospace">android {</font><font face="courier new, monospace"><br></font><font face="courier new, monospace">&nbsp; &nbsp; sourceSets {</font><font face="courier new, monospace"><br></font><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; main {</font><font face="courier new, monospace"><br></font></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-style:normal"><font face="courier new, monospace">manifest.srcFile 'AndroidManifest.xml'</font><font face="courier new, monospace"><br></font></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">java.srcDirs = ['src']</span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-style:normal"><font face="courier new, monospace">resources.srcDirs = ['src']</font><font face="courier new, monospace"><br></font></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="line-height:1.6;font-size:10pt;font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">aidl.srcDirs = ['src']</font></span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">renderscript.srcDirs = ['src']</span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-style:normal"><font face="courier new, monospace">res.srcDirs = ['res']</font><font face="courier new, monospace"><br></font></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="line-height:1.6;font-size:10pt;font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">assets.srcDirs = ['assets']</font></span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><span style="font-style:normal"><font face="courier new, monospace"><br></font></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal">androidTest</span><span style="font-style:normal"><font face="courier new, monospace">.setRoot('tests')</font><font face="courier new, monospace"><br></font></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-style:normal"><font face="courier new, monospace">}</font><font face="courier new, monospace"><br></font><font face="courier new, monospace">}</font></span></blockquote><br><div>注意： 因为旧的结构把所有源文件 （java、 aidl、 renderscript和 java 资源） 都放在相同的文件夹中，我们需要重新映射<i>sourceSet</i>的所有这些新组件到相同的<font color="#38761d" face="courier new, monospace"><b>src</b></font>文件夹中。<br>注意： <font color="#38761d" face="courier new, monospace"> <b>setRoot()</b></font>会将整个<i>sourceSet</i> （和它的子文件夹） 移到一个新的文件夹中。这将移动<font color="#38761d" face="courier new, monospace"><b>src/</b></font><b style="color:rgb(56,118,29);font-family:courier new,monospace">androidTest</b><font color="#38761d" face="courier new, monospace"><b>/*</b></font>到<font color="#38761d" face="courier new, monospace"><b>tests/*</b></font><br>下。这是 Android 专用的，不适用于 Java <i>sourceSets</i>。 <br><br>这也是一个“迁移”的例子。</div><div><h3><a name="TOC-Build-Tasks"></a>构建任务</h3><h4><a name="TOC-General-Tasks"></a>常规任务</h4></div><div><span style="line-height:1.6;font-size:10pt">在构建文件中配置使用一个插件，将自动创建一系列要运行的构建任务。Java 插件和 Android 插件都是。</span></div><div><span style="line-height:1.6;font-size:10pt">约定的任务如下：</span><br><ul><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>assemble</b></font><br></span><span style="font-size:10pt;line-height:1.6">组装项目的输出的任务</span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>check</b></font><br></span><span style="font-size:10pt;line-height:1.6">运行所有检查的任务。</span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>build</b></font><br></span><span style="font-size:10pt;line-height:1.6">这个任务将执行<b style="color:rgb(56,118,29);font-family:courier new,monospace">assemble</b>和</span><b style="color:rgb(56,118,29);font-family:courier new,monospace">check</b>。</li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>clean</b></font><br></span><span style="font-size:10pt;line-height:1.6">这个任务将清理项目的输出</span></li></ul><b style="color:rgb(56,118,29);font-family:courier new,monospace">assemble</b><span style="font-size:10pt;line-height:1.6">，</span><b style="color:rgb(56,118,29);font-family:courier new,monospace">check</b><span style="font-size:10pt;line-height:1.6">和</span><b style="color:rgb(56,118,29);font-family:courier new,monospace">build</b><span style="font-size:10pt;line-height:1.6"><span style="font-size:10pt;line-height:1.6">这些任务</span>，实际上不做任何事情。他们是锚记任务，用于让插件添加实际的任务去做这些事情。</span>这允许您能够调用同样的任务，无论项目的类型是什么，或者是配置使用了什么插件 <br><br>。<br>例如，配置使用<i>findbugs</i>插件将创建一个新的任务和使<b style="color:rgb(56,118,29);font-family:courier new,monospace">check</b>任务依赖于它，使得每当调用<b style="color:rgb(56,118,29);font-family:courier new,monospace">check</b>任务时都会调用到它。<br><br>您可以从命令行中运行下面的命令来获取更高级别的任务： <br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">gradle tasks</font></span></div></blockquote><div><br></div><div>下面的命令可以得到一个完整的任务列表，并且看到任务运行之间的依赖关系：<br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">gradle tasks --all</font></span></div></blockquote><div><br></div><div>注： Gradle 会自动监视一个任务所声明的输入和输出。<br>在没有变化的情况下，<span style="line-height:1.6;font-size:10pt">运行</span>两次<b style="color:rgb(56,118,29);font-family:courier new,monospace">build</b><span style="line-height:1.6;font-size:10pt">会使 Gradle 报告所有任务为<font face="courier new, monospace">UP-TO-DATE</font>状态，这个状态意味着没有任何事情需要执行。这允许任务正确地相互依赖而无需不必要的构建操作。</span></div><div><h4><a name="TOC-Java-project-tasks"></a>Java 项目任务</h4></div><div>Java 插件主要创建两个任务，它们是主要锚记任务的依赖任务：<br><ul><li><b style="color:rgb(56,118,29);font-family:courier new,monospace">assemble</b></li><ul><li><span style="line-height:1.6;font-size:10pt"> <font color="#38761d" face="courier new, monospace"> <b>jar</b></font><br></span><span style="font-size:10pt;line-height:1.6">这个任务将创建输出。</span></li></ul><li><b style="color:rgb(56,118,29);font-family:courier new,monospace">check</b></li><ul><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>test</b></font><br></span><span style="font-size:10pt;line-height:1.6">这个任务将运行测试。</span></li></ul></ul><b style="color:rgb(56,118,29);font-family:courier new,monospace">jar</b>任务本身会直接或间接地依赖其他任务： 例如，<b><font color="#38761d" face="courier new, monospace">classes</font></b>任务用于编译 Java 代码。<br><span style="line-height:1.6;font-size:10pt"><b><font color="#38761d" face="courier new, monospace">testClasses</font></b>任务用于编译测试，但它很少会被调用，因为</span><b style="color:rgb(56,118,29);font-family:courier new,monospace">test</b><span style="line-height:1.6;font-size:10pt">任务依赖于它 （以及</span><b><font color="#38761d" face="courier new, monospace">classes</font></b><span style="line-height:1.6;font-size:10pt">任务）。</span><br><br>一般情况下，你将可能永远只调用<b style="color:rgb(56,118,29);font-family:courier new,monospace">assemble</b>或<b style="color:rgb(56,118,29);font-family:courier new,monospace">check</b>，而无视其他任务。 <br><br><a href="http://gradle.org/docs/current/userguide/java_plugin.html">在这里</a>，你可以看到Java 插件的所有任务和对它们的描述。<br><h4><a name="TOC-Android-tasks"></a>Android 任务</h4></div><div>Android 的插件使用相同的约定配置以兼容其他插件，并添加了另外的锚记任务：<br><ul><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">assemble</b><br></span><span style="font-size:10pt;line-height:1.6">组装项目的输出的任务</span></li><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">check</b><br></span><span style="font-size:10pt;line-height:1.6">运行所有检查的任务。</span></li><li><b><font color="#38761d" face="courier new, monospace" size="2"><span style="line-height:1.6">connectedCheck</span></font><br></b>运行需要一个已连接的设备或模拟器的检查。它们将在所有已连接的设备上并行运行。</li><li><span style="line-height:1.6;font-size:10pt"> <b style="color:rgb(56,118,29);font-family:courier new,monospace">deviceCheck</b><br></span><span style="font-size:10pt;line-height:1.6">使用 API 连接到远程设备运行检查。这一个是在 CI 服务器上使用的。</span></li><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">build</b><br></span><span style="font-size:10pt;line-height:1.6">这项任务将执行assemble 和 check</span></li><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">clean</b><br></span><span style="font-size:10pt;line-height:1.6">这个任务将清理项目的输出</span></li></ul></div><div>新的锚记任务是有必要的，以便能够运行定期的检查而无需连接的设备。<br>注意到，<b style="color:rgb(56,118,29);font-family:courier new,monospace">build</b>任务不依赖于<b style="color:rgb(56,118,29);font-family:courier new,monospace">deviceCheck</b>或<b style="color:rgb(56,118,29);font-family:courier new,monospace">connectedCheck</b>。<br><br>Android 项目具有至少两个输出： debug版本的APK 和release版本的 APK。这里的每一个输出都有自己的锚记任务，以便单独构建它们： <br><ul><li><b style="color:rgb(56,118,29);font-family:courier new,monospace">assemble</b></li><ul><li><b style="color:rgb(56,118,29);font-family:courier new,monospace">assembleDebug</b></li><li><b style="color:rgb(56,118,29);font-family:courier new,monospace">assembleRelease</b></li></ul></ul></div><div>它们两个都依赖于执行构建一个 APK所需的多个步骤的其他任务。<b style="color:rgb(56,118,29);font-family:courier new,monospace">assemble</b>任务取则依赖于这两个任务，所以调用 assemble 将会构建出这两个 APKs。<br><br>提示：在命令行上，Gradle 支持任务名称的驼峰命名法的简写。例如： <br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">  gradle aR</font></span></div></blockquote><div>相当于输入<br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">  gradle assembleRelease</font></span></div></blockquote><div>只要没有其他任务匹配 “aR” <br><br>check锚记任务有它们自己的依赖项： <br><ul><li><b style="color:rgb(56,118,29);font-family:courier new,monospace">check</b></li><ul><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>lint</b></font></span></li></ul><li><b style="color:rgb(56,118,29);font-family:courier new,monospace">connectedCheck</b></li><ul><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>connectedA</b></font></span><b style="color:rgb(56,118,29);font-family:courier new,monospace">ndroidTest</b></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>connectedUiAutomatorTest</b></font> （暂未实现）</span></li></ul><li><b style="color:rgb(56,118,29);font-family:courier new,monospace">deviceCheck</b></li><ul><li>这个任务依赖于当其他插件实现了测试扩展点时创建的任务。</li></ul></ul>最后，该插件为所有构建类型 （<font color="#38761d" face="courier new, monospace"><b>debug</b></font>、<b><font color="#38761d" face="courier new, monospace">release</font></b>、<b><font color="#38761d" face="courier new, monospace">test</font></b>）创建了omstal/uninstall 任务，只要他们可以被安装（需要签名）。<br><h3><a name="TOC-Basic-Build-Customization"></a>基本的构建定制</h3></div><div>Android 插件提供了大量的 DSL，以通过构建系统直接地自定义大部分事情。<br><h4><a name="TOC-Manifest-entries"></a>清单条目</h4></div><div>通过 DSL 可以配置以下清单条目：<br><ul><li><span style="line-height:1.6;font-size:10pt">minSdkVersion</span></li><li><span style="line-height:1.6;font-size:10pt">targetSdkVersion</span></li><li><span style="line-height:1.6;font-size:10pt">versionCode</span></li><li><span style="line-height:1.6;font-size:10pt">versionName</span></li><li><span style="line-height:1.6;font-size:10pt">applicationId （有效的包名 —— 更多的信息请参阅<a href="http://tools.android.com/tech-docs/new-build-system/applicationid-vs-packagename">ApplicationId 与packageName</a>）</span></li><li><span style="line-height:1.6;font-size:10pt">用于测试应用程序的包名</span></li><li><span style="line-height:1.6;font-size:10pt">Instrumentation test runner</span></li></ul>示例：<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace" style="font-style:normal">android {</font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; compileSdkVersion 19</span></div></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; buildToolsVersion "19.0.0"</span></div></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><br></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp; &nbsp; defaultConfig {</font></div><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp; &nbsp;</span><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">versionCode 12</span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp; &nbsp;</span><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">versionName "2.0"</span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">minSdkVersion 16<br></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">targetSdkVersion 16<br></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">}</span><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br>在<font color="#38761d" face="courier new, monospace"><b>android</b></font>元素的内部的<font color="#38761d" face="courier new, monospace"><b>defaultConfig</b></font>元素是定义所有这些配置的地方。</div><div><br></div><div>以前版本的 Android 插件使用packageName来配置清单的“packageName”属性。</div><div>从 0.11.0开始，你应该在 build.gradle 中使用 applicationId 来配置清单中的“packageName”条目。</div><div>它消除了应用程序的包名（指它的 ID）和java 包名之间的所引起的混乱。&nbsp;</div><div><br><br>在构建文件中描述它的强大之处是它可以是动态的。 <br>例如，可以从文件中的某处或使用一些自定义的逻辑读取版本信息： <br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">def computeVersionName() {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; ...</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; compileSdkVersion 19</span></div><div><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; buildToolsVersion "19.0.0"</span></div><div><br></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; defaultConfig {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; versionCode 12</span></div><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">versionName computeVersionName()<br></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">minSdkVersion 16<br></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">targetSdkVersion 16<br></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; </span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">}</span><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>注意： 不要使用在作用域内可能与已存在的getter函数有冲突的函数名称。例如 defaultConfig { ...} 实例调用 getVersionName() 时将自动使用 defaultConfig.getVersionName() 的 getter 方法，而不是自定义的方法。</div><div><br>如果一个属性未通过 DSL 来设置，它将使用默认值。下表描述了对于未设置的属性的处理方式。<br><table border="1" bordercolor="#888" cellspacing="0" style="border-collapse:collapse;border-color:rgb(136,136,136);border-width:1px"><tbody><tr><td style="width:208px;height:19px">&nbsp;属性名称</td><td style="width:168px;height:19px">&nbsp;DSL 对象中的默认值</td><td style="width:251px;height:19px">&nbsp;默认值</td></tr><tr><td style="width:208px;height:20px">&nbsp;<font color="#38761d" face="courier new, monospace"><b>versionCode</b></font></td><td style="width:168px;height:20px">&nbsp;-1</td><td style="width:251px;height:20px">&nbsp;如果在清单中存在，则使用清单中的值</td></tr><tr><td style="width:208px;height:20px">&nbsp;<font color="#38761d" face="courier new, monospace"><b>versionName</b></font></td><td style="width:168px;height:20px">&nbsp;null</td><td style="width:251px;height:20px">&nbsp;如果在清单中存在，则使用清单中的值</td></tr><tr><td style="width:208px;height:20px">&nbsp;<font color="#38761d" face="courier new, monospace"><b>minSdkVersion</b></font></td><td style="width:168px;height:20px">&nbsp;-1</td><td style="width:251px;height:20px">&nbsp;如果在清单中存在，则使用清单中的值</td></tr><tr><td style="width:208px;height:20px">&nbsp;<font color="#38761d" face="courier new, monospace"><b>targetSdkVersion</b></font></td><td style="width:168px;height:20px">&nbsp;-1</td><td style="width:251px;height:20px">&nbsp;如果在清单中存在，则使用清单中的值</td></tr><tr><td style="width:208px;height:20px">&nbsp;<font color="#38761d" face="courier new, monospace"><b>applicationId</b></font></td><td style="width:168px;height:20px">&nbsp;null</td><td style="width:251px;height:20px">&nbsp;如果在清单中存在，则使用清单中的值</td></tr><tr><td style="width:208px;height:20px">&nbsp;<font color="#38761d" face="courier new, monospace"><b>testApplicationId</b></font></td><td style="width:168px;height:20px">&nbsp;null</td><td style="width:251px;height:20px">&nbsp;applicationId + “.test”</td></tr><tr><td style="width:208px;height:20px">&nbsp;<font color="#38761d" face="courier new, monospace"><b>testInstrumentationRunner</b></font></td><td style="width:168px;height:20px">&nbsp;null</td><td style="width:251px;height:20px">&nbsp;android.test.InstrumentationTestRunner</td></tr><tr><td style="width:208px;height:19px">&nbsp;<font color="#38761d" face="courier new, monospace"><b>signingConfig</b></font></td><td style="width:168px;height:19px">&nbsp;null</td><td style="width:251px;height:19px">&nbsp;null</td></tr><tr><td>&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">proguardFile</b></td><td>&nbsp;N/A (只设置)</td><td>&nbsp;N/A (只设置)</td></tr><tr><td>&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">proguardFiles</b></td><td>&nbsp;N/A (只设置)</td><td>&nbsp;N/A (只设置)&nbsp;</td></tr></tbody></table><br><br>第二列的值是很重要的，如果您在构建脚本中使用自定义逻辑查询这些属性的话。例如，您可以编写：<br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace"><span style="line-height:1.6;font-size:10pt;font-style:normal">if (android.defaultConfig.testInstrumentationRunner == null) {</span></font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; // assign a better default...</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>如果值仍然为null，那么在构建的时候它将会被设为第三列中的实际默认值，但是由于 DSL 元素不包含此默认值，因此您无法查询它。<br><span style="line-height:1.6;font-size:10pt">这是为了防止解析应用程序的清单，除非真的很需要。</span><br><h4><a name="TOC-Build-Types"></a>构建类型</h4></div><div><span style="line-height:1.6;font-size:10pt">默认情况下，Android 插件自动将项目设置为生成应用程序的的debug和release版本。</span></div><div><span style="line-height:1.6;font-size:10pt">这两个版本的不同，大多是围绕在调试一个安全的（非开发版的）设备的能力，以及 apk 怎么签名。</span><br><br>调试版本使用自动创建的密钥/证书签名，并且密钥/证书的用户名/密码是已知的（以防止构建过程中需要相关的信息）的。release版本在构建的时候不会进行签名，需要在之后进行签名。<br><br>这个配置是通过一个叫<font color="#38761d" face="courier new, monospace"><b>BuildType</b></font>的对象来完成的。默认情况下，2 个实例会被创建，分别是<b><font color="#38761d" face="courier new, monospace">debug</font></b>版和<font color="#38761d" face="courier new, monospace"><b>release</b></font>版。<br><br>Android 插件允许自定义这两个实例，以及创建其他的<i>构建类型</i>。它通过<font color="#38761d" face="courier new, monospace"><b>buildTypes</b> </font> DSL 容器来实现：<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; buildTypes {</span></div><div><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">debug {</span></div><div><span style="line-height:1.6;font-size:10pt;font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="line-height:1.6;font-size:10pt;font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="line-height:1.6;font-size:10pt;font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; applicationId</span><span style="line-height:1.6;font-size:10pt;font-family:courier new,monospace;font-style:normal">Suffix    ".debug"</span></div></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; j</font></span><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">nidebug.initWith(buildTypes.debug)</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; jnidebug {</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; packageNameSuffix   ".jnidebug"</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jniDebuggable true</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br>上面的代码段可实现以下操作：<br><ul><li><span style="line-height:1.6;font-size:10pt">配置默认的<font color="#38761d" face="courier new, monospace"><b>Debug</b></font> <i>Build Type</i>：</span></li><ul><li><span style="line-height:1.6;font-size:10pt">设置包名为<font face="courier new, monospace">&lt;app appliationId&gt;.debug</font>，以便能够在相同的设备上安装<i>debug</i>和<i>release</i>两个版本的apk</span></li></ul><li><span style="line-height:1.6;font-size:10pt">创建一个叫<font color="#38761d" face="courier new, monospace"><b>jnidebug</b></font>的新的<i>BuildType</i>对象 ，并将其配置为<font color="#38761d" face="courier new, monospace"><b>debug</b></font>生成类型的一个副本。</span></li><li><span style="line-height:1.6;font-size:10pt">通过启用 JNI 组件的debug构建，并添加不同的包后缀，继续配置<b style="color:rgb(56,118,29);font-family:courier new,monospace">jnidebug</b>。</span></li></ul>创建新的 <i>Build Types</i> 就是简单地在<font color="#38761d" face="courier new, monospace"><b>buildTypes</b></font>下添加一个新的元素，然后调用 <font color="#38761d" face="courier new, monospace"><b>initWith()</b></font>或者是使用一个闭包来配置。<br><br>以下是可能用到的属性和它们的默认值： <br><br><table border="1" bordercolor="#888" cellspacing="0" style="border-collapse:collapse;border-color:rgb(136,136,136);border-width:1px"><tbody><tr><td style="width:198px;height:19px">&nbsp;属性名称</td><td style="width:195px;height:19px">&nbsp;用于 debug的默认值</td><td style="width:241px;height:19px">&nbsp;用于 release/其他 的默认值</td></tr><tr><td style="width:198px;height:20px">&nbsp;<font color="#38761d" face="courier new, monospace"><b>debuggable</b></font></td><td style="width:195px;height:20px">&nbsp;true</td><td style="width:241px;height:20px">&nbsp;false</td></tr><tr><td style="width:198px;height:20px">&nbsp;<font color="#38761d" face="courier new, monospace"><b>jniDebuggable</b></font></td><td style="width:195px;height:20px">&nbsp;false</td><td style="width:241px;height:20px">&nbsp;false</td></tr><tr><td style="width:198px;height:19px">&nbsp;<b><font color="#38761d" face="courier new, monospace">renderscriptDebuggable</font></b></td><td style="width:195px;height:19px">&nbsp;false</td><td style="width:241px;height:19px">&nbsp;false</td></tr><tr><td style="width:198px;height:20px">&nbsp;<b><font color="#38761d" face="courier new, monospace">renderscriptOptimLevel</font></b></td><td style="width:195px;height:20px">&nbsp;3</td><td style="width:241px;height:20px">&nbsp;3</td></tr><tr><td style="width:198px;height:20px">&nbsp;<b><font color="#38761d" face="courier new, monospace">applicationIdSuffix</font></b></td><td style="width:195px;height:20px">&nbsp;null</td><td style="width:241px;height:20px">&nbsp;null</td></tr><tr><td style="width:198px;height:20px">&nbsp;<b><font color="#38761d" face="courier new, monospace">versionNameSuffix</font></b></td><td style="width:195px;height:20px">&nbsp;null</td><td style="width:241px;height:20px">&nbsp;null</td></tr><tr><td style="width:198px;height:20px">&nbsp;<b><font color="#38761d" face="courier new, monospace">signingConfig</font></b></td><td style="width:195px;height:20px">&nbsp;android.signingConfigs.debug</td><td style="width:241px;height:20px">&nbsp;null</td></tr><tr><td style="width:198px;height:20px">&nbsp;<b><font color="#38761d" face="courier new, monospace">zipAlignEnabled</font></b></td><td style="width:195px;height:20px">&nbsp;false</td><td style="width:241px;height:20px">&nbsp;true</td></tr><tr><td>&nbsp;<b><font color="#38761d" face="courier new, monospace">minifyEnabled</font></b></td><td>&nbsp;false</td><td>&nbsp;false</td></tr><tr><td>&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">proguardFile</b></td><td>&nbsp;N/A (只设置)</td><td>&nbsp;N/A (只设置)</td></tr><tr><td>&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">proguardFiles</b></td><td>&nbsp;N/A (只设置)</td><td>&nbsp;N/A (只设置)</td></tr></tbody></table><br><br>除了这些属性，<i>Build Types</i>还会影响到构建的代码和资源。<br>对每个Build Type都会创建一个自动匹配的<i>sourceSet</i>，默认位置为 <br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">  src/&lt;buildtypename&gt;/</font></span></div></blockquote><div>这意味着<i>Build Type</i>的名字不能为<i>main</i>或者是<i>androidTest</i> （这是插件所强制的），并且它们之间必须是唯一的。<br><br>与任何其他source set一样，生成类型的source set的位置也是可以重新设置的： <br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; sourceSets.jnidebug.setRoot('foo/jnidebug')</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div>此外，对于每个<i>Build Type</i>，会创建一个新的<font face="courier new, monospace">assemble&lt;BuildTypeName&gt;</font>任务。 <br><br>已经提到过的<font color="#38761d" face="courier new, monospace"><b>assembleDebug</b></font>和<font color="#38761d" face="courier new, monospace"><b>assembleRelease</b></font>这两个任务，这里也会讲一下它们是怎么来的。当<font color="#38761d" face="courier new, monospace"><b>debug</b></font>和<font color="#38761d" face="courier new, monospace"><b>release</b></font><i>Build Types</i>被预创建的时候，他们的任务也会被自动创建。然后，<br><br> 上面的<i>build.gradle</i>片段也会生成一个<font color="#38761d" face="courier new, monospace"><b>assembleJnidebug</b></font>任务，并且<b><font color="#38761d" face="courier new, monospace">assemble</font></b>将会依赖于它，就像它依赖于<font color="#38761d" face="courier new, monospace"><b>assembleDebug</b></font>和<b style="color:rgb(56,118,29);font-family:courier new,monospace">assembleRelease</b>任务一样。 <br><br>提示： 请记住您可以输入<font face="courier new, monospace">gradle aJ</font>来运行<b style="color:rgb(56,118,29);font-family:courier new,monospace">assembleJnidebug</b>任务。<br><br>可能会用到的情况： <br><ul><li><span style="font-size:10pt;line-height:1.6">release模式下不需要，但debug模式下需要的权限</span></li><li><span style="line-height:1.6;font-size:10pt">自定义的debug实现</span></li><li><span style="line-height:1.6;font-size:10pt">为调试模式使用不同的资源 （例如某个资源的值与签名证书相绑定时）。</span></li></ul><i>BuildType</i>的代码和资源通过以下方式被使用：<br><ul><li><span style="font-size:10pt;line-height:1.6">manifest将被合并到应用程序的manifest中</span></li><li><span style="line-height:1.6;font-size:10pt">代码只是作为另一个源文件夹来起作用</span></li><li><span style="line-height:1.6;font-size:10pt">资源将覆盖main里面的资源，并替换已经存在的值。</span></li></ul><h4><a name="TOC-Signing-Configurations"></a>签名配置</h4></div><div>对应用程序进行签名，要求如下：<br><ul><li><span style="font-size:10pt;line-height:1.6">一个 keystore</span></li><li><span style="line-height:1.6;font-size:10pt">一个 keystore 的密码</span></li><li><span style="line-height:1.6;font-size:10pt">一个 key 的别名</span></li><li><span style="line-height:1.6;font-size:10pt">一个 key 的密码</span></li><li><span style="line-height:1.6;font-size:10pt">存储类型</span></li></ul>签名文件的位置，key的名称，以及这两个密码和存储类型，一起构成了一个签名配置 （ <i>SigningConfig</i>类型） <br><br>默认情况下，有一个<font color="#38761d" face="courier new, monospace"><b>debug</b></font>的配置，配置使用了一个debug keystore。这个keystore使用了一个已知的key和一个已知的密码。 <br>这个debug keystore 位于<font face="courier new, monospace">$HOME/.android/debug.keystore</font>，并且会在不存在时被创建。<b style="line-height:1.6;font-size:10pt;color:rgb(56,118,29);font-family:courier new,monospace">debug</b><span style="line-height:1.6;font-size:10pt"> <i>Build Type</i>被设置为自动使用此</span><b style="color:rgb(56,118,29);font-family:courier new,monospace">debug</b><br><br><span style="line-height:1.6;font-size:10pt"> <i>SigningConfig</i>。</span></div><div><br>你也可以创建其他配置，或者自定义某个默认的内置配置。通过<font color="#38761d" face="courier new, monospace"><b>signingConfigs</b> </font> DSL 容器来实现：<br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-size:10pt;line-height:1.6;font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; signingConfigs {</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; debug {</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; storeFile file("debug.keystore")</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; myConfig {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; storeFile file("other.keystore")</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; storePassword "android"</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; keyAlias "androiddebugkey"</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; keyPassword "android"</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; buildTypes {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; foo {</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; debuggable true</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jniDebuggable true</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; signingConfig signingConfigs.myConfig</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp;&nbsp;</font></span><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div>上面的代码段把debug keystore的位置修改为在项目的根位置下。这会自动影响到任何设置为使用它的<i>Build Types</i>，在这里，影响到的是<b style="color:rgb(56,118,29);font-family:courier new,monospace">debug</b> <i>Build Type</i>。<br><br>代码的代码还创建了一个新的<i>Signing Config</i>和使用新配置的新的<i>Build Type</i> 。<br><br>注：只有位于默认位置下的debug keystores才会被自动创建。如果debug keystore的位置被更改了，它将不会在需要时自动创建。创建一个使用一个不同的名称<i>SigningConfig</i>，但使用了默认的debug keystore的路径，它也会被自动创建。换句话说，会不会被自动创建与keystore的路径有关，而与配置名称无关。<br><br>注： keystore的路径通常使用项目根目录的相对路径，但也可以是使用绝对路径，尽管这不推荐 （除了自动创建的debug keystore）。</div><div><br></div><div><b>注意： 如果您将这些文件加入版本控制，您可能不希望这些文件中有你的密码。下面的 Stack Overflow 链接显示了如何从控制台或环境变量中读取值的方法。</b></div><div><a href="http://stackoverflow.com/questions/18328730/how-to-create-a-release-signed-apk-file-using-gradle">http://stackoverflow.com/questions/18328730/how-to-create-a-release-signed-apk-file-using-gradle</a></div><div><b>我们会在以后更新本指南补充更详细的信息。</b><br><h4><a name="TOC-Running-ProGuard"></a>运行ProGuard</h4><div>ProGuard 是通过 Gradle plugin for ProGuard version 4.10来进行支持的。ProGuard 插件会被自动配置使用，并且如果<i>Build Type</i>通过<i>minifyEnabled</i>属性配置为运行ProGuard，对应的任务将被自动创建。</div><div><br></div></div><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt">android {</span><br><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; buildTypes {</span><br><span style="font-family:courier new,monospace;font-size:10pt;line-height:1.6">&nbsp; &nbsp; &nbsp; &nbsp; release {</span><br><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; minifyEnabled true</span><br><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; proguardFile getDefaultProguardFile('proguard-android.txt')</span><br><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span><br><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span><br><div><div><font face="courier new, monospace"><span style="font-style:normal"><br></span></font></div></div><div><div><font face="courier new, monospace"><span style="font-style:normal">&nbsp; &nbsp; productFlavors {</span></font></div></div><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; flavor1 {</span><br><div><div><font face="courier new, monospace"><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; }</span></font></div></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; flavor2 {</span></div><span style="font-family:courier new,monospace;font-size:10pt;line-height:1.6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; proguardFile 'some-other-rules.txt'</span><br><div><div><font face="courier new, monospace"><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; }</span></font></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div></div></blockquote></div><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span><br><div><div><span style="font-style:normal"><font face="courier new, monospace">}</font></span></div></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="arial, sans-serif">变种使用他们的构建类型中所声明的规则文件，product flavors（定制版本）则使用flavor中声明的规则文件。</font></span></div><div><span style="font-style:normal"><font face="arial, sans-serif"><br></font></span></div><div><span style="font-style:normal"><font face="arial, sans-serif">这里有 2 个默认的规则文件</font></span></div><div><ul><li><font face="arial, sans-serif">proguard-android.txt</font></li><li><font face="arial, sans-serif">proguard-android-optimize.txt</font></li></ul><div><font face="arial, sans-serif">它们位于 SDK 中。使用<i>getDefaultProguardFile()</i>将返回的文件的完整路径。它们除了是否启用优化之外，其它都是相同的。</font></div></div><div><h2><a name="TOC-Dependencies-Android-Libraries-and-Multi-project-setup"></a>依赖、 Android Library和多项目设置</h2></div><div>Gradle 项目可以对其他组件具有依赖关系。这些组件可以是外部的二进制包，或其他的 Gradle 项目。<br><h3><a name="TOC-Dependencies-on-binary-packages"></a>二进制包的依赖</h3><h4><a name="TOC-Local-packages"></a>本地包</h4></div><div>要配置一个外部库 jar 包的依赖，您需要在<font color="#38761d" face="courier new, monospace"><b>compile</b></font>配置中添加一个依赖关系。<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">dependencies {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; compile files('libs/foo.jar')</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">android {</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; ...</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br>注意：<font color="#38761d" face="courier new, monospace"><b>dependencies</b></font> DSL 元素是标准的 Gradle API 的一部分，不属于<b><font color="#38761d" face="courier new, monospace">android</font></b> 元素内。<br><br><b style="color:rgb(56,118,29);font-family:courier new,monospace">compile</b>配置用于编译主应用程序。里面的所有内容都会被添加到编译类路径，<b>并且</b>打包到最终生成的 apk 当中。<br>下面是添加依赖时其他可能用到的配置： <br><ul><li><span style="font-size:10pt;line-height:1.6"><b style="color:rgb(56,118,29);font-family:courier new,monospace">compile</b>: 主应用程序</span></li><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace"><b>androidTest</b>Compile</b>: 测试的应用程序</span></li><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">debugCompile</b>: debug Build Type</span></li><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">releaseCompile</b>: release Build Type.</span></li></ul>因为不可能构建一个没有任何关联的<i>Build Type</i>的 APK，apk 总是配置两个（或以上）的配置：<b style="color:rgb(56,118,29);font-family:courier new,monospace">compile</b>和<font face="courier new, monospace">&lt;buildtype&gt;Compile</font>。 <br><span style="line-height:1.6;font-size:10pt">创建一个新的</span><i style="line-height:1.6;font-size:10pt">Build Type</i><span style="line-height:1.6;font-size:10pt">会基于它的名字自动创建一个新的配置。</span><br><br>这可能会有用，比如debug版本需要使用一个自定义库（例如报告崩溃的信息），而release版本则不需要，或者是他们依赖于同一个库的不同版本的情况下。 <br><h4><a name="TOC-Remote-artifacts"></a>远程文件</h4></div><div>Gradle 支持从 Maven 和 Ivy 仓库中拉取文件。<br><br>首先，这个仓库必须添加到列表当中，然后必须用Maven 或 Ivy 声明文件的方式声明这个依赖。<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">repositories {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; mavenCentral()</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">dependencies {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; compile 'com.google.guava:guava:11.0.2'</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">android {</span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp;&nbsp;</font></span><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">...</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br>注： <font color="#38761d" face="courier new, monospace"><b>mavenCentral()</b></font>是指定maven中央仓库的URL的快捷方法。Gradle支持远程和本地仓库。<br><span style="line-height:1.6;font-size:10pt">注：Gradle 将遵循所有依赖关系的传递性。这意味着，如果一个依赖有它自己的依赖关系，这些依赖也会被拉取。</span><br><br>有关设置依赖关系的更多信息，请参阅 Gradle 用户指南（<a href="http://gradle.org/docs/current/userguide/artifact_dependencies_tutorial.html">这里</a>），和DSL文档（<a href="http://gradle.org/docs/current/dsl/org.gradle.api.artifacts.dsl.DependencyHandler.html">这里</a>）。<br><h3><a name="TOC-Multi-project-setup"></a>多项目设置</h3></div><div>Gradle 项目也可以通过使用多项目设置依赖于其他的 Gradle 项目。<br><br>一个多项目设置通常是通过让所有的项目作为给定根项目的子文件夹来实现。<br><br>例如，给定以下项目结构：<br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">MyProject/</font></span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp;+ app/</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp;+ libraries/</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; + lib1/</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; + lib2/</span></div></blockquote><div><br></div><div>我们可以识别出3个项目。Gradle 将通过以下名称引用它们：<br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">  :app</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">  :libraries:lib1</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">  :libraries:lib2</font></span></div></blockquote><div><br>每一个项目都有其自己的build.gradle文件，定义自己如何构建。<br>此外，在根路径下还将有一个叫<i>settings.gradle</i>的文件用于声明所有的项目。<br>这些文件的结构如下：<br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">MyProject/</font></span></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp;| settings.gradle</font></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp;+ app/</font></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp; &nbsp; | build.gradle</font></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp;+ libraries/</font></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp; &nbsp; + lib1/</font></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp;| build.gradle</font></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp; &nbsp; + lib2/</font></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp;| build.gradle</font></div></blockquote><div><br>settings.gradle的内容很简单：<br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><font face="courier new, monospace" style="font-style:normal">  include ':app', ':libraries:lib1', ':libraries:lib2'</font></div></blockquote><div><span style="line-height:1.6;font-size:10pt">它定义了哪个文件夹实际上是一个 Gradle 项目。</span></div><div><br>该<font color="#38761d" face="courier new, monospace"><b>:app</b></font>项目可能依赖于libraries，这是通过声明如下的依赖关系来配置的：<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace"><span style="line-height:1.6;font-size:10pt;font-style:normal">dependencies {</span></font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; compile project(':libraries:lib1')</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br>关于多项目设置的更多常用信息请参阅<a href="http://gradle.org/docs/current/userguide/multi_project_builds.html">这里</a>。<br><h3><a name="TOC-Library-projects"></a>库项目</h3></div><div>在上面的多项目的设置中，<span style="font-family:courier new,monospace"><b><font color="#38761d">:libraries:lib1</font></b></span>和<b style="font-family:courier new,monospace"><font color="#38761d">:libraries:lib2</font></b>可以是Java项目，而<b style="line-height:1.6;font-size:10pt;color:rgb(56,118,29);font-family:courier new,monospace">:app</b><span style="line-height:1.6;font-size:10pt"> Android项目将会使用到它们的<i>jar</i>包输出。</span></div><div><br>但是，如果你想共享访问了 Andr​​oid API或使用了 Android-style的资源的代码，这些库项目就不能是普通的Java项目，而应该是 Andr​​oid Library 项目。<br><h4><a name="TOC-Creating-a-Library-Project"></a>创建库项目</h4></div><div>Library项目与普通的 Android 项目非常相似，只有一些不同。<br><br>由于构建库项目与构建应用程序有些不同不同，所以使用的是不同的插件。这两个插件内部共享了大部分的相同的代码，并且它们都由同样的<font face="courier new, monospace">com.android.tools.build.gradle</font> jar 包提供。<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">buildscript {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; repositories {</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; mavenCentral()</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; dependencies {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; classpath 'com.android.tools.build:gradle:0.5.6'</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">apply plugin: 'android-library'</span></div><div><br></div><div><span style="font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; compileSdkVersion 15</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>上面的例子中创建了一个使用API​​ 15编译的库项目。<i>SourceSets</i>和依赖关系与它们在应用程序项目中的处理方式一样，并且支持同样方式的自定义。<br><h4><a name="TOC-Differences-between-a-Project-and-a-Library-Project"></a>普通项目和Library 项目之间的区别</h4></div><div>一个 Library 项目主要输出的是一个<i>.aar</i>包（它代表Android的归档文件）。它组合了编译代码（如一个jar文件或原生的.so文件）和资源（manifest，res，assets）。</div><div>一个库项目还可以生成测试apk，独立于应用程序测试这个库。</div><div><br>库项目用着同样的锚任务（<b><font color="#38761d" face="courier new, monospace" style="background-color:rgb(255,255,255)">assembleDebug</font></b>， <b> <font color="#38761d" face="courier new, monospace">assembleRelease</font></b>），所以构建这样一个项目的命令也没有任何区别。<br><br></div><div>对于其他的内容，库项目和应用程序项目的行为是一样的。。他们都有构建类型（build types）和产品定制（product flavors），并且都可以生成多个版本的aar。</div><div><div><span style="background-color:transparent;line-height:1.6;font-size:10pt">需要注意的是，</span><i style="background-color:transparent;line-height:1.6;font-size:10pt">Build Type</i><span style="background-color:transparent;line-height:1.6;font-size:10pt">的大部分配置都不适用库项目。但是，您可以根据一个库项目是否被其他项目使用还是被测试，使用自定义</span> <i style="background-color:transparent;line-height:1.6;font-size:10pt">sourceSet</i> <span style="background-color:transparent;line-height:1.6;font-size:10pt">来更改库项目的内容。</span></div></div><h4><a name="TOC-Referencing-a-Library"></a><span style="background-color:transparent;font-size:1.2em;line-height:1.6">引用一个库项目</span></h4><div>引用一个库库和引用其他任何项目的方法是一样的：<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">dependencies {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; compile project(':libraries:lib1')</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; compile project(':libraries:lib2')</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>注意： 如果您有多个库，那么排序将非常重要。这类似于旧的生成系统中， project.properties 文件的依赖项的顺序的重要性。<br><h4><a name="TOC-Library-Publication"></a><font size="3">库项目发布</font></h4></div><div>默认情况下，一个库项目只发布它的<i>release</i> variant。这variant将被所有引用该库的项目使用，无论那些项目构建的是哪种variant。这是由于 Gradle 限制而有的一个临时限制，我们正在努力消除这个问题。</div><div><br></div><div>您可以控制要发布哪一个variant&nbsp;</div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp;&nbsp;defaultPublishConfig "debug"</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">}</font></span></div></blockquote><div><br></div><div>注意，这个发布的配置名称引用的是完整的 variant 名称。<i>release</i>和<i>debug</i>，只在没有定义flavor时适用。如果你想在使用flavors时更改默认的发布variant，你可以这样写：</div><div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp;&nbsp;defaultPublishConfig "flavor1Debug"</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">}</font></span></div></blockquote><div><font face="arial, sans-serif"><br></font></div><font face="arial, sans-serif">发布一个库项目的所有variants也是可以做到的。我们正计划在正常的项目对项目（project-to-project）的依赖（如上面的例子）时也可以这样做，但现在因为 Gradle 的限制（我们也在努力修复这些问题)，还无法做到。</font></div><div><font face="arial, sans-serif">默认情况下没有启用发布所有variant。要启用它们可以这样做：<br></font><div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp;&nbsp;publishNonDefault true</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">}</font></span></div></blockquote><font face="courier new, monospace"><br></font></div></div><div><font face="arial, sans-serif">发布多个variants意味着发布多个aar文件，而不是发布一个包含多个variants的aar文件，能意识到这一点是非常重要的。每一个 aar 包都是包含一个单一的variant。</font></div><div><font face="arial, sans-serif">发布一个variant，意识着让这个可用的 aar 作为 Gradle 项目的输出文件。这个文件将会在发布到一个maven仓库中，或者另一个项目创建对这个项目依赖时用到。</font></div><div><font face="arial, sans-serif"><br></font></div><div><font face="arial, sans-serif">Gradle 有一个默认文件的概念。它就是在编写下面的代码时用到的：</font></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="font-family:courier new,monospace;font-style:normal">compile project(':libraries:lib2')</span></div></blockquote><div><font face="arial, sans-serif"><br></font></div><div><font face="arial, sans-serif">若要创建对一个项目的另一个已发布的文件的依赖，您需要指定使用哪一个：</font></div><div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">dependencies {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; flavor1Compile project(path: ':lib1', configuration: 'flavor1Release')</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; flavor2Compile project(path: ':lib1', configuration: 'flavor2Release')</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><font face="arial, sans-serif"><b><div><font face="arial, sans-serif"><b><br></b></font></div>重要说明：</b>注意已发布的配置是一个完整的variant，包括生成类型，并且需要像以上那样被引用。&nbsp;</font></div><div><b style="font-family:arial,sans-serif">重要说明：</b><span style="font-family:arial,sans-serif">当启用非默认的发布时，Maven 发布插件将把这些额外的variant作为额外的包（按分类器分类）发布。这意味着它对发布到一个 maven 仓库并不是真正的兼容。您应该只向一个仓库发布一个单一的 variant，或者是，为项目之间的依赖启用所有的发布配置。</span></div><div><h2><a name="TOC-Testing"></a>测试</h2></div><div>构建一个测试应用程序已经集成到应用程序项目中了。所以已经没有必要再去创建一个单独的测试项目。<br><h3><a name="TOC-Basics-and-Configuration"></a>基础知识和配置</h3></div><div>正如前面所提及，在<b><font color="#38761d" face="courier new, monospace">main</font></b> <i>sourceSet</i>旁边的是<b style="color:rgb(56,118,29);font-family:courier new,monospace">androidTest</b> <i>sourceSet</i>，默认情况下，它位于<font face="courier new, monospace">src /</font><span style="font-family:courier new,monospace">androidTest</span><font face="courier new, monospace">/</font><br><span style="line-height:1.6;font-size:10pt">从这里的</span> <i style="line-height:1.6;font-size:10pt">sourceSet</i> <span style="line-height:1.6;font-size:10pt">构建出来的是一个测试的apk，它可以部署到设备上，使用 Android 的测试框架去测试应用程序。它可以包含单元测试、 instrumentation 测试和后来的 uiautomator 测试。这个</span><br><span style="line-height:1.6;font-size:10pt"> <i style="line-height:1.6;font-size:10pt">SourceSet</i> </span><span style="line-height:1.6;font-size:10pt">不应该包含</span> <font face="courier new, monospace" style="line-height:1.6;font-size:10pt">AndroidManifest.xml</font> <span style="line-height:1.6;font-size:10pt"> ，因为它是会自动生成的。</span><br><br>下面是可以用来配置测试应用程序的几个值：<br><ul><li><span style="font-size:10pt;line-height:1.6"><font color="#38761d" face="courier new, monospace"><b>testPackageName</b></font></span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>testInstrumentationRunner</b></font></span></li><li><b style="color:rgb(56,118,29);font-family:courier new,monospace;font-size:10pt;line-height:1.6;background-color:transparent"><p style="display:inline!important">testHandleProfiling</p></b></li><li><b style="background-color:transparent;line-height:1.6;font-size:10pt;color:rgb(56,118,29);font-family:courier new,monospace"><p style="display:inline!important">testFunctionalTest</p></b></li></ul>正如前面所看到的，它们在<font color="#38761d" face="courier new, monospace"><b>defaultConfig</b></font>对象中配置：<br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; defaultConfig {</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; testPackageName "com.test.foo"</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; testInstrumentationRunner "android.test.InstrumentationTestRunner"</span></div><div><span style="background-color:transparent;line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; testHandleProfiling true</font></span></div>
<div><span style="font-style:normal"><font face="courier new, monospace"><span style="background-color:transparent;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="background-color:transparent;line-height:1.6;font-size:10pt">testFunctionalTest true</span></font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>在测试程序里的manifest里的<font face="courier new, monospace">instrumentation</font>节点中，<font face="courier new, monospace">targetPackage</font>属性的值会自动设为被测试的应用程序的包名称，即使它通过<b style="color:rgb(56,118,29);font-family:courier new,monospace">defaultConfig</b>或<i>Build Type</i>对象自定义过。这是manifest 自动生成的原因之一。<br><br>此外，<i>sourceSet</i>可以配置自己的依赖。<br>默认情况下，应用程序和它自己的依赖都会被添加到测试应用程序的classpath中，但是也可以通过以下来扩展<br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace"><span style="line-height:1.6;font-size:10pt;font-style:normal">dependencies {</span></font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal">androidTest</span><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">Compile 'com.google.guava:guava:11.0.2'</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>这个测试程序是由<b><font color="#38761d" face="courier new, monospace">assembleTest</font></b>任务构建的。它不是main里的<b><font color="#38761d" face="courier new, monospace">assemble</font></b>任务的依赖项，当设置测试运行时它不会被自动调用。<br><br>目前只有一种<i>Build Type</i>会进行测试。默认情况下是<b><font color="#38761d" face="courier new, monospace">debug</font></b><i>Build Type</i>，但它可以被重新配置： <br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace"><span style="line-height:1.6;font-size:10pt;font-style:normal">android {</span></font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; ...</span></div><div><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">&nbsp; &nbsp; testBuildType  "staging"</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><h3><a name="TOC-Running-tests"></a>运行测试</h3><div>正如前面提到的，通过锚任务 <b style="background-color:transparent;line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace">connectedCheck</font></b>运行的检查，需要一个已连接的设备<span style="background-color:transparent;line-height:1.6;font-size:10pt">。</span></div><div><span style="line-height:1.6;font-size:10pt">它依赖于任务</span><b style="color:rgb(56,118,29);font-family:courier new,monospace">androidTest</b><span style="line-height:1.6;font-size:10pt">，因此将运行&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">androidTest</b>。该任务执行以下操作：</span><br><ul><li><span style="line-height:1.6;font-size:10pt">确保应用程序和测试应用程序都被构建 （依赖于</span> <b style="line-height:1.6;font-size:10pt"> <font color="#38761d" face="courier new, monospace">assembleDebug</font> </b> <span style="line-height:1.6;font-size:10pt">和</span> <b style="line-height:1.6;font-size:10pt"> <font color="#38761d" face="courier new, monospace">assembleTest</font></b><span style="line-height:1.6;font-size:10pt">)</span></li><li><span style="line-height:1.6;font-size:10pt">安装这两个应用程序</span></li><li><span style="line-height:1.6;font-size:10pt">运行测试</span></li><li><span style="line-height:1.6;font-size:10pt">卸载这两个应用程序。</span></li></ul>如果连接了多个设备，所有的测试都会并行运行在所有连接的设备上。<span style="line-height:1.6;font-size:10pt">如果任何一个设备的其中一项测试失败，那么整个构建都将失败。</span><br><br>所有测试结果都会保存为 XML 文件，路径为 <br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><font face="courier new, monospace">  build/androidTest-results</font></div></blockquote><div>（这类似于 jUnit 定期运行的结果保存在 build/text-result 下面）<br><br>它可以通过以下方式来配置 <br>配置<br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; ...</span></div><div><br></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; testOptions {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; resultsDir = "$project.buildDir/foo/results"</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div><b> <font color="#38761d" face="courier new, monospace">Android.testOptions.resultsDir</font></b>的值将通过<b><font color="#38761d" face="courier new, monospace">Project.file(String)</font> 获得</b><br><h3><a name="TOC-Testing-Android-Libraries"></a>测试 Android Libraries</h3></div><div>测试 Android Library项目与测试应用程序项目的方式完全一样。<br><br>唯一的区别是整个库 （和它的依赖项） 会自动作为Library依赖添加到测试应用程序中。结果就是测试 APK 不只包含其自己的代码，还包括测试库以及测试库的所有依赖项。<br>这个Library的manifest 会合并到测试应用程序的manifest中（如引用此Library的任何项目）。<br><br> <b style="color:rgb(56,118,29);font-family:courier new,monospace">AndroidTest</b>任务改为仅安装 （以及卸载）测试 APK  （因为没有其他的 APK 要安装）<br><br>其他的都是相同的。</div><div><h3><a name="TOC-Test-reports"></a>测试报告</h3></div><div>当运行单元测试时，Gradle 会输出 HTML 报告，以方便查看结果。<br><span style="line-height:1.6;font-size:10pt">Android 插件在此基础上扩展了 HTML 报告，它聚合了所有连接的设备的测试结果。</span><br><h4><a name="TOC-Single-projects"></a>单个项目的报告 </h4></div><div>这个测试报告的项目会在运行测试时自动生成。它的默认位置是<br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace"> build/reports/</font></span><span style="font-family:courier new,monospace;font-style:normal">androidTest</span><span style="font-style:normal"><font face="courier new, monospace">s</font></span></div></blockquote><div><br>它类似于 jUnit 报告的位置<font face="courier new, monospace">build/reports/tests</font>，或其他通常位于<font face="courier new, monospace">build/reports/&lt;plugin&gt;/</font>的报告。<br><br>这个位置可以通过以下方式自定义 <br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; ...</span></div><div><br></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; testOptions {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; reportDir = "$project.buildDir/foo/report"</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div>该报告将聚合在不同的设备运行的测试。<br><h4><a name="TOC-Multi-projects-reports"></a>多项目报告</h4></div><div>在一个设置了一个或多个application和 library 项目的多项目中，当同时运行所有的测试，为所有测试生成单个报告可能是非常有用的。<br><br>要做到这一点，需要使用同一个文件中的另一个插件。这个插件可以如下配置： <br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace"><span style="line-height:1.6;font-size:10pt;font-style:normal">buildscript {</span></font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; repositories {</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; mavenCentral()</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><font face="courier new, monospace" style="font-style:normal"><br></font></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp; &nbsp; dependencies {</font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; classpath 'com.android.tools.build:gradle:0.5.6'</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div><div><br></div><div><font face="courier new, monospace" style="font-style:normal">apply plugin: 'android-reporting'</font></div></blockquote><div><br></div><div>这个插件应该在根项目中配置使用，即在 <i>settings.gradle</i>同级目录的<i>build.gradle</i>中。<br><br>然后在根文件夹中，下面的命令就可以运行所有的测试并聚合测试报告： <br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">  gradle deviceCheck mergeAndroidReports --continue</font></span></div></blockquote><div><br>注： <font face="courier new, monospace">--continue</font>选项确保所有子项目的测试都会被运行，即使其中的一个子项目的测试失败了。如果不加上这个选项，第一个失败的测试将会中断所有测试的运行，这可能导致有些项目还没有执行它们的测试。<br><h3><a name="TOC-Lint-support"></a>Lint 支持</h3></div><div>从 0.7.0 版本起，您可以为一个指定的variant或所有的variants 运行lint，在这种情况下，它会生成一个报告，描述每一个给定的问题都存在于哪些指定的variants 。</div><div><br></div><div>您可以通过添加以下的一个 lintOptions 节点对lint进行配置。通常，您只需要指定其中的几个 ；以下列出了所有可用的选项。</div><div><br></div><div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">android {</font></span></div></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6;background-color:transparent">&nbsp; &nbsp; lintOptions {</span></div></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace"><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// 设置为 true时lint将不报告分析的进度</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; quiet true</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// 如果为 true，则当lint发现错误时停止 gradle构建</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; abortOnError false</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// 如果为 true，则只报告错误</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; ignoreWarnings true</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// 如果为 true，则当有错误时会显示文件的全路径或绝对路径 (默认情况下为true) </div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; //absolutePaths true</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// 如果为 true，则检查所有的问题，包括默认不检查问题</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; checkAllWarnings true</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// 如果为 true，则将所有警告视为错误</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; warningsAsErrors true</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// 不检查给定的问题id</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; disable 'TypographyFractions','TypographyQuotes'</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// 检查给定的问题 id</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; enable 'RtlHardcoded','RtlCompat', 'RtlEnabled'</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>//  * 仅 * 检查给定的问题 id</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; check 'NewApi', 'InlinedApi'</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// 如果为true，则在错误报告的输出中不包括源代码行</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; noLines true</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// 如果为 true，则对一个错误的问题显示它所在的所有地方，而不会截短列表，等等。</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; showAll true</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// 重置 lint 配置（使用默认的严重性等设置）。</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; lintConfig file("default-lint.xml")</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// 如果为 true，生成一个问题的纯文本报告（默认为false）</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; textReport true</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// 配置写入输出结果的位置；它可以是一个文件或 “stdout”（标准输出）</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; textOutput 'stdout'</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// 如果为真，会生成一个XML报告，以给Jenkins之类的使用</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; xmlReport false</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// 用于写入报告的文件（如果不指定，默认为lint-results.xml）</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; xmlOutput file("lint-report.xml")</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// 如果为真，会生成一个HTML报告（包括问题的解释，存在此问题的源码，等等）</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; htmlReport true</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// 写入报告的路径，它是可选的（默认为构建目录下的 lint-results.html ）</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; htmlOutput file("lint-report.html")</div><div style="font-style:normal"><br></div><div style="font-style:normal"><blockquote style="font-family:Arial,Verdana,sans-serif;font-size:21px;line-height:34.133331298828125px;margin:0px 0px 0px 40px;border:none;padding:0px"><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp;// 设置为 true， 将使所有release 构建都以issus的严重性级别为fatal（severity=false）的设置来运行lint </span></font></blockquote><blockquote style="font-family:Arial,Verdana,sans-serif;font-size:21px;line-height:34.133331298828125px;margin:0px 0px 0px 40px;border:none;padding:0px"><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp;// 并且，如果发现了致命（fatal）的问题，将会中止构建（由上面提到的 abortOnError 控制）</span></font></blockquote><blockquote style="font-family:Arial,Verdana,sans-serif;font-size:21px;line-height:34.133331298828125px;margin:0px 0px 0px 40px;border:none;padding:0px"><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp;checkReleaseBuilds true</span></font></blockquote><div style="font-family:Arial,Verdana,sans-serif;font-size:21px;font-style:italic;line-height:34.133331298828125px"><div><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp; &nbsp; &nbsp; // 设置给定问题的严重级别（severity）为fatal （这意味着他们将会</span></font></div><div><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp; &nbsp; &nbsp; // 在release构建的期间检查 （即使 lint 要检查的问题没有包含在代码中)</span></font></div><div><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp; &nbsp; &nbsp; fatal 'NewApi', 'InlineApi'</span></font></div><div><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp; &nbsp; &nbsp; // 设置给定问题的严重级别为error</span></font></div><div><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp; &nbsp; &nbsp; error 'Wakelock', 'TextViewEdits'</span></font></div><div><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp; &nbsp; &nbsp; // 设置给定问题的严重级别为warning</span></font></div><div><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp; &nbsp; &nbsp; warning 'ResourceAsColor'</span></font></div><div><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp; &nbsp; &nbsp; // 设置给定问题的严重级别（severity）为ignore （和不检查这个问题一样）</span></font></div><div><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp; &nbsp; &nbsp; ignore 'TypographyQuotes'</span></font></div><div><span style="font-style:normal;font-family:courier new,monospace;font-size:10pt;line-height:1.6;background-color:transparent">&nbsp; &nbsp; }</span></div></div></div></font></span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6;background-color:transparent">}</span></div></blockquote><h2><a name="TOC-Build-Variants"></a>Build Variants</h2></div><div>新的构建系统的目标之一是可以创建同一个程序的不同版本。<br><br>这里有两个主要的使用场景：<br><ol><li><span style="line-height:1.6;font-size:10pt">同一应用程序的不同版本 <br></span><span style="font-size:10pt;line-height:1.6">例如，一个应用的免费/演示版本 和“专业”付费版本。</span></li><li><span style="line-height:1.6;font-size:10pt">为了在Google Play Store发布同一个程序的多个APK，而使用不同的包名。<br></span><span style="line-height:1.6;font-size:10pt">请参阅 </span> <a href="http://developer.android.com/google/play/publishing/multiple-apks.html" style="line-height:1.6;font-size:10pt">http://developer.android.com/google/play/publishing/multiple-apks.html</a> <span style="line-height:1.6;font-size:10pt">以获取更多详细信息。</span></li><li><span style="line-height:1.6;font-size:10pt">综合了1和2 两种情况&nbsp;</span></li></ol>这个目标就是要让从同一个项目生成这些不同的APK成为可能，而不是使用一个单独的类库项目和两个以上的应用程序项目中来生成。<br><h3><a name="TOC-Product-flavors"></a>Product flavors</h3></div><div>一个product flavor 定义了由一个项目构建的应用程序的自定义版本。单个项目可以有不同的flavors来改变生成的应用程序。<br><br>这个新概念的设计是为了解决不同版本之间差异很小的情况。如果“这是同一个应用程序吗？”的答案是肯定回答，那么把它转为Library Project的做法也是可以的。<br><br>Product flavors使用<b><font color="#38761d" face="courier new, monospace">productFlavors</font> </b> DSL 容器来声明： <br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace" style="font-style:normal">android {</font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; ....</span></div><div><font face="courier new, monospace" style="font-style:normal"><br></font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; productFlavors {</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; flavor1 {</span></div><div><font face="courier new, monospace"><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...</span></font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt"><br></span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; flavor2 {</span></div><div><font face="courier new, monospace"><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...</span></font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>This creates two flavors, called <font color="#38761d" face="courier new, monospace"><b>flavor1</b></font> and&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">flavor2</b>.<br>Note: The name of the flavors cannot collide with existing <i>Build Type</i> names, or with the&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">androidTest</b>&nbsp;<i>sourceSet</i>.<br><h3><a name="TOC-Build-Type-Product-Flavor-Build-Variant"></a>Build Type + Product Flavor = Build Variant</h3></div><div>As we have seen before, each <i>Build Type</i> generates a new APK.<br><br><i>Product Flavors</i> do the same:&nbsp;the output of the project becomes all possible combinations of <i>Build Types</i> and, if applicable, <i>Product Flavors</i>.<br><br>Each (<i>Build Type</i>, <i>Product Flavor</i>) combination is called a <i>Build Variant</i>.<br><br>For instance, with the default <b><font color="#38761d" face="courier new, monospace">debug</font></b> and <b><font color="#38761d" face="courier new, monospace">release</font></b> <i>Build Types</i>, the above example generates four <i>Build Variants</i>:<br><ul><li><span style="font-size:10pt;line-height:1.6">Flavor1 - debug</span></li><li><span style="line-height:1.6;font-size:10pt">Flavor1 - release</span></li><li><span style="line-height:1.6;font-size:10pt">Flavor2 - debug</span></li><li><span style="line-height:1.6;font-size:10pt">Flavor2 - release</span></li></ul>Projects with no flavors still have <i>Build Variants</i>, but the single <font color="#38761d" face="courier new, monospace"><b>default</b></font> flavor/config is used, nameless, making the list of variants similar to the list of <i>Build Types</i>.<br><h3><a name="TOC-Product-Flavor-Configuration"></a>Product Flavor Configuration</h3></div><div>Each flavors is configured with a closure:<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace" style="font-style:normal">android {</font></div><div><font face="courier new, monospace"><span style="font-style:normal">&nbsp; &nbsp; ...</span></font></div><div><font face="courier new, monospace" style="font-style:normal"><br></font></div><div><span style="font-style:normal;line-height:1.6;font-size:10pt"><font face="courier new, monospace">&nbsp; &nbsp; defaultConfig {</font></span></div><div><span style="font-style:normal;line-height:1.6;font-size:10pt"><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; minSdkVersion 8</font></span></div><div><span style="font-style:normal;line-height:1.6;font-size:10pt"><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; versionCode 10</font></span></div><div><span style="font-style:normal;line-height:1.6;font-size:10pt"><font face="courier new, monospace">&nbsp; &nbsp; }</font></span></div><div><font face="courier new, monospace" style="font-style:normal"><br></font></div><div><span style="font-style:normal;line-height:1.6;font-size:10pt"><font face="courier new, monospace">&nbsp; &nbsp; productFlavors {</font></span></div><div><span style="font-style:normal;line-height:1.6;font-size:10pt"><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; flavor1 {</font></span></div><div><span style="font-style:normal;line-height:1.6;font-size:10pt"><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; packageName "com.example.flavor1"</font></span></div><div><font face="courier new, monospace"><span style="line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="font-style:normal;line-height:1.6;font-size:10pt">versionCode 20</span></font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt"><br></span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; flavor2 {</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; packageName "com.example.flavor2"</span></div><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></span><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">minSdkVersion 14</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>Note that the <font color="#38761d" face="courier new, monospace"><b>android.productFlavors.*</b></font> objects are of type <i>ProductFlavor</i> which is the same type as the <font color="#38761d" face="courier new, monospace"><b>android.defaultConfig</b></font> object. This means they share the same properties.<br><br><font color="#38761d" face="courier new, monospace"><b>defaultConfig</b></font> provides the base configuration for all flavors and each flavor can override any value. In the example above, the configurations end up being:<br><br><ul><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>flavor1</b></font></span></li><ul><li><span style="line-height:1.6;font-size:10pt"><b><font color="#38761d" face="courier new, monospace">packageName</font></b>: com.example.flavor1</span></li><li><span style="line-height:1.6;font-size:10pt"><b><font color="#38761d" face="courier new, monospace">minSdkVersion</font></b>: 8</span></li><li><span style="line-height:1.6;font-size:10pt"><b><font color="#38761d" face="courier new, monospace">versionCode</font></b>: 20</span></li></ul><li><b style="color:rgb(56,118,29);font-family:courier new,monospace">flavor2</b></li><ul><li><span style="line-height:1.6;font-size:10pt"><b><font color="#38761d" face="courier new, monospace">packageName</font></b>: com.example.flavor2</span></li><li><span style="line-height:1.6;font-size:10pt"><b><font color="#38761d" face="courier new, monospace">minSdkVersion</font></b>: 14</span></li><li><span style="line-height:1.6;font-size:10pt"><b><font color="#38761d" face="courier new, monospace">versionCode</font></b>: 10</span></li></ul></ul>Usually, the <i>Build Type</i> configuration is an overlay over the other configuration. For instance, the <i>Build Type</i>'s&nbsp;<b><font color="#38761d" face="courier new, monospace">packageNameSuffix</font></b>&nbsp;is appended to the <i>Product Flavor</i>'s&nbsp;<b><font color="#38761d" face="courier new, monospace">packageName</font></b>.<br><br>There are cases where a setting is settable on both the <i>Build Type</i> and the <i>Product Flavor</i>. In this case, it’s is on a case by case basis.<br><br>For instance,&nbsp;<b><font color="#38761d" face="courier new, monospace">signingConfig</font></b> is one of these properties.<br>This enables either having all release packages share the same S<i>igningConfig</i>, by setting <font color="#38761d" face="courier new, monospace"><b>android.buildTypes.release.signingConfig</b></font>, or have each release package use their own S<i>igningConfig</i> by setting each <font color="#38761d" face="courier new, monospace"><b>android.productFlavors.*.signingConfig</b></font> objects separately.<br><h3><a name="TOC-Sourcesets-and-Dependencies"></a>Sourcesets and Dependencies</h3></div><div>Similar to <i>Build Types</i>, <i>Product Flavors</i> also contribute code and resources through their own <i>sourceSets</i>.<br><br>The above example creates four <i>sourceSets</i>:<br><ul><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>android.sourceSets.flavor1</b></font><br></span><span style="font-size:10pt;line-height:1.6">Location <font face="courier new, monospace">src/flavor1/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">android.sourceSets.flavor2</b><br></span><span style="font-size:10pt;line-height:1.6">Location <font face="courier new, monospace">src/flavor2/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">android.sourceSets.<b>androidTest</b>Flavor1</b><br></span><span style="font-size:10pt;line-height:1.6">Location <font face="courier new, monospace">src/androidTestFlavor1/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">android.sourceSets.<b>androidTest</b>Flavor2</b><br></span><span style="font-size:10pt;line-height:1.6">Location <font face="courier new, monospace">src/androidTestFlavor2/</font></span></li></ul>Those <i>sourceSets</i> are used to build the APK, alongside <font color="#38761d" face="courier new, monospace"><b>android.sourceSets.main</b></font> and the <i>Build Type sourceSet</i>.<br><br>The following rules are used when dealing with all the sourcesets used to build a single APK:<br><ul><li><span style="font-size:10pt;line-height:1.6">All source code (<font face="courier new, monospace">src/*/java</font>) are used together as multiple folders generating a single output.</span></li><li><span style="line-height:1.6;font-size:10pt">Manifests are all merged together into a single manifest. This allows <i>Product Flavors</i> to have different components and/or permissions, similarly to <i>Build Types</i>.</span></li><li><span style="line-height:1.6;font-size:10pt">All resources (Android res and assets) are used using overlay priority where the <i>Build Type</i> overrides the <i>Product Flavor</i>, which overrides the <font color="#38761d" face="courier new, monospace"><b>main</b></font> <i>sourceSet</i>.</span></li><li><span style="line-height:1.6;font-size:10pt">Each <i>Build Variant</i>&nbsp;generates its own R class (or other generated source code) from the resources. Nothing is shared between variants.</span></li></ul><br></div><div>Finally, like <i>Build Types</i>, <i>Product Flavors</i> can have their own dependencies. For instance, if the flavors are used to generate a ads-based app and a paid app, one of the flavors could have a dependency on an Ads SDK, while the other does not.<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace" style="font-style:normal">dependencies {</font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; flavor1Compile "..."</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div>In this particular case, the file <font face="courier new, monospace">src/flavor1/AndroidManifest.xml</font> would probably need to include the internet permission.</div><div><br></div><div>Additional sourcesets are also created for each variants:</div><div><ul><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>android.sourceSets.flavor1Debug</b></font><br></span><span style="font-size:10pt;line-height:1.6">Location&nbsp;<font face="courier new, monospace">src/flavor1Debug/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>android.sourceSets.flavor1Release</b></font><br></span><span style="font-size:10pt;line-height:1.6">Location&nbsp;<font face="courier new, monospace">src/flavor1Release/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>android.sourceSets.flavor2Debug</b></font><br></span><span style="font-size:10pt;line-height:1.6">Location&nbsp;<font face="courier new, monospace">src/flavor2Debug/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>android.sourceSets.flavor2Release</b></font><br></span><span style="font-size:10pt;line-height:1.6">Location&nbsp;<font face="courier new, monospace">src/flavor2Release/</font></span></li></ul><div><font face="arial, sans-serif">These have higher priority than the build type sourcesets, and allow customization at the variant level.</font></div><h3><a name="TOC-Building-and-Tasks"></a>Building and Tasks</h3></div><div>We previously saw that each <i>Build Type</i> creates its own <font face="courier new, monospace">assemble&lt;name&gt;</font> task, but that <i>Build Variants</i> are a combination of <i>Build Type</i> and <i>Product Flavor</i>.<br><br>When <i>Product Flavors</i> are used, more assemble-type tasks are created. These are:<br><ol><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">assemble&lt;Variant Name&gt;</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">assemble&lt;Build Type Name&gt;</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">assemble&lt;Product Flavor Name&gt;</font></span></li></ol>#1 allows directly building a single variant. For instance <font color="#38761d" face="courier new, monospace"><b>assembleFlavor1Debug</b></font>.<br><br>#2 allows building all APKs for a given Build Type. For instance&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">assembleDebug</b>&nbsp;will build both <font face="courier new, monospace">Flavor1Debug</font> and <font face="courier new, monospace">Flavor2Debug</font> variants.<br><br>#3 allows building all APKs for a given flavor. For instance&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">assembleFlavor1</b>&nbsp;will build both <font face="courier new, monospace">Flavor1Debug</font> and <font face="courier new, monospace">Flavor1Release</font> variants.<br><br>The task&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">assemble</b>&nbsp;will build all possible variants.<br><h3><a name="TOC-Testing1"></a>测试</h3>Testing multi-flavors project is very similar to simpler projects.<br><br>The&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">androidTest</b>&nbsp;sourceset is used for common tests across all flavors, while each flavor can also have its own tests.<br><br>As mentioned above, <i>sourceSets</i> to test each flavor are created:<br><ul><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">android.sourceSets.<b>androidTest</b>Flavor1</b><br></span><span style="font-size:10pt;line-height:1.6">Location&nbsp;<font face="courier new, monospace">src/androidTestFlavor1/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">android.sourceSets.<b>androidTest</b>Flavor2</b><br></span><span style="font-size:10pt;line-height:1.6">Location&nbsp;<font face="courier new, monospace">src/androidTestFlavor2/</font></span></li></ul><br>Similarly, those can have their own dependencies:<br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">dependencies {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal">androidTest</span><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">Flavor1Compile "..."</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>Running the tests can be done through the main <font color="#38761d" face="courier new, monospace"><b>deviceCheck</b></font> anchor task, or the main&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">androidTest</b>&nbsp;tasks which acts as an anchor task when flavors are used.<br><br>Each flavor has its own task to run tests:&nbsp;<span style="font-family:courier new,monospace">androidTest</span><font face="courier new, monospace">&lt;VariantName&gt;</font>. For instance:<br><ul><li><span style="font-size:10pt;line-height:1.6"><font color="#38761d" face="courier new, monospace"><b><b>androidTest</b>Flavor1Debug</b></font></span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b><b>androidTest</b>Flavor2Debug</b></font></span></li></ul>Similarly, test APK building tasks and install/uninstall tasks are per variant:<br><ul><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>assembleFlavor1Test</b></font></span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>installFlavor1Debug</b></font></span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>installFlavor1Test</b></font></span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>uninstallFlavor1Debug</b></font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">...</font></span></li></ul>Finally the HTML report generation supports aggregation by flavor.<br>The location of the test results and reports is as follows, first for the per flavor version, and then for the aggregated one:<br><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">build/androidTest-results/flavors/&lt;FlavorName&gt;</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">build/androidTest-results/all/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">build/reports/androidTests/flavors&lt;FlavorName&gt;</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">build/reports/androidTests/all/</font></span></li></ul>Customizing either path, will only change the root folder and still create sub folders per-flavor and aggregated results/reports.<br><h3><a name="TOC-Multi-flavor-variants"></a>Multi-flavor variants</h3></div><div>In some case, one may want to create several versions of the same apps based on more than one criteria.<br>For instance, multi-apk support in Google Play supports 4 different filters. Creating different APKs split on each filter requires being able to use more than one dimension of <i>Product Flavors</i>.<br><br>Consider the example of a game that has a demo and a paid version and wants to use the ABI filter in the multi-apk support. With 3 ABIs and two versions of the application, 6 APKs needs to be generated (not counting the variants introduced by the different <i>Build Types</i>).<br>However, the code of the paid version is the same for all three ABIs, so creating simply 6 flavors is not the way to go.<br>Instead, there are two dimensions of flavors, and variants should automatically build all possible combinations.<br><br>This feature is implemented using Flavor Dimensions. Flavors are assigned to a specific dimension<br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; ...</font></span></div><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; flavorDimensions "abi", "version"</span></div><div><br></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; productFlavors {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; freeapp {</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flavorDimension "version"</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; x86 {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal;line-height:21.3333320617676px">flavorDimension</span><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp;"abi"</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>The <b><font color="#38761d" face="courier new, monospace">android.flavorDimensions</font></b>&nbsp;array defines the possible dimensions, as well as the order. Each defined <i>Product Flavor</i> is assigned to a dimension.<br><br>From the following dimensioned&nbsp;<i>Product Flavors</i> [freeapp, paidapp] and [x86, arm, mips] and the [debug, release] <i>Build Types</i>, the following build variants will be created:<br><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">x86-freeapp-debug</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">x86-freeapp-release</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">arm-freeapp-debug</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">arm-freeapp-release</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">mips-freeapp-debug</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">mips-freeapp-release</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">x86-paidapp-debug</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">x86-paidapp-release</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">arm-paidapp-debug</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">arm-paidapp-release</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">mips-paidapp-debug</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">mips-paidapp-release</font></span></li></ul>The order of the dimension as defined by&nbsp;<b><font color="#38761d" face="courier new, monospace">android.flavorDimensions&nbsp;</font></b>is very important.<br><br>Each variant is configured by several <i>Product Flavor</i> objects:<br><ul><li><span style="font-size:10pt;line-height:1.6"><font color="#38761d" face="courier new, monospace"><b>android.defaultConfig</b></font></span></li><li><span style="line-height:1.6;font-size:10pt">One from the abi dimension</span></li><li><span style="line-height:1.6;font-size:10pt">One from the version dimension</span></li></ul>The order of the dimension drives which flavor override the other, which is important for resources when a value in a flavor replaces a value defined in a lower priority flavor.<br><span style="line-height:1.6;font-size:10pt">The flavor dimension is defined with higher priority first. So in this case:</span><br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">abi &gt; version &gt; defaultConfig</font></span></div></blockquote><div><br></div><div>Multi-flavors projects also have additional sourcesets, similar to the variant sourcesets but without the build type:</div><div><br></div><div><ul><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>android.sourceSets.x86Freeapp</b></font><br></span><span style="font-size:10pt;line-height:1.6">Location&nbsp;<font face="courier new, monospace">src/x86Freeapp/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>android.sourceSets.armPaidapp</b></font><br></span><span style="font-size:10pt;line-height:1.6">Location&nbsp;<font face="courier new, monospace">src/armPaidapp/</font></span></li><li><font face="arial, sans-serif">etc...</font></li></ul></div><div>These allow customization at the flavor-combination level. They have higher priority than the basic flavor sourcesets, but lower priority than the build type sourcesets.</div><div><h2><a name="TOC-Advanced-Build-Customization"></a>Advanced Build Customization</h2><h3><a name="TOC-Build-options"></a>Build options</h3><h4><a name="TOC-Java-Compilation-options"></a>Java Compilation options</h4></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace" style="font-style:normal">android {</font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; compileOptions {</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; sourceCompatibility = "1.6"</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; targetCompatibility = "1.6"</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div>Default value is “1.6”. This affect all tasks compiling Java source code.<br><br><h4><a name="TOC-aapt-options"></a>aapt options</h4></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace" style="font-style:normal">android {</font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; aaptOptions {</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; noCompress 'foo', 'bar'</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; ignoreAssetsPattern "!.svn:!.git:!.ds_store:!*.scc:.*:&lt;dir&gt;_*:!CVS:!thumbs.db:!picasa.ini:!*~"</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>This affects all tasks using <font face="courier new, monospace">aapt</font>.</div><div><h4><a name="TOC-dex-options"></a>dex options</h4></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace" style="font-style:normal">android {</font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; dexOptions {</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; incremental false</span></div></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt"><span>&nbsp;&nbsp; &nbsp;<span>&nbsp; &nbsp; preDexLibraries = false</span></span><br></span></div></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt"><span><span><span>&nbsp;&nbsp; &nbsp;<span>&nbsp; &nbsp; jumboMode = false</span></span><br></span></span></span></div></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div>This affects all tasks using dex.<br><h3><a name="TOC-Manipulating-tasks"></a>Manipulating tasks</h3></div><div>Basic Java projects have a finite set of tasks that all work together to create an output.<br>The <font color="#38761d" face="courier new, monospace"><b>classes</b></font> task is the one that compile the Java source code.<br>It’s easy to access from <i>build.gradle</i> by simply using&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">classes</b>&nbsp;in a script. This is a shortcut for <font color="#38761d" face="courier new, monospace"><b>project.tasks.classes</b></font>.<br><br>In Android projects, this is a bit more complicated because there could be a large number of the same task and their name is generated based on the <i>Build Types</i> and <i>Product Flavors</i>.<br><br>In order to fix this, the <b><font color="#38761d" face="courier new, monospace">android</font></b> object has two properties:<br><ul><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>applicationVariants</b></font></span> (only for the app plugin)</li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>libraryVariants</b></font></span>&nbsp;(only for the library plugin)</li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>testVariants</b></font></span>&nbsp;(for both plugins)</li></ul>All three return a <a href="http://www.gradle.org/docs/current/javadoc/org/gradle/api/DomainObjectCollection.html">DomainObjectCollection</a> of&nbsp;<font face="courier new, monospace">ApplicationVariant</font>, <font face="courier new, monospace">LibraryVariant</font>, and <font face="courier new, monospace">TestVariant</font> objects respectively.<br><br>Note that accessing any of these collections will trigger the creations of all the tasks. This means no (re)configuration should take place after accessing the collections.<br><br>The <font face="courier new, monospace">DomainObjectCollection</font> gives access to all the objects directly, or through filters which can be convenient.<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace"><span style="line-height:1.6;font-size:10pt;font-style:normal">android.applicationVariants.each { variant -&gt;</span></font></div><div><font face="courier new, monospace"><span style="font-style:normal">&nbsp; &nbsp; ....</span></font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>All three variant classes share the following properties:<br><br><table border="1" bordercolor="#888" cellspacing="0" style="border-collapse:collapse;border-color:rgb(136,136,136);border-width:1px"><tbody><tr><td style="width:180px;height:19px">&nbsp;属性名称</td><td style="width:173px;height:19px">&nbsp;Property Type</td><td style="width:461px;height:19px">&nbsp;Description</td></tr><tr><td style="width:180px;height:19px">&nbsp;name</td><td style="width:173px;height:19px">&nbsp;String</td><td style="width:461px;height:19px">&nbsp;The name of the variant. Guaranteed to be unique.</td></tr><tr><td style="width:180px;height:19px">&nbsp;description</td><td style="width:173px;height:19px">&nbsp;String</td><td style="width:461px;height:19px">&nbsp;Human readable description of the variant.</td></tr><tr><td style="width:180px;height:19px">&nbsp;dirName</td><td style="width:173px;height:19px">&nbsp;String</td><td style="width:461px;height:19px">&nbsp;subfolder name for the variant. Guaranteed to be unique. Maybe more than one folder, ie “debug/flavor1”</td></tr><tr><td style="width:180px;height:19px">&nbsp;baseName</td><td style="width:173px;height:19px">&nbsp;String</td><td style="width:461px;height:19px">&nbsp;Base name of the output(s) of the variant. Guaranteed to be unique.</td></tr><tr><td style="width:180px;height:19px">&nbsp;outputFile</td><td style="width:173px;height:19px">&nbsp;File</td><td style="width:461px;height:19px">&nbsp;The output of the variant. This is a read/write property</td></tr><tr><td style="width:180px;height:19px">&nbsp;processManifest</td><td style="width:173px;height:19px">&nbsp;ProcessManifest</td><td style="width:461px;height:19px">&nbsp;The task that processes the manifest.</td></tr><tr><td style="width:180px;height:19px">&nbsp;aidlCompile</td><td style="width:173px;height:19px">&nbsp;AidlCompile</td><td style="width:461px;height:19px">&nbsp;The task that compiles the AIDL files.</td></tr><tr><td style="width:180px;height:19px">&nbsp;renderscriptCompile</td><td style="width:173px;height:19px">&nbsp;RenderscriptCompile</td><td style="width:461px;height:19px">&nbsp;The task that compiles the Renderscript files.</td></tr><tr><td style="width:180px;height:19px">&nbsp;mergeResources</td><td style="width:173px;height:19px">&nbsp;MergeResources</td><td style="width:461px;height:19px">&nbsp;The task that merges the resources.</td></tr><tr><td style="width:180px;height:19px">&nbsp;mergeAssets</td><td style="width:173px;height:19px">&nbsp;MergeAssets</td><td style="width:461px;height:19px">&nbsp;The task that merges the assets.</td></tr><tr><td style="width:180px;height:19px">&nbsp;processResources</td><td style="width:173px;height:19px">&nbsp;ProcessAndroidResources</td><td style="width:461px;height:19px">&nbsp;The task that processes and compile the Resources.</td></tr><tr><td style="width:180px;height:19px">&nbsp;generateBuildConfig</td><td style="width:173px;height:19px">&nbsp;GenerateBuildConfig</td><td style="width:461px;height:19px">&nbsp;The task that generates the BuildConfig class.</td></tr><tr><td>&nbsp;javaCompile</td><td>&nbsp;JavaCompile</td><td>&nbsp;The task that compiles the Java code.</td></tr><tr><td>&nbsp;processJavaResources</td><td>&nbsp;Copy</td><td>&nbsp;The task that process the Java resources.</td></tr><tr><td>&nbsp;assemble</td><td>&nbsp;DefaultTask</td><td>&nbsp;The assemble anchor task for this variant.</td></tr></tbody></table><br>The <font face="courier new, monospace">ApplicationVariant</font> class adds the following:<br><br><table border="1" bordercolor="#888" cellspacing="0" style="border-collapse:collapse;border-color:rgb(136,136,136);border-width:1px"><tbody><tr><td style="width:180px;height:19px">&nbsp;属性名称</td><td style="width:173px;height:19px">&nbsp;Property Type</td><td style="width:461px;height:19px">&nbsp;Description</td></tr><tr><td style="width:180px;height:19px">&nbsp;buildType</td><td style="width:173px;height:19px">&nbsp;BuildType</td><td style="width:461px;height:19px">&nbsp;The BuildType of the variant.</td></tr><tr><td style="width:180px;height:19px">&nbsp;productFlavors</td><td style="width:173px;height:19px">&nbsp;List&lt;ProductFlavor&gt;</td><td style="width:461px;height:19px">&nbsp;The ProductFlavors of the variant. Always non Null but could be empty.</td></tr><tr><td style="width:180px;height:19px">&nbsp;mergedFlavor</td><td style="width:173px;height:19px">&nbsp;ProductFlavor</td><td style="width:461px;height:19px">&nbsp;The merging of android.defaultConfig and variant.productFlavors</td></tr><tr><td style="width:180px;height:19px">&nbsp;signingConfig</td><td style="width:173px;height:19px">&nbsp;SigningConfig</td><td style="width:461px;height:19px">&nbsp;The SigningConfig object used by this variant</td></tr><tr><td style="width:180px;height:19px">&nbsp;isSigningReady</td><td style="width:173px;height:19px">&nbsp;boolean</td><td style="width:461px;height:19px">&nbsp;true if the variant has all the information needed to be signed.</td></tr><tr><td style="width:180px;height:19px">&nbsp;testVariant</td><td style="width:173px;height:19px">&nbsp;BuildVariant</td><td style="width:461px;height:19px">&nbsp;The TestVariant that will test this variant.</td></tr><tr><td>&nbsp;dex</td><td>&nbsp;Dex</td><td>&nbsp;The task that dex the code. Can be null if the variant is a library.</td></tr><tr><td>&nbsp;packageApplication</td><td>&nbsp;PackageApplication</td><td>&nbsp;The task that makes the final APK. Can be null if the variant is a library.</td></tr><tr><td>&nbsp;zipAlign</td><td>&nbsp;ZipAlign</td><td>&nbsp;The task that zipaligns the apk. Can be null if the variant is a library or if the APK cannot be signed.</td></tr><tr><td style="width:180px;height:19px">&nbsp;install</td><td style="width:173px;height:19px">&nbsp;DefaultTask</td><td style="width:461px;height:19px">&nbsp;The installation task. Can be null.</td></tr><tr><td style="width:180px;height:19px">&nbsp;uninstall</td><td style="width:173px;height:19px">&nbsp;DefaultTask</td><td style="width:461px;height:19px">&nbsp;The uninstallation task.</td></tr></tbody></table><br>The <font face="courier new, monospace">LibraryVariant</font> class adds the following:<br><br><table border="1" bordercolor="#888" cellspacing="0" style="border-collapse:collapse;border-color:rgb(136,136,136);border-width:1px"><tbody><tr><td style="width:180px;height:19px">&nbsp;属性名称</td><td style="width:173px;height:19px">&nbsp;Property Type</td><td style="width:461px;height:19px">&nbsp;Description</td></tr><tr><td style="width:180px;height:19px">&nbsp;buildType</td><td style="width:173px;height:19px">&nbsp;BuildType</td><td style="width:461px;height:19px">&nbsp;The BuildType of the variant.</td></tr><tr><td style="width:180px;height:19px">&nbsp;mergedFlavor</td><td style="width:173px;height:19px">&nbsp;ProductFlavor</td><td style="width:461px;height:19px">&nbsp;The defaultConfig values</td></tr><tr><td style="width:180px;height:19px">&nbsp;testVariant</td><td style="width:173px;height:19px">&nbsp;BuildVariant</td><td style="width:461px;height:19px">&nbsp;The Build Variant that will test this variant.</td></tr><tr><td>&nbsp;packageLibrary</td><td>&nbsp;Zip</td><td>&nbsp;The task that packages the Library AAR archive. Null if not a library.</td></tr></tbody></table><br>The <font face="courier new, monospace">TestVariant</font> class adds the following:<br><br><table border="1" bordercolor="#888" cellspacing="0" style="border-collapse:collapse;border-color:rgb(136,136,136);border-width:1px"><tbody><tr><td style="width:180px;height:19px">&nbsp;属性名称</td><td style="width:173px;height:19px">&nbsp;Property Type</td><td style="width:461px;height:19px">&nbsp;Description</td></tr><tr><td style="width:180px;height:19px">&nbsp;buildType</td><td style="width:173px;height:19px">&nbsp;BuildType</td><td style="width:461px;height:19px">&nbsp;The BuildType of the variant.</td></tr><tr><td style="width:180px;height:19px">&nbsp;productFlavors</td><td style="width:173px;height:19px">&nbsp;List&lt;ProductFlavor&gt;</td><td style="width:461px;height:19px">&nbsp;The ProductFlavors of the variant. Always non Null but could be empty.</td></tr><tr><td style="width:180px;height:19px">&nbsp;mergedFlavor</td><td style="width:173px;height:19px">&nbsp;ProductFlavor</td><td style="width:461px;height:19px">&nbsp;The merging of android.defaultConfig and variant.productFlavors</td></tr><tr><td style="width:180px;height:19px">&nbsp;signingConfig</td><td style="width:173px;height:19px">&nbsp;SigningConfig</td><td style="width:461px;height:19px">&nbsp;The SigningConfig object used by this variant</td></tr><tr><td style="width:180px;height:19px">&nbsp;isSigningReady</td><td style="width:173px;height:19px">&nbsp;boolean</td><td style="width:461px;height:19px">&nbsp;true if the variant has all the information needed to be signed.</td></tr><tr><td style="width:180px;height:19px">&nbsp;testedVariant</td><td style="width:173px;height:19px">&nbsp;BaseVariant</td><td style="width:461px;height:19px">&nbsp;The BaseVariant that is tested by this TestVariant.</td></tr><tr><td>&nbsp;dex</td><td>&nbsp;Dex</td><td>&nbsp;The task that dex the code. Can be null if the variant is a library.</td></tr><tr><td>&nbsp;packageApplication</td><td>&nbsp;PackageApplication</td><td>&nbsp;The task that makes the final APK. Can be null if the variant is a library.</td></tr><tr><td>&nbsp;zipAlign</td><td>&nbsp;ZipAlign</td><td>&nbsp;The task that zipaligns the apk. Can be null if the variant is a library or if the APK cannot be signed.</td></tr><tr><td style="width:180px;height:19px">&nbsp;install</td><td style="width:173px;height:19px">&nbsp;DefaultTask</td><td style="width:461px;height:19px">&nbsp;The installation task. Can be null.</td></tr><tr><td>&nbsp;uninstall</td><td>&nbsp;DefaultTask</td><td>&nbsp;The uninstallation task.</td></tr><tr><td style="width:180px;height:19px">&nbsp;connectedAndroidTest</td><td style="width:173px;height:19px">&nbsp;DefaultTask</td><td style="width:461px;height:19px">&nbsp;The task that runs the android tests on connected devices.</td></tr><tr><td>&nbsp;providerAndroidTest</td><td>&nbsp;DefaultTask</td><td>&nbsp;The task that runs the android tests using the extension API.<br><br></td></tr></tbody></table><span style="line-height:1.6;font-size:10pt"><br></span></div><div><span style="line-height:1.6;font-size:10pt">API for Android specific task types.</span><br><ul><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">ProcessManifest</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File manifestOutputFile</font></span></li></ul><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">AidlCompile</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File sourceOutputDir</font></span></li></ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">RenderscriptCompile</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File sourceOutputDir</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File resOutputDir</font></span></li></ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">MergeResources</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File outputDir</font></span></li></ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">MergeAssets</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File outputDir</font></span></li></ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">ProcessAndroidResources</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File manifestFile</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File resDir</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File assetsDir</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File sourceOutputDir</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File textSymbolOutputDir</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File packageOutputFile</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File proguardOutputFile</font></span></li></ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">GenerateBuildConfig</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File sourceOutputDir</font></span></li></ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">Dex</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File outputFolder</font></span></li></ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">PackageApplication</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File resourceFile</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File dexFile</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File javaResourceDir</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File jniDir</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File outputFile</font></span></li><ul><li><font face="arial, sans-serif">To change the final output file use "outputFile" on the variant object directly.</font></li></ul></ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">ZipAlign</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File inputFile</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File outputFile</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6">To change the final output file use "outputFile" on the variant object directly.</span></li></ul></ul></ul></div><div><br>The API for each task type is limited due to both how Gradle works and how the Android plugin sets them up.</div><div>First, Gradle is meant to have the tasks be only configured for input/output location and possible optional flags. So here, the tasks only define (some of) the inputs/outputs.</div><div><br></div><div>Second, the input for most of those tasks is non-trivial, often coming from mixing values from the <i>sourceSets</i>, the <i>Build Types</i>, and the <i>Product Flavors</i>. To keep build files simple to read and understand, the goal is to let developers modify the build by tweak these objects through the DSL, rather than diving deep in the inputs and options of the tasks and changing them.</div><div><br></div><div>Also note, that except for the ZipAlign task type, all other types require setting up private data to make them work. This means it’s not possible to manually create new tasks of these types.<br> <br>This API is subject to change. In general the current API is around giving access to the outputs and inputs (when possible) of the tasks to add extra processing when required). Feedback is appreciated, especially around needs that may not have been foreseen.<br><br>For Gradle tasks (DefaultTask, JavaCompile, Copy, Zip), refer to the Gradle documentation.<br><br><h3><a name="TOC-BuildType-and-Product-Flavor-property-reference"></a>BuildType and Product Flavor property reference</h3></div><div>coming soon.</div><div><div>For Gradle tasks (DefaultTask, JavaCompile, Copy, Zip), refer to the Gradle documentation.<br><br><h3><a name="TOC-Using-sourceCompatibility-1.7"></a>Using sourceCompatibility 1.7</h3></div><div>With Android KitKat (buildToolsVersion 19) you can use the diamond operator, multi-catch, strings in switches, try with resources, etc. To do this, add the following to your build file:</div></div><div><br></div><div><div></div></div><div class="sites-codeblock sites-codesnippet-block"><div><div><code>android {</code></div><div><code><b>&nbsp; &nbsp; compileSdkVersion 19</b></code></div><div><code><b>&nbsp; &nbsp; buildToolsVersion "19.0.0"</b></code></div><div><br></div><div><code>&nbsp; &nbsp; defaultConfig {</code></div><div><code>&nbsp; &nbsp; &nbsp; &nbsp; minSdkVersion 7</code></div><div><code>&nbsp; &nbsp; &nbsp; &nbsp; targetSdkVersion 19</code></div><div><code>&nbsp; &nbsp; }</code></div><div><br></div><div><code>&nbsp; &nbsp; <b>compileOptions {</b></code></div><div><code><b>&nbsp; &nbsp; &nbsp; &nbsp; sourceCompatibility JavaVersion.VERSION_1_7</b></code></div><div><code><b>&nbsp; &nbsp; &nbsp; &nbsp; targetCompatibility JavaVersion.VERSION_1_7</b></code></div><div><code><b>&nbsp; &nbsp; }</b></code></div><div><code>}</code></div></div><div></div></div><div><br></div><div>Note that you can use <code>minSdkVersion</code> with a value earlier than 19, for all language features except try with resources. If you want to use try with resources, you will need to also use a <code>minSdkVersion</code> of 19.</div><div><br></div><div>You also need to make sure that Gradle is using version 1.7 or later of the JDK. (And version 0.6.1 or later of the Android Gradle plugin.)</div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div id="sites-attachments-container">
</div>
</div>
</div> 
</td> 
</tr>
</tbody></table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-subfooter"><div class="sites-subfooter-content"><br></div></div>
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&amp;continue=http://sites.google.com/a/android.com/tools/tech-docs/new-build-system/user-guide">登录</a><span aria-hidden="true">|</span><a class="sites-system-link" href="http://tools.android.com/system/app/pages/recentChanges">最近的网站活动</a><span aria-hidden="true">|</span><a class="sites-system-link" href="http://tools.android.com/system/app/pages/reportAbuse" target="_blank">举报滥用行为</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">打印页面</a><span aria-hidden="true">|</span><span class="sites-system-link">由</span> <b class="powered-by"><a href="http://sites.google.com/">Google 协作平台强力驱动</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>

<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="./../source-others/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
    
        sites.core.Analytics.createTracker();
        sites.core.Analytics.trackPageview();
      
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("2bd", "Project Info", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_2bd');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("09830101249604128", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_09830101249604128');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("42875732108950615", "Contrib info", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_42875732108950615');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'http://csi.gstatic.com/csi');
                    }
                  </script>

<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
        JOT_insertTranslateCode('zh_CN', 'en');
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
 //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupNoticeManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>


</body></html>