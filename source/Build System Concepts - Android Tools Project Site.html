<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0073)http://tools.android.com/tech-docs/new-build-system/build-system-concepts -->
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage" style="height: auto;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<script async="" src="./../source-others/analytics.js"></script><script type="text/javascript">/* Copyright 2008 Google. */ (function() { var b=window,e="chrome",g="tick",h="wtsrt_",l="tbsd_",m="tbnd_",n="start",p="_wtsrt",q="_tbnd",r="CSI/";(function(){function k(a){this.t={};this.tick=function(a,d,c){this.t[a]=[void 0!=c?c:(new Date).getTime(),d];if(void 0==c)try{b.console.timeStamp(r+a)}catch(f){}};this[g](n,null,a)}var a;b.performance&&(a=b.performance.timing);var t=a?new k(a.responseStart):new k;b.jstiming={Timer:k,load:t};if(a){var d=a.navigationStart,f=a.responseStart;0<d&&f>=d&&(b.jstiming.srt=f-d)}if(a){var c=b.jstiming.load;0<d&&f>=d&&(c[g](p,void 0,d),c[g](h,p,f),c[g](l,h))}try{a=null,b[e]&&b[e].csi&&(a=Math.floor(b[e].csi().pageT),
c&&0<d&&(c[g](q,void 0,b[e].csi().startE),c[g](m,q,d))),null==a&&b.gtbExternal&&(a=b.gtbExternal.pageT()),null==a&&b.external&&(a=b.external.pageT,c&&0<d&&(c[g](q,void 0,b.external.startE),c[g](m,q,d))),a&&(b.jstiming.pt=a)}catch(u){}})(); })()
</script>
<link rel="shortcut icon" type="image/x-icon" href="http://www.google.com/images/icons/product/sites-16.ico">
<link rel="apple-touch-icon" href="http://www.gstatic.com/sites/p/d0c286/system/app/images/apple-touch-icon.png" type="image/png">
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d=window,e="length",h="",k="__duration__",l="function";function m(c){return document.getElementById(c)}d.byId=m;function n(c){return c.replace(/^\s+|\s+$/g,h)}d.trim=n;var p=[],q=0;d.JOT_addListener=function(c,a,b){var f=new String(q++);c={eventName:c,handler:a,compId:b,key:f};p.push(c);return f};d.JOT_removeListenerByKey=function(c){for(var a=0;a<p[e];a++)if(p[a].key==c){p.splice(a,1);break}};d.JOT_removeAllListenersForName=function(c){for(var a=0;a<p[e];a++)p[a].eventName==c&&p.splice(a,1)};
d.JOT_postEvent=function(c,a,b){var f={eventName:c,eventSrc:a||{},payload:b||{}};if(d.JOT_fullyLoaded)for(a=p[e],b=0;b<a&&b<p[e];b++){var g=p[b];g&&g.eventName==c&&(f.listenerCompId=g.compId||h,(g=typeof g.handler==l?g.handler:d[g.handler])&&g(f))}else d.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};d.JOT_delayedEvents=[];d.JOT_fullyLoaded=!1;
d.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var f=0;60<=b&&(b/=60,f=2);2<=b&&f++;return a?d.JOT_siteRelTimeStrs[f].replace(k,Math.floor(b)):d.JOT_userRelTimeStrs[f].replace(k,Math.floor(b))}; })()
</script>
<script>


var webspace = {"scottyUrl":"/_/upload","isConsumer":false,"canPublishScriptToAnyone":true,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"sharingUrlPrefix":"/_/sharing","csiReportUri":"http://csi.gstatic.com/csi","sharingPolicy":"OPENED","siteNoticeUrlEnabled":null,"siteNoticeUrlAddress":null,"analyticsAccountId":"UA-19996407-1","baseUri":"","enableUniversalAnalytics":false,"name":"tools","features":{"copySiteProgressUpdates":true,"asyncPermanentDelete":true,"colorsAndFontsFix":true,"docosHideNotificationSettings":true,"driveImageLinkFromOnepick":true,"moreMobileStyleImprovements":false,"siteNoticeUrl":true,"pageDrafts":false,"asyncPageKeyFix":true,"fileCabinetScreenReaderFix":true,"pdfEmbedSupport":false,"mobileOrientationFix":false,"siteMapBottomPaginationButtonsFix":true,"newMyMapsEmbeds":true,"plusBadge":false,"analyticsTrackingForCorp":false,"freebirdFormEmbedDocTypeFix":true,"updatedTosAndPrivacyLinks":null,"htmlEmbed":true,"newCountDownDialog":true,"pageTreeKeyboardFix":true,"useGapiIframesForOnePick":false,"languageSelectDefaultTextSetToDefault":true,"domainAnalyticsInGAOnly":false},"domain":"android.com","adsensePublisherId":null,"gvizVersion":1,"siteTitle":"Android Tools Project Site","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttp://sites.google.com/a/android.com/tools/tech-docs/new-build-system/build-system-concepts\u0026service\u003djotspot","pageSharingId":"jotspot_page","plusPageId":"","onepickBaseUrl":"https://docs.google.com","siteNoticeRevision":null,"termsUrl":"//www.google.com/intl/zh/policies/terms/","enableAnalytics":true,"isPublic":true,"siteNoticeMessage":null,"plusPageUrl":"","homePath":"/","sharingId":"jotspot","isAdsenseEnabled":true,"adsensePromoClickedOrSiteIneligible":true,"isStartPageEnabled":true,"domainAnalyticsAccountId":""};



webspace.gadgets = {"baseUri":"/system/app/pages/gadgets"};


webspace.user = {"uid":"","renderMobile":false,"namespaceUser":false,"sessionIndex":"","primaryEmail":"guest","displayNameOrEmail":"guest","namespace":"","hasAdminAccess":false,"guest_":true,"keyboardShortcuts":true,"hasWriteAccess":false,"domain":"","dasherUser":false,"userName":"guest"};

webspace.page = {"canDeleteWebspace":null,"locale":"zh_CN","state":"","wuid":"wuid:gx:cce742f164e0763","pageInheritsPermissions":null,"timeZone":"America/Los_Angeles","properties":{},"type":"text","canChangePath":true,"parentWuid":"wuid:gx:7f79556dd5cace7","isPageDraft":null,"revision":11,"title":"Build System Concepts","isRtlLocale":false,"bidiEnabled":false,"siteLocale":"en","name":"build-system-concepts","path":"/tech-docs/new-build-system/build-system-concepts","isSiteRtlLocale":false,"parentPath":"/tech-docs/new-build-system"};
webspace.page.breadcrumbs = [{"title":"Technical docs","dir":"ltr","path":"/tech-docs","deleted":false},{"title":"New Build System","dir":"ltr","path":"/tech-docs/new-build-system","deleted":false},{"title":"Build System Concepts","dir":"ltr","path":"/tech-docs/new-build-system/build-system-concepts","deleted":false}];


webspace.editorResources = {
  text: [
    'http://www.gstatic.com/sites/p/d0c286/system/js/codemirror.js',
    'http://www.gstatic.com/sites/p/d0c286/system/app/css/codemirror_css.css',
    'http://www.gstatic.com/sites/p/d0c286/system/js/trog_edit__zh_cn.js',
    'http://www.gstatic.com/sites/p/d0c286/system/app/css/trogedit.css',
    '/_/rsrc/1420644158000/system/app/css/editor.css',
    'http://www.gstatic.com/sites/p/d0c286/system/app/css/codeeditor.css',
    '/_/rsrc/1420644158000/system/app/css/camelot/editor-jfk.css'
  ],
  sitelayout: [
    'http://www.gstatic.com/sites/p/d0c286/system/app/css/sitelayouteditor.css'
  ]
};

var JOT_clearDotPath = 'http://www.gstatic.com/sites/p/d0c286/system/app/images/cleardot.gif';


var JOT_userRelTimeStrs = ["1 \u5206\u949f\u524d","__duration__ \u5206\u949f\u4e4b\u524d","1 \u5c0f\u65f6\u524d","__duration__ \u5c0f\u65f6\u524d"];


webspace.siteTemplateId = false;


webspace.page.currentTemplate = {"title":"\u7f51\u9875","path":"/system/app/pagetemplates/text"};



var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Build System Concepts - Android Tools Project Site">
<meta itemprop="name" content="Build System Concepts - Android Tools Project Site">
<meta property="og:title" content="Build System Concepts - Android Tools Project Site">
<meta name="description" content="Android tools project information site">
<meta itemprop="description" content="Android tools project information site">
<meta id="meta-tag-description" property="og:description" content="Android tools project information site">
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="./../source-others/standard-css-iceberg-ltr-ltr.css">
<link rel="stylesheet" type="text/css" href="./../source-others/overlay.css">
<link rel="stylesheet" type="text/css" href="./../source-others/allthemes-view.css">
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Build System Concepts - Android Tools Project Site</title>
<meta itemprop="image" content="http://www.google.com/a/cpanel/android.com/images/logo.gif?service=google_default">
<meta property="og:image" content="http://www.google.com/a/cpanel/android.com/images/logo.gif?service=google_default">
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
<script src="./../source-others/ga.js"></script><script src="./../source-others/element.js"></script><link type="text/css" rel="stylesheet" charset="UTF-8" href="./../source-others/translateelement.css"><script type="text/javascript" charset="UTF-8" src="./../source-others/main_zh-CN.js"></script><script type="text/javascript" charset="UTF-8" src="./../source-others/element_main.js"></script><style>.goog-te-ftab-float {z-index:9999999; overflow:visible; position:fixed; _position:absolute;top:auto;left:auto;bottom:0px; _top:expression((-0-document.getElementById(':0.floatContainer').offsetHeight+(hack3=document.documentElement.clientHeight||document.body.clientHeight)+(hack4=document.documentElement.scrollTop||document.body.scrollTop))+'px');right:20px; _left:expression((-20-document.getElementById(':0.floatContainer').offsetWidth+(hack5=document.documentElement.clientWidth||document.body.clientWidth)+(hack6=document.documentElement.scrollLeft||document.body.scrollLeft))+'px');}</style></head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            " ryt12638="1" style="zoom: 1; position: relative; min-height: 100%; top: 0px;">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="">
<tbody><tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="http://tools.android.com/" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="./../source-others/logo.gif" alt="Android Tools Project Site" class="sites-logo  sites-domain-logo"></a><h2><a href="http://tools.android.com/" dir="ltr" id="sites-chrome-userheader-title">Android Tools Project Site</a></h2></div></td><td class="sites-layout-searchbox  "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="http://tools.android.com/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site"><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site"><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0" style="-webkit-user-select: none;">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
<div class="sites-header-nav"><ul class="sites-header-nav-container-boxes"></ul><div style="clear: both;"></div></div>
</td>
</tr>
</tbody></table> 
</div> 
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tbody><tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_2bd" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotid="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/overview" jotid="wuid:gx:44ff8c8722cc5d9b" class="sites-navigation-link">Projects Overview</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/screenshots" jotid="wuid:gx:6914b706d692f646" class="sites-navigation-link">Screenshots</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/release" jotid="wuid:gx:7ac5d78c9458ca81" class="sites-navigation-link">Release Status</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/roadmap" jotid="wuid:gx:60ea3587cace173b" class="sites-navigation-link">Roadmap</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/download" jotid="wuid:gx:5b9a06a7bd768d08" class="sites-navigation-link">Download</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/preview-channel" jotid="wuid:gx:65c33e76aa1e249e" class="sites-navigation-link">Preview Channel</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/recent" jotid="wuid:gx:2d257f949510e1ed" class="sites-navigation-link">Recent Changes</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/tech-docs" jotid="wuid:gx:68695c8c797f5a75" class="sites-navigation-link">Technical docs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/tech-docs/new-build-system" jotid="wuid:gx:7f79556dd5cace7" class="sites-navigation-link">New Build System</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_09830101249604128" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotid="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/knownissues" jotid="wuid:gx:2a2ed1d61165c57f" class="sites-navigation-link">Known Issues</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/tips" jotid="wuid:gx:11629b864408db4c" class="sites-navigation-link">Tips</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_42875732108950615" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotid="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/build" jotid="wuid:gx:138a85800bd6b1df" class="sites-navigation-link">Build Overview</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/contributing" jotid="wuid:gx:1f3267453e2dafcc" class="sites-navigation-link">Contributing</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/feedback" jotid="wuid:gx:5b9bc58701d69f2" class="sites-navigation-link">Feedback</a></div></li></ul></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<a href="http://tools.android.com/tech-docs" dir="ltr">Technical docs</a>‎ &gt; ‎<a href="http://tools.android.com/tech-docs/new-build-system" dir="ltr">New Build System</a>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr">Build System Concepts</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr">The new build system goals are:<br><ul><li>Make it easy to reuse code and resources</li><li>Make it easy to create several variants of an application, either for multi-apk distribution or for different flavors of an application</li><li>Ease of extending and configuring the build</li></ul>To implement those goals we had to introduce some new concepts.<br><h2><a name="TOC-Product-Flavors"></a>Product Flavors</h2><div>A product flavor defines a customized version of the application build by the project. A single project can have different flavors which change the generated application.<br><br>Although different flavors could be very different applications, using Library Projects is a better use case for this, and the build system still supports this.<br>This new concept is designed to help when the differences are very, very minimum, for instance when using Google Play’s multi-apk support (e.g. the difference could be only gl textures compressed using a different format.)<br>If the answer to “Is this the same application?” is yes, then this is probably the way to go over Library Projects.<br><br>Product flavors can customize the following properties:<br><ul><li>minSdkVersion</li><li>targetSdkVersion</li><li>versionCode</li><li>versionName</li><li>package name (overrides value from manifest)</li><li>release signing info (keystore, key alias, passwords,...).</li><li>BuildConfig: Ability to provide custom Java code.</li><li>NDK ABI filter (<span style="background-color:rgb(255,255,0)">Not implemented yet</span>)</li><li>test info</li><ul><li>package name for test app (optional, default is &lt;base&gt;.test)</li><li>InstrumentationTestRunner class (optional)</li></ul><li>Additionally, Product Flavor can provide their own source code, resources and manifest.</li></ul><br>A project starts with a default Configuration. All the above properties can be set and it has its own source code, resources and manifest.<br>If the project does not create product flavors, then the application is built from this default configuration.<br><br>When a project declares Product Flavors, these extends the main configuration.<br><br>The source code of the product flavor is used in addition to the source code of the main configuration (1).<br>The resources of the product flavor overrides the resources of the main configuration.<br>The Manifest of the product flavor is merged on top of the Manifest of the main configuration.<br><br>(1) This allows some flexibility but also adds some restrictions:<br><ul><li>Classes in the main configuration and in the product flavors can reference each other. All the source sets are used to generate a single output (instead of each generating its own output with a one-way dependency).</li><li>Classes exposed by product flavors and referenced by classes in the main configuration must be present in all product flavors, and must have the same API for all builds to succeed.</li></ul>When a Product Flavor is defined, the main configuration is not available as a buildable product. To create more than one product, two or more flavors must be created and customized.</div><br>Note about the AndroidManifest attributes that can be set through the default Configuration or the flavor configurations:<br><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px">Values present in the manifest file will be overridden with the values coming from the build configuration. All values, except for the package name can be omitted from the manifest file.<br>The main manifest must always have a package name. This is used as the package into which the R class is generated. Overriding the package name of a flavor has no impact on where the R class is generated. This is applied when the final APK is created only.</blockquote><div><h2><a name="TOC-Build-Types"></a>Build Types</h2></div><div>A build type allows configuration of how an application is packaged for debugging or release purpose.<br><br>This concept is not meant to be used to create different versions of the same application. This is orthogonal to Product Flavor.<br><br>A Build Type provides configuration for the following build properties:<br><ul><li>manifest debuggable flag</li><li>native compilation debug flag</li><li>proguard enabled + specific rules (Not implemented yet)</li><li>debug signing flag (ie whether to use debug key or release key)</li><li>package name suffix (2)</li><li>version name suffix (<font color="#990000">new in milestone 0.3</font>)</li><li>Buildconfig</li><ul><li>DEBUG flag. Set automatically based on the manifest debuggable flag.</li><li>Ability to provide custom Java code.</li></ul></ul>By default the build system provides two build types, debug and release, which can be reconfigured. New types can also be created to provide any combinations of the above properties.<br>For instance, one could make a Build Type that uses Proguard but creates a debuggable apk.<br><br>(2) This is appended to the manifest package name. The goal here is to allow having different build types create different apks that can all be installed at the same time. This is optional.<br><br>Like Product Flavors, Build Types can provide their own source code, resources and manifest.<br>The typical use cases are:<br><ul><li>different MapView key in release and debug mode as this is linked to the signing key (3)</li><li>require extra permissions for a debug build, for instance ACCESS_MOCK_LOCATION</li></ul>(3) If Product Flavors are used to create different versions built with different keys, the MapView API Key can be provided by the resources of the Product Flavor instead. See Build Variants below.<br><br>The source code and resources provided by the Build Types affects the project the same way Product Flavors do.<br><h2><a name="TOC-Build-Variants"></a>Build Variants</h2></div><div>We’ve seen Product Flavors and Build Types and how both configure the output of a project.<br><br>In fact, the output of a project can only be the cross product of  the Build Type and, if applicable, the Product Flavor. This is call a build variant.<br><br>If product flavors are defined, it is not possible to omit them.<br><br>For a project not customizing any Build Type or Product Flavor, the available build variants are debug and release versions, as the default configuration is implied.<br><br>However, if a project declares two flavors, for instance free and forpay, the available build variants are<br><br><table border="1" bordercolor="#888" cellspacing="0" style="border-collapse:collapse;border-color:rgb(136,136,136);border-width:1px"><tbody><tr><td style="width:46px;height:28px">&nbsp;</td><td style="width:112px;height:28px">&nbsp;Debug</td><td style="width:116px;height:28px">&nbsp;Release</td></tr><tr><td style="width:46px;height:29px">&nbsp;Free</td><td style="width:112px;height:29px">&nbsp;Free-Debug</td><td style="width:116px;height:29px">&nbsp;Free-Release</td></tr><tr><td style="width:46px;height:34px">&nbsp;ForPay</td><td style="width:112px;height:34px">&nbsp;ForPay-Debug</td><td style="width:116px;height:34px">&nbsp;ForPay-Release</td></tr></tbody></table><br>We have seen above how source code and resources provided by Build Types and Product Flavors extend or override the main configuration. When actually building an app, the Build Type and Product Flavor are both applied with the following rules:<br><br>All the source folders are used together (default config, build type, product flavor, and generated source code(4)) to create a single output.<br><br>This means the same restrictions mentioned above applies, with the addition that Build Types and Product Flavors cannot provide different versions of the same class.<br><br>(4) generated source is output from resource compilation (R.java), aidl and renderscript compilation, and things like BuildConfig which can be impacted by the BuildType. These are different per build variants.<br><br>Resources combination uses the following priority (lower number is higher priority and override higher number):<br><ol><li>build type</li><li>flavor</li><li>main configuration</li></ol>Packaging of Assets and Java Resources follow a similar priority when encountering duplicates:<br><ol><li>Build Type</li><li>Product Flavor</li><li>default configuration</li></ol></div><div><span style="background-color:rgb(255,255,0)">Note: Not implemented yet.</span><br><h2><a name="TOC-Flavor-Groups"></a>Flavor Groups</h2></div><div>We’ve seen how variants are created from a Build Type and a Product Flavor. In some case it is useful to be able to have several dimensions of flavors. This is particularly useful when only packaging is impacted to use the multi-apk support in the Play Store.<br><br>For instance, let’s imagine a game that has GL texture for different formats, and has native component for arm, x86 and mips. Such a project could use a flavor dimension for the GL textures and one for the ABI to package.<br><br>Flavor groups are first defined. The order is important as it impacts Android resource priority.<br>Then each flavor is assigned to a group.<br><br>Variant are then created from each combinations of Build Types and Product Flavor Group.<br>Here’s an example giving us all the variant for 2 Texture formats and 2 ABIs.<br><br><table border="1" bordercolor="#888" cellspacing="0" style="border-collapse:collapse;border-color:rgb(136,136,136);border-width:1px"><tbody><tr><td style="width:78px;height:19px">&nbsp;</td><td style="width:103px;height:19px">&nbsp;</td><td style="width:108px;height:19px">&nbsp;Debug</td><td style="width:123px;height:19px">&nbsp;Release</td></tr><tr><td style="width:78px;height:22px">&nbsp;GL Group</td><td style="width:103px;height:22px">&nbsp;ABI Group</td><td style="width:108px;height:22px">&nbsp;</td><td style="width:123px;height:22px">&nbsp;</td></tr><tr><td style="width:78px;height:19px">&nbsp;DXT1</td><td style="width:103px;height:19px">ARM&nbsp;</td><td style="width:108px;height:19px">&nbsp;dxt1-arm-debug</td><td style="width:123px;height:19px">&nbsp;dxt1-arm-release</td></tr><tr><td style="width:78px;height:19px">&nbsp;DXT1</td><td style="width:103px;height:19px">x86&nbsp;</td><td style="width:108px;height:19px">&nbsp;dxt1-x86-debug</td><td style="width:123px;height:19px">&nbsp;dxt1-x86-release</td></tr><tr><td style="width:78px;height:19px">&nbsp;PVRTC</td><td style="width:103px;height:19px">ARM&nbsp;</td><td style="width:108px;height:19px">&nbsp;pvrtc-arm-debug</td><td style="width:123px;height:19px">&nbsp;pvrtc-arm-release</td></tr><tr><td style="width:78px;height:19px">&nbsp;PVRTC</td><td style="width:103px;height:19px">x86&nbsp;</td><td style="width:108px;height:19px">&nbsp;pvrtc-x86-debug</td><td style="width:123px;height:19px">&nbsp;pvrtc-x86-release</td></tr></tbody></table><br><h2><a name="TOC-Sourcesets"></a>Sourcesets</h2></div><div>Due to Build Types and Product Flavors all providing their own sources, resources and manifest, the project structure need to change from the root level src/res/manifest used in the current build system.<br><br>Instead the build system moves to a top level src folder, containing folders for each build types, flavors as well as default config, and tests for each flavors. Each of those sub folders are self-contained for the element they represent and can contain a manifest, java source code, resources, etc...<br><br>A typical project will then have the following folder structure:<br><ul><li>src/</li><ul><li>main/</li><ul><li>java/</li><li>jni/</li><li>resources/ -- this is java resources</li><li>aidl/</li><li>rs/</li><li>res/ -- this is Android resources</li><li>assets/</li><li>AndroidManifest.xml</li></ul><li>debug/</li><ul><li>Java, jni, res, AndroidManifest.xml, etc... (same as main)</li></ul><li>release/</li><ul><li>Java, jni, res, AndroidManifest.xml, etc... (same as main)</li></ul><li>flavor1/</li><ul><li>Java, jni, res, AndroidManifest.xml, etc... (same as main)</li></ul><li>flavor2/</li><ul><li>Java, jni, res, AndroidManifest.xml, etc... (same as main)</li></ul></ul></ul>The current gen folder is to move under the project output, as it there are actually several of them, depending on the build variant. This is accompanied by the generated resources, and the generated (merged) Manifest.<br><h2><a name="TOC-Testing"></a>Testing</h2>In the current build system, test applications are created from a different project that is flagged as a “test project”. This project references the main project in order to get the main project’s classes on its classpath.<br><br>With possibly multiple Product Flavors it is important to test all of them.<br><br>The test projects are now part of the main projects. Sourcesets containing tests for the default configuration and each flavors are automatically used, and a test application is generated for each variant.<br><br>For a project with several flavors, the structure of the source folders will look like:<br><ul><li>src/</li><ul><li>main/</li><li>test/ -- this is the code to test “main”</li><li>debug/</li><li>release/</li><li>flavor1/</li><li>testFlavor1/ -- this is the code to test “flavor1”</li><li>flavor2/</li><li>testFlavor2/ -- this is the code to test “flavor2”</li></ul></ul>The manifest of a test application is always the same. However due to flavors being able to customize the package name of an application, it is important that the test manifest matches this package. To do this, test manifests are always generated.<br><br>The test applications are meant to run against a given Build Type variant. It is the “debug” variant by default, but it can be configured.<br><h2><a name="TOC-Building-Library-Projects"></a>Building Library Projects</h2></div><div>Library Projects are built in a very similar way to regular projects with a few exceptions.<br><ul><li>There are no Product Flavor.</li><li>There are <i>debug</i> and <i>release</i> build types but they are used slightly differently.</li></ul></div><div>Testing the library is important and this is done through the test component of the project. However, unlike a normal project, this component doesn’t generate a separate application from only its source set. Instead it implicitly references the library itself and packages it in its own apk.<br>This build is always a <i>debug</i> build.<br><br>When the Library Project is built and packaged into a distribution blob, then the build is always a <i>release</i> build.<br><br>Libraries can be packaging as binary bundle. These can be uploaded to online repository (Maven or Ivy) and reused by other projects.<br><br>They can also be used directly as part of a multi-project setup.<br><h2><a name="TOC-Lint-integration"></a>Lint integration</h2></div><div>This is planned but it not available at the moment.</div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_page-subpages"> </div>
<div id="sites-attachments-container">
</div>
</div>
</div> 
</td> 
</tr>
</tbody></table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-subfooter"><div class="sites-subfooter-content"><br></div></div>
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&continue=http://sites.google.com/a/android.com/tools/tech-docs/new-build-system/build-system-concepts">登录</a><span aria-hidden="true">|</span><a class="sites-system-link" href="http://tools.android.com/system/app/pages/recentChanges">最近的网站活动</a><span aria-hidden="true">|</span><a class="sites-system-link" href="http://tools.android.com/system/app/pages/reportAbuse" target="_blank">举报滥用行为</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">打印页面</a><span aria-hidden="true">|</span><span class="sites-system-link">由</span> <b class="powered-by"><a href="http://sites.google.com/">Google 协作平台强力驱动</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>

<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="./../source-others/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
    
        sites.core.Analytics.createTracker();
        sites.core.Analytics.trackPageview();
      
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("2bd", "Project Info", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_2bd');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("09830101249604128", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_09830101249604128');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("42875732108950615", "Contrib info", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_42875732108950615');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
  setTimeout(function() {
    var fingerprint = gsites.date.TimeZone.getFingerprint([]);
    gsites.Xhr.send('http://tools.android.com/_/tz', null, null, 'GET', null, null, { afjstz: fingerprint });
  }, 500);
</script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'http://csi.gstatic.com/csi');
                    }
                  </script>

<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
        JOT_insertTranslateCode('zh_CN', 'en');
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
 //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupNoticeManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="./../source-others/translate-32.png" width="20" height="20"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">原文</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">提供更好的翻译建议</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div>


<div id=":0.floatContainer" class=" goog-te-ftab-float" style="display: none;"><iframe id=":0.container" frameborder="0" src="javascript:''" class="goog-te-ftab-frame skiptranslate" style="visibility:visible"></iframe></div></body></html>