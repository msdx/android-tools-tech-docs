<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0062)http://tools.android.com/tech-docs/new-build-system/user-guide -->
<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/WebPage"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<script async="" src="./../source-others/analytics.js"></script><script type="text/javascript">/* Copyright 2008 Google. */ (function() { var b=window,e="chrome",g="tick",h="wtsrt_",l="tbsd_",m="tbnd_",n="start",p="_wtsrt",q="_tbnd",r="CSI/";(function(){function k(a){this.t={};this.tick=function(a,d,c){this.t[a]=[void 0!=c?c:(new Date).getTime(),d];if(void 0==c)try{b.console.timeStamp(r+a)}catch(f){}};this[g](n,null,a)}var a;b.performance&&(a=b.performance.timing);var s=a?new k(a.responseStart):new k;b.jstiming={Timer:k,load:s};if(a){var d=a.navigationStart,f=a.responseStart;0<d&&f>=d&&(b.jstiming.srt=f-d)}if(a){var c=b.jstiming.load;0<d&&f>=d&&(c[g](p,void 0,d),c[g](h,p,f),c[g](l,h))}try{a=null,b[e]&&b[e].csi&&(a=Math.floor(b[e].csi().pageT),
c&&0<d&&(c[g](q,void 0,b[e].csi().startE),c[g](m,q,d))),null==a&&b.gtbExternal&&(a=b.gtbExternal.pageT()),null==a&&b.external&&(a=b.external.pageT,c&&0<d&&(c[g](q,void 0,b.external.startE),c[g](m,q,d))),a&&(b.jstiming.pt=a)}catch(t){}})(); })()
</script>
<link rel="shortcut icon" type="image/x-icon" href="http://www.google.com/images/icons/product/sites-16.ico">
<link rel="apple-touch-icon" href="http://www.gstatic.com/sites/p/fa469b/system/app/images/apple-touch-icon.png" type="image/png">
<script type="text/javascript">/* Copyright 2008 Google. */ (function() { var d=window,e="length",h="",k="__duration__",l="function";function m(c){return document.getElementById(c)}d.byId=m;function n(c){return c.replace(/^\s+|\s+$/g,h)}d.trim=n;var p=[],q=0;d.JOT_addListener=function(c,a,b){var f=new String(q++);c={eventName:c,handler:a,compId:b,key:f};p.push(c);return f};d.JOT_removeListenerByKey=function(c){for(var a=0;a<p[e];a++)if(p[a].key==c){p.splice(a,1);break}};d.JOT_removeAllListenersForName=function(c){for(var a=0;a<p[e];a++)p[a].eventName==c&&p.splice(a,1)};
d.JOT_postEvent=function(c,a,b){var f={eventName:c,eventSrc:a||{},payload:b||{}};if(d.JOT_fullyLoaded)for(a=p[e],b=0;b<a&&b<p[e];b++){var g=p[b];g&&g.eventName==c&&(f.listenerCompId=g.compId||h,(g=typeof g.handler==l?g.handler:d[g.handler])&&g(f))}else d.JOT_delayedEvents.push({eventName:c,eventSrc:a,payload:b})};d.JOT_delayedEvents=[];d.JOT_fullyLoaded=!1;
d.JOT_formatRelativeToNow=function(c,a){var b=((new Date).getTime()-c)/6E4;if(1440<=b||0>b)return null;var f=0;60<=b&&(b/=60,f=2);2<=b&&f++;return a?d.JOT_siteRelTimeStrs[f].replace(k,Math.floor(b)):d.JOT_userRelTimeStrs[f].replace(k,Math.floor(b))}; })()
</script>
<script>


var webspace = {"scottyUrl":"/_/upload","isConsumer":false,"canPublishScriptToAnyone":true,"serverFlags":{"cajaBaseUrl":"//www.gstatic.com/caja","cajaDebugMode":false},"sharingUrlPrefix":"/_/sharing","csiReportUri":"http://csi.gstatic.com/csi","sharingPolicy":"OPENED","siteNoticeUrlEnabled":null,"siteNoticeUrlAddress":null,"analyticsAccountId":"UA-19996407-1","baseUri":"","enableUniversalAnalytics":false,"name":"tools","features":{"copySiteProgressUpdates":true,"asyncPermanentDelete":true,"colorsAndFontsFix":true,"docosHideNotificationSettings":true,"driveImageLinkFromOnepick":false,"siteNoticeUrl":true,"asyncPageKeyFix":true,"fileCabinetScreenReaderFix":false,"pdfEmbedSupport":false,"siteMapBottomPaginationButtonsFix":true,"newMyMapsEmbeds":false,"plusBadge":false,"analyticsTrackingForCorp":false,"freebirdFormEmbedDocTypeFix":true,"webspaceUrlScrubOnlyOnBlur":true,"addShortcutToTextBoxDialog":true,"htmlEmbed":true,"newCountDownDialog":true,"pageTreeKeyboardFix":true,"domainAnalyticsInGAOnly":false,"languageSelectDefaultTextSetToDefault":true},"domain":"android.com","adsensePublisherId":null,"gvizVersion":1,"siteTitle":"Android Tools Project Site","signInUrl":"https://www.google.com/a/SelectSession?continue\u003dhttp://sites.google.com/a/android.com/tools/tech-docs/new-build-system/user-guide\u0026service\u003djotspot","pageSharingId":"jotspot_page","plusPageId":"","onepickBaseUrl":"https://docs.google.com","siteNoticeRevision":null,"termsUrl":"http://sites.google.com/site/sites/system/app/pages/meta/terms?apps\u003d1","enableAnalytics":true,"isPublic":true,"siteNoticeMessage":null,"plusPageUrl":"","homePath":"/","sharingId":"jotspot","isAdsenseEnabled":true,"adsensePromoClickedOrSiteIneligible":true,"isStartPageEnabled":true,"domainAnalyticsAccountId":""};



webspace.gadgets = {"baseUri":"/system/app/pages/gadgets"};


webspace.user = {"uid":"","renderMobile":false,"namespaceUser":false,"sessionIndex":"","primaryEmail":"guest","displayNameOrEmail":"guest","namespace":"","hasAdminAccess":false,"guest_":true,"keyboardShortcuts":true,"hasWriteAccess":false,"domain":"","dasherUser":false,"userName":"guest"};

webspace.page = {"canDeleteWebspace":null,"locale":"zh_CN","state":"","wuid":"wuid:gx:2ba8119816f3cc7d","pageInheritsPermissions":null,"timeZone":"America/Los_Angeles","properties":{},"type":"text","canChangePath":true,"parentWuid":"wuid:gx:7f79556dd5cace7","revision":75,"title":"Gradle Plugin User Guide","isRtlLocale":false,"bidiEnabled":false,"siteLocale":"en","name":"user-guide","path":"/tech-docs/new-build-system/user-guide","isSiteRtlLocale":false,"parentPath":"/tech-docs/new-build-system"};
webspace.page.breadcrumbs = [{"title":"Technical docs","dir":"ltr","path":"/tech-docs","deleted":false},{"title":"New Build System","dir":"ltr","path":"/tech-docs/new-build-system","deleted":false},{"title":"Gradle Plugin User Guide","dir":"ltr","path":"/tech-docs/new-build-system/user-guide","deleted":false}];


webspace.editorResources = {
  text: [
    'http://www.gstatic.com/sites/p/fa469b/system/js/codemirror.js',
    'http://www.gstatic.com/sites/p/fa469b/system/app/css/codemirror_css.css',
    'http://www.gstatic.com/sites/p/fa469b/system/js/trog_edit__zh_cn.js',
    'http://www.gstatic.com/sites/p/fa469b/system/app/css/trogedit.css',
    '/_/rsrc/1416929664000/system/app/css/editor.css',
    'http://www.gstatic.com/sites/p/fa469b/system/app/css/codeeditor.css',
    '/_/rsrc/1416929664000/system/app/css/camelot/editor-jfk.css'
  ],
  sitelayout: [
    'http://www.gstatic.com/sites/p/fa469b/system/app/css/sitelayouteditor.css'
  ]
};

var JOT_clearDotPath = 'http://www.gstatic.com/sites/p/fa469b/system/app/images/cleardot.gif';


var JOT_userRelTimeStrs = ["1 \u5206\u949f\u524d","__duration__ \u5206\u949f\u4e4b\u524d","1 \u5c0f\u65f6\u524d","__duration__ \u5c0f\u65f6\u524d"];


webspace.siteTemplateId = false;


webspace.page.currentTemplate = {"title":"\u7f51\u9875","path":"/system/app/pagetemplates/text"};



var JOT_siteRelTimeStrs = ["a minute ago","__duration__ minutes ago","an hour ago","__duration__ hours ago"];

</script>
<script type="text/javascript">
                window.jstiming.load.tick('scl');
              </script>
<meta name="title" content="Gradle Plugin User Guide - Android Tools Project Site">
<meta itemprop="name" content="Gradle Plugin User Guide - Android Tools Project Site">
<meta property="og:title" content="Gradle Plugin User Guide - Android Tools Project Site">
<meta name="description" content="Android tools project information site">
<meta itemprop="description" content="Android tools project information site">
<meta id="meta-tag-description" property="og:description" content="Android tools project information site">
<style type="text/css">
</style>
<link rel="stylesheet" type="text/css" href="./../source-others/standard-css-iceberg-ltr-ltr.css">
<link rel="stylesheet" type="text/css" href="./../source-others/overlay.css">
<link rel="stylesheet" type="text/css" href="./../source-others/allthemes-view.css">
<!--[if IE]>
          <link rel="stylesheet" type="text/css" href="/system/app/css/camelot/allthemes%2die.css" />
        <![endif]-->
<title>Gradle Plugin User Guide - Android Tools Project Site</title>
<meta itemprop="image" content="/site/sites/system/app/images/cleardot.gif">
<meta property="og:image" content="/site/sites/system/app/images/cleardot.gif">
<script type="text/javascript">
                window.jstiming.load.tick('cl');
              </script>
</head>
<body xmlns="http://www.google.com/ns/jotspot" id="body" class=" en            ">
<div id="sites-page-toolbar" class="sites-header-divider">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-status" class="sites-status" style="display:none;"><div id="sites-notice" class="sites-notice" role="status" aria-live="assertive"> </div></div>
</div>
<div id="sites-chrome-everything-scrollbar">
<div id="sites-chrome-everything" class="">
<div id="sites-chrome-page-wrapper" style="direction: ltr">
<div id="sites-chrome-page-wrapper-inside">
<div xmlns="http://www.w3.org/1999/xhtml" id="sites-chrome-header-wrapper" style="">
<table id="sites-chrome-header" class="sites-layout-hbox" cellspacing="0" style="">
<tbody><tr class="sites-header-primary-row" id="sites-chrome-userheader">
<td id="sites-header-title" class="" role="banner"><div class="sites-header-cell-buffer-wrapper"><a href="http://tools.android.com/" id="sites-chrome-userheader-logo"><img id="logo-img-id" src="http://www.google.com/a/cpanel/android.com/images/logo.gif?service=google_default" alt="Android Tools Project Site" class="sites-logo  sites-domain-logo"></a><h2><a href="http://tools.android.com/" dir="ltr" id="sites-chrome-userheader-title">Android Tools Project Site</a></h2></div></td><td class="sites-layout-searchbox "><div class="sites-header-cell-buffer-wrapper"><form id="sites-searchbox-form" action="http://tools.android.com/system/app/pages/search" role="search"><input type="hidden" id="sites-searchbox-scope" name="scope" value="search-site"><input type="text" id="jot-ui-searchInput" name="q" size="20" value="" aria-label="Search this site"><div id="sites-searchbox-button-set" class="goog-inline-block"><div role="button" id="sites-searchbox-search-button" class="goog-inline-block jfk-button jfk-button-standard" tabindex="0" style="-webkit-user-select: none;">Search this site</div></div></form></div></td>
</tr>
<tr class="sites-header-secondary-row" id="sites-chrome-horizontal-nav">
<td colspan="2" id="sites-chrome-header-horizontal-nav-container" role="navigation">
<div class="sites-header-nav"><ul class="sites-header-nav-container-boxes"></ul><div style="clear: both;"></div></div>
</td>
</tr>
</tbody></table> 
</div> 
<div id="sites-chrome-main-wrapper">
<div id="sites-chrome-main-wrapper-inside">
<table id="sites-chrome-main" class="sites-layout-hbox" cellspacing="0" cellpadding="{scmCellpadding}" border="0">
<tbody><tr>
<td id="sites-chrome-sidebar-left" class="sites-layout-sidebar-left initial" style="width:150px">
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_2bd" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotid="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/overview" jotid="wuid:gx:44ff8c8722cc5d9b" class="sites-navigation-link">Projects Overview</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/screenshots" jotid="wuid:gx:6914b706d692f646" class="sites-navigation-link">Screenshots</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/release" jotid="wuid:gx:7ac5d78c9458ca81" class="sites-navigation-link">Release Status</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/roadmap" jotid="wuid:gx:60ea3587cace173b" class="sites-navigation-link">Roadmap</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/download" jotid="wuid:gx:5b9a06a7bd768d08" class="sites-navigation-link">Download</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/preview-channel" jotid="wuid:gx:65c33e76aa1e249e" class="sites-navigation-link">Preview Channel</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/recent" jotid="wuid:gx:2d257f949510e1ed" class="sites-navigation-link">Recent Changes</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/tech-docs" jotid="wuid:gx:68695c8c797f5a75" class="sites-navigation-link">Technical docs</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/tech-docs/new-build-system" jotid="wuid:gx:7f79556dd5cace7" class="sites-navigation-link">New Build System</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_09830101249604128" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotid="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/knownissues" jotid="wuid:gx:2a2ed1d61165c57f" class="sites-navigation-link">Known Issues</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/tips" jotid="wuid:gx:11629b864408db4c" class="sites-navigation-link">Tips</a></div></li></ul></div></div>
<div xmlns="http://www.w3.org/1999/xhtml" id="COMP_42875732108950615" class="sites-embed" role="navigation"><div class="sites-embed-content sites-sidebar-nav"><ul role="navigation" jotid="navList"><li class="nav-first "><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/build" jotid="wuid:gx:138a85800bd6b1df" class="sites-navigation-link">Build Overview</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/contributing" jotid="wuid:gx:1f3267453e2dafcc" class="sites-navigation-link">Contributing</a></div></li><li class=""><div dir="ltr" style="padding-left: 5px;"><a href="http://tools.android.com/feedback" jotid="wuid:gx:5b9bc58701d69f2" class="sites-navigation-link">Feedback</a></div></li></ul></div></div>
</td>
<td id="sites-canvas-wrapper">
<div id="sites-canvas" role="main">
<div id="goog-ws-editor-toolbar-container"> </div>
<div xmlns="http://www.w3.org/1999/xhtml" id="title-crumbs" style="">
<a dir="ltr" href="http://tools.android.com/tech-docs">Technical docs</a>‎ &gt; ‎<a dir="ltr" href="http://tools.android.com/tech-docs/new-build-system">New Build System</a>‎ &gt; ‎
  </div>
<h3 xmlns="http://www.w3.org/1999/xhtml" id="sites-page-title-header" style="" align="left">
<span id="sites-page-title" dir="ltr">Gradle Plugin User Guide</span>
</h3>
<div id="sites-canvas-main" class="sites-canvas-main">
<div id="sites-canvas-main-content">
<table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" class="sites-layout-name-one-column sites-layout-hbox"><tbody><tr><td class="sites-layout-tile sites-tile-name-content-1"><div dir="ltr"><div><img src="./../source-others/cleardot.gif" style="display:inline;float:right;margin:5px 0 5px 20px"><div class="sites-embed-align-left-wrapping-off"><div class="sites-embed-border-off sites-embed" style="width:400px;"><div class="sites-embed-content sites-embed-type-toc"><div class="goog-toc sites-embed-toc-maxdepth-6"><p>Contents</p><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Introduction"><strong>1 </strong>Introduction</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Goals-of-the-new-Build-System"><strong>1.1 </strong>Goals of the new Build System</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Why-Gradle-"><strong>1.2 </strong>Why Gradle?</a></li></ol></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Requirements"><strong>2 </strong>Requirements</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Basic-Project"><strong>3 </strong>Basic Project</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Simple-build-files"><strong>3.1 </strong>Simple build files</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Project-Structure"><strong>3.2 </strong>Project Structure</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Configuring-the-Structure"><strong>3.2.1 </strong>Configuring the Structure</a></li></ol></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Build-Tasks"><strong>3.3 </strong>Build Tasks</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-General-Tasks"><strong>3.3.1 </strong>General Tasks</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Java-project-tasks"><strong>3.3.2 </strong>Java project tasks</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Android-tasks"><strong>3.3.3 </strong>Android tasks</a></li></ol></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Basic-Build-Customization"><strong>3.4 </strong>Basic Build Customization</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Manifest-entries"><strong>3.4.1 </strong>Manifest entries</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Build-Types"><strong>3.4.2 </strong>Build Types</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Signing-Configurations"><strong>3.4.3 </strong>Signing Configurations</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Running-ProGuard"><strong>3.4.4 </strong>Running ProGuard</a></li></ol></li></ol></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Dependencies-Android-Libraries-and-Multi-project-setup"><strong>4 </strong>Dependencies, Android Libraries and Multi-project setup</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Dependencies-on-binary-packages"><strong>4.1 </strong>Dependencies on binary packages</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Local-packages"><strong>4.1.1 </strong>Local packages</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Remote-artifacts"><strong>4.1.2 </strong>Remote artifacts</a></li></ol></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Multi-project-setup"><strong>4.2 </strong>Multi project setup</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Library-projects"><strong>4.3 </strong>Library projects</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Creating-a-Library-Project"><strong>4.3.1 </strong>Creating a Library Project</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Differences-between-a-Project-and-a-Library-Project"><strong>4.3.2 </strong>Differences between a Project and a Library Project</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Referencing-a-Library"><strong>4.3.3 </strong>Referencing a Library</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Library-Publication"><strong>4.3.4 </strong>Library Publication</a></li></ol></li></ol></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Testing"><strong>5 </strong>Testing</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Basics-and-Configuration"><strong>5.1 </strong>Basics and Configuration</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Running-tests"><strong>5.2 </strong>Running tests</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Testing-Android-Libraries"><strong>5.3 </strong>Testing Android Libraries</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Test-reports"><strong>5.4 </strong>Test reports</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Single-projects"><strong>5.4.1 </strong>Single projects</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Multi-projects-reports"><strong>5.4.2 </strong>Multi-projects reports</a></li></ol></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Lint-support"><strong>5.5 </strong>Lint support</a></li></ol></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Build-Variants"><strong>6 </strong>Build Variants</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Product-flavors"><strong>6.1 </strong>Product flavors</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Build-Type-Product-Flavor-Build-Variant"><strong>6.2 </strong>Build Type + Product Flavor = Build Variant</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Product-Flavor-Configuration"><strong>6.3 </strong>Product Flavor Configuration</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Sourcesets-and-Dependencies"><strong>6.4 </strong>Sourcesets and Dependencies</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Building-and-Tasks"><strong>6.5 </strong>Building and Tasks</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Testing1"><strong>6.6 </strong>Testing</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Multi-flavor-variants"><strong>6.7 </strong>Multi-flavor variants</a></li></ol></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Advanced-Build-Customization"><strong>7 </strong>Advanced Build Customization</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Build-options"><strong>7.1 </strong>Build options</a><ol class="goog-toc"><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Java-Compilation-options"><strong>7.1.1 </strong>Java Compilation options</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-aapt-options"><strong>7.1.2 </strong>aapt options</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-dex-options"><strong>7.1.3 </strong>dex options</a></li></ol></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Manipulating-tasks"><strong>7.2 </strong>Manipulating tasks</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-BuildType-and-Product-Flavor-property-reference"><strong>7.3 </strong>BuildType and Product Flavor property reference</a></li><li class="goog-toc"><a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Using-sourceCompatibility-1.7"><strong>7.4 </strong>Using sourceCompatibility 1.7</a></li></ol></li></ol></div></div></div></div></div><h2><a name="TOC-Introduction"></a>Introduction</h2><div><b><font color="#ff0000">This documentation is for the Gradle plugin version 0.9. Earlier versions may differ due to non-compatible we are introducing before 1.0.</font></b></div><h3><a name="TOC-Goals-of-the-new-Build-System"></a>Goals of the new Build System</h3><div>The goals of the new build system are:<br><ul><li><span style="font-size:10pt;line-height:1.6">Make it easy to reuse code and resources</span></li><li><span style="line-height:1.6;font-size:10pt">Make it easy to create several variants of an application, either for multi-apk distribution or for different flavors of an application</span></li><li><span style="line-height:1.6;font-size:10pt">Make it easy to configure, extend and customize the build process</span></li><li><span style="line-height:1.6;font-size:10pt">Good IDE integration</span></li></ul></div><div><h3><a name="TOC-Why-Gradle-"></a>Why Gradle?</h3></div><div>Gradle is an advanced build system as well as an advanced build toolkit allowing to create custom build logic through plugins.<br><br>Here are some of its features that made us choose Gradle:<br><ul><li><span style="font-size:10pt;line-height:1.6">Domain Specific Language (DSL) to describe and manipulate the build logic</span></li><li><span style="line-height:1.6;font-size:10pt">Build files are Groovy based and allow mixing of declarative elements through the DSL and using code to manipulate the DSL elements to provide custom logic.</span></li><li><span style="line-height:1.6;font-size:10pt">Built-in dependency management through Maven and/or Ivy.</span></li><li><span style="line-height:1.6;font-size:10pt">Very flexible. Allows using best practices but doesn’t force its own way of doing things.</span></li><li><span style="line-height:1.6;font-size:10pt">Plugins can expose their own DSL and their own API for build files to use.</span></li><li><span style="line-height:1.6;font-size:10pt">Good Tooling API allowing IDE integration</span></li></ul><h2><a name="TOC-Requirements"></a>Requirements</h2><div><ul><li><span style="line-height:1.6;font-size:10pt">Gradle 1.10 or 1.11 or 1.12 with the plugin 0.11.1</span></li><li><span style="line-height:1.6;font-size:10pt">SDK with Build Tools 19.0.0. Some features may require a more recent version.</span></li></ul></div><h2><a name="TOC-Basic-Project"></a>Basic Project</h2></div><div>A Gradle project describes its build in a file called <i>build.gradle</i> located in the root folder of the project.<br><h3><a name="TOC-Simple-build-files"></a>Simple build files</h3></div><div>The most simple Java-only project has the following <i>build.gradle</i>:<br><br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace"> apply plugin: 'java'</font></span></div></blockquote><div><br>This applies the Java plugin, which is packaged with Gradle. The plugin provides everything to build and test Java applications.<br><br>The most simple Android project has the following build.gradle:<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">buildscript {</font></span></div><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; repositories {</font></span></div><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">mavenCentral()<br></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">}</span><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; dependencies {</font></span></div><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; classpath 'com.android.tools.build:gradle:0.11.1'</font></span></div><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; }</font></span></div><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">}</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">apply plugin: 'android'</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; compileSdkVersion 19</font></span></div></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; buildToolsVersion "19.0.0"<br></font></span></div></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">}</font></span></div></blockquote><div><br></div><div>There are 3 main areas to this Android build file:<br><br><font color="#38761d" face="courier new, monospace"><b>buildscript { ... }</b></font> configures the code driving the build.<br>In this case, this declares that it uses the Maven Central repository, and that there is a classpath dependency on a Maven artifact. This artifact is the library that contains the Android plugin for Gradle in version 0.11.1<br>Note: This only affects the code running the build, not the project. The project itself needs to declare its own repositories and dependencies. This will be covered later.<br><br>Then, the <font color="#38761d" face="courier new, monospace"><b>android</b></font> plugin is applied like the Java plugin earlier.<br><br>Finally, <font color="#38761d" face="courier new, monospace"><b>android { ... }</b></font> configures all the parameters for the android build. This is the entry point for the Android DSL.<br>By default, only the compilation target, and the version of the build-tools are needed. This is done with the <font color="#38761d" face="courier new, monospace"><b>compileSdkVersion</b></font>&nbsp;and&nbsp;<b style="background-color:transparent;line-height:1.6;font-size:10pt;color:rgb(56,118,29);font-family:courier new,monospace">buildtoolsVersion</b><span style="background-color:transparent;line-height:1.6;font-size:10pt">&nbsp;properties.</span></div><div>The compilation target is the same as the <font color="#38761d" face="courier new, monospace"><b>target</b></font> property in the project.properties file of the old build system. This new property can either be assigned a int (the api level) or a string with the same value as the previous <b><font color="#38761d" face="courier new, monospace">target</font></b> property.<br><br><b>Important:</b> You should only apply the <font color="#38761d" face="courier new, monospace"><b>android</b></font> plugin. Applying the <b><font color="#38761d" face="courier new, monospace">java</font></b> plugin as well will result in a build error.<br><br><b>Note:</b> You will also need a <i>local.properties</i> file to set the location of the SDK in the same way that the existing SDK requires, using the <font color="#38761d" face="courier new, monospace"><b>sdk.dir</b></font> property.<br>Alternatively, you can set an environment variable called <font color="#38761d" face="courier new, monospace"><b>ANDROID_HOME</b></font>. There is no differences between the two methods, you can use the one you prefer.</div><div><h3><a name="TOC-Project-Structure"></a>Project Structure</h3></div><div><span style="line-height:1.6;font-size:10pt">The basic build files above expect a default folder structure. Gradle follows the concept of convention over configuration, providing sensible default option values when possible.</span></div><div><br>The basic project starts with two components called “source sets”. The main source code and the test code. These live respectively in:</div><span style="line-height:1.6;font-size:10pt"><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">src/main/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">src/androidTest/</font></span></li></ul></span><div><span style="line-height:1.6;font-size:10pt">Inside each of these folders exists folder for each source components.</span><br>For both the Java and Android plugin, the location of the Java source code and the Java resources:<br><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">java/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">resources/</font></span></li></ul></div><div>For the Android plugin, extra files and folders specific to Android:<br><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">AndroidManifest.xml</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">res/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">assets/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">aidl/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">rs/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">jni/</font></span></li></ul>Note: <font face="courier new, monospace">src/</font><span style="font-family:courier new,monospace">androidTest</span><font face="courier new, monospace">/AndroidManifest.xml</font> is not needed as it is created automatically.<br><h4><a name="TOC-Configuring-the-Structure"></a>Configuring the Structure</h4></div><div>When the default project structure isn’t adequate, it is possible to configure it. According to the Gradle documentation, r<span style="line-height:1.6;font-size:10pt">econfiguring the <i>sourceSets</i> for a Java project can be done with the following:</span><br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace" style="font-style:normal">sourceSets {</font></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp; &nbsp; main {</font></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp; &nbsp;&nbsp;</font><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp;&nbsp;</span><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">java {</span></div><font face="courier new, monospace" style="font-style:normal">&nbsp;&nbsp;</font><span style="font-size:10pt;line-height:1.6;font-family:courier new,monospace;font-style:normal">&nbsp;&nbsp;</span><font face="courier new, monospace" style="line-height:1.6;font-size:10pt;font-style:normal">&nbsp;&nbsp;</font><span style="line-height:1.6;font-size:10pt;font-style:normal;font-family:courier new,monospace">&nbsp;&nbsp;</span><font face="courier new, monospace" style="line-height:1.6;font-size:10pt;font-style:normal">&nbsp;&nbsp;</font><span style="line-height:1.6;font-size:10pt;font-style:normal;font-family:courier new,monospace">&nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">srcDir 'src/java'</span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><font face="courier new, monospace" style="font-style:normal">&nbsp;&nbsp;</font><span style="font-size:10pt;line-height:1.6;font-family:courier new,monospace;font-style:normal">&nbsp;&nbsp;</span><font face="courier new, monospace" style="line-height:1.6;font-size:10pt;font-style:normal">&nbsp;&nbsp;</font><span style="line-height:1.6;font-size:10pt;font-style:normal;font-family:courier new,monospace">&nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">}</span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><font face="courier new, monospace" style="font-style:normal">&nbsp;&nbsp;</font><span style="font-size:10pt;line-height:1.6;font-family:courier new,monospace;font-style:normal">&nbsp;&nbsp;</span><font face="courier new, monospace" style="line-height:1.6;font-size:10pt;font-style:normal">&nbsp;&nbsp;</font><span style="line-height:1.6;font-size:10pt;font-style:normal;font-family:courier new,monospace">&nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">resources {</span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><font face="courier new, monospace" style="font-style:normal">&nbsp;&nbsp;</font><span style="font-size:10pt;line-height:1.6;font-family:courier new,monospace;font-style:normal">&nbsp;&nbsp;</span><font face="courier new, monospace" style="line-height:1.6;font-size:10pt;font-style:normal">&nbsp;&nbsp;</font><span style="line-height:1.6;font-size:10pt;font-style:normal;font-family:courier new,monospace">&nbsp;&nbsp;</span><font face="courier new, monospace" style="line-height:1.6;font-size:10pt;font-style:normal">&nbsp;&nbsp;</font><span style="line-height:1.6;font-size:10pt;font-style:normal;font-family:courier new,monospace">&nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">srcDir 'src/resources'</span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><font face="courier new, monospace" style="font-style:normal">&nbsp;&nbsp;</font><span style="font-size:10pt;line-height:1.6;font-family:courier new,monospace;font-style:normal">&nbsp;&nbsp;</span><font face="courier new, monospace" style="line-height:1.6;font-size:10pt;font-style:normal">&nbsp;&nbsp;</font><span style="line-height:1.6;font-size:10pt;font-style:normal;font-family:courier new,monospace">&nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">}</span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><font face="courier new, monospace" style="font-style:normal">&nbsp;&nbsp;</font><span style="font-size:10pt;line-height:1.6;font-family:courier new,monospace;font-style:normal">&nbsp;&nbsp;</span><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span><div><font face="courier new, monospace" style="font-style:normal">}</font></div></blockquote><div><br>Note: <font color="#38761d" face="courier new, monospace"><b>srcDir</b></font> will actually add the given folder to the existing list of source folders (this is not mentioned in the Gradle documentation but this is actually the behavior).<br><br>To replace the default source folders, you will want to use <font color="#38761d" face="courier new, monospace"><b>srcDirs</b></font> instead, which takes an array of path. This also shows a different way of using the objects involved:<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">sourceSets {</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; main.java.srcDirs = ['src/java']</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; main.resources.srcDirs = ['src/resources']</span></div><div><span style="font-style:normal"><font face="courier new, monospace">}</font></span></div></blockquote><br><span style="line-height:1.6;font-size:10pt">For more information, see the Gradle documentation on the Java plugin </span><a href="http://gradle.org/docs/current/userguide/java_plugin.html" style="line-height:1.6;font-size:10pt">here</a><span style="line-height:1.6;font-size:10pt">.</span><br><br>The Android plugin uses a similar syntaxes, but because it uses its own <i>sourceSets</i>, this is done within the <font color="#38761d" face="courier new, monospace"><b>android</b></font> object.<br><span style="line-height:1.6;font-size:10pt">Here’s an example, using the old project structure for the main code and remapping the <font color="#38761d" face="courier new, monospace"><b>androidTest</b></font> <i>sourceSet</i> to the&nbsp;</span><font face="courier new, monospace">tests</font><span style="line-height:1.6;font-size:10pt">&nbsp;folder:</span><br><br><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><span style="font-style:normal"><font face="courier new, monospace">android {</font><font face="courier new, monospace"><br></font><font face="courier new, monospace">&nbsp; &nbsp; sourceSets {</font><font face="courier new, monospace"><br></font><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; main {</font><font face="courier new, monospace"><br></font></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-style:normal"><font face="courier new, monospace">manifest.srcFile 'AndroidManifest.xml'</font><font face="courier new, monospace"><br></font></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">java.srcDirs = ['src']</span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-style:normal"><font face="courier new, monospace">resources.srcDirs = ['src']</font><font face="courier new, monospace"><br></font></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="line-height:1.6;font-size:10pt;font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">aidl.srcDirs = ['src']</font></span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">renderscript.srcDirs = ['src']</span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-style:normal"><font face="courier new, monospace">res.srcDirs = ['res']</font><font face="courier new, monospace"><br></font></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="line-height:1.6;font-size:10pt;font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">assets.srcDirs = ['assets']</font></span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><span style="font-style:normal"><font face="courier new, monospace"><br></font></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal">androidTest</span><span style="font-style:normal"><font face="courier new, monospace">.setRoot('tests')</font><font face="courier new, monospace"><br></font></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-style:normal"><font face="courier new, monospace">}</font><font face="courier new, monospace"><br></font><font face="courier new, monospace">}</font></span></blockquote><br><div>Note: because the old structure put all source files (java, aidl, renderscript, and java resources) in the same folder, we need to remap all those new components of the <i>sourceSet</i> to the same <font color="#38761d" face="courier new, monospace"><b>src</b></font> folder.<br>Note: <font color="#38761d" face="courier new, monospace"><b>setRoot()</b></font> moves the whole <i>sourceSet</i> (and its sub folders) to a new folder. This moves <font color="#38761d" face="courier new, monospace"><b>src/</b></font><b style="color:rgb(56,118,29);font-family:courier new,monospace">androidTest</b><font color="#38761d" face="courier new, monospace"><b>/*</b></font> to <font color="#38761d" face="courier new, monospace"><b>tests/*</b></font><br>This is Android specific and will not work on Java <i>sourceSets</i>.<br><br>The ‘migrated’ sample shows this.</div><div><h3><a name="TOC-Build-Tasks"></a>Build Tasks</h3><h4><a name="TOC-General-Tasks"></a>General Tasks</h4></div><div><span style="line-height:1.6;font-size:10pt">Applying a plugin to the build file automatically creates a set of build tasks to run. Both the Java plugin and the Android plugin do this.</span></div><div><span style="line-height:1.6;font-size:10pt">The convention for tasks is the following:</span><br><ul><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>assemble</b></font><br></span><span style="font-size:10pt;line-height:1.6">The task to assemble the output(s) of the project</span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>check</b></font><br></span><span style="font-size:10pt;line-height:1.6">The task to run all the checks.</span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>build</b></font><br></span><span style="font-size:10pt;line-height:1.6">This task does both&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">assemble</b>&nbsp;and&nbsp;</span><b style="color:rgb(56,118,29);font-family:courier new,monospace">check</b></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>clean</b></font><br></span><span style="font-size:10pt;line-height:1.6">This task cleans the output of the project</span></li></ul><span style="font-size:10pt;line-height:1.6">The tasks&nbsp;</span><b style="color:rgb(56,118,29);font-family:courier new,monospace">assemble</b><span style="font-size:10pt;line-height:1.6">,&nbsp;</span><b style="color:rgb(56,118,29);font-family:courier new,monospace">check</b><span style="font-size:10pt;line-height:1.6">&nbsp;and&nbsp;</span><b style="color:rgb(56,118,29);font-family:courier new,monospace">build</b><span style="font-size:10pt;line-height:1.6">&nbsp;don’t actually do anything. They are anchor tasks for the plugins to add actual tasks that do the work.</span><br><br>This allows you to always call the same task(s) no matter what the type of project is, or what plugins are applied.<br>For instance, applying the <i>findbugs</i> plugin will create a new task and make&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">check</b>&nbsp;depend on it, making it be called whenever the&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">check</b>&nbsp;task is called.<br><br>From the command line you can get the high level task running the following command:<br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">gradle tasks</font></span></div></blockquote><div><br></div><div>For a full list and seeing dependencies between the tasks run:<br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">gradle tasks --all</font></span></div></blockquote><div><br></div><div>Note: Gradle automatically monitor the declared inputs and outputs of a task.<br><span style="line-height:1.6;font-size:10pt">Running the&nbsp;</span><b style="color:rgb(56,118,29);font-family:courier new,monospace">build</b><span style="line-height:1.6;font-size:10pt">&nbsp;twice without change will make Gradle report all tasks as <font face="courier new, monospace">UP-TO-DATE</font>, meaning no work was required. This allows tasks to properly depend on each other without requiring unneeded build operations.</span></div><div><h4><a name="TOC-Java-project-tasks"></a>Java project tasks</h4></div><div>The Java plugin creates mainly two tasks, that are dependencies of the main anchor tasks:<br><ul><li><b style="color:rgb(56,118,29);font-family:courier new,monospace">assemble</b></li><ul><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>jar</b></font><br></span><span style="font-size:10pt;line-height:1.6">This task creates the output.</span></li></ul><li><b style="color:rgb(56,118,29);font-family:courier new,monospace">check</b></li><ul><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>test</b></font><br></span><span style="font-size:10pt;line-height:1.6">This task runs the tests.</span></li></ul></ul>The&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">jar</b>&nbsp;task itself will depend directly and indirectly on other tasks: <b><font color="#38761d" face="courier new, monospace">classes</font></b>&nbsp;for instance will compile the Java code.<br><span style="line-height:1.6;font-size:10pt">The tests are compiled with <b><font color="#38761d" face="courier new, monospace">testClasses</font></b>, but it is rarely useful to call this as&nbsp;</span><b style="color:rgb(56,118,29);font-family:courier new,monospace">test</b><span style="line-height:1.6;font-size:10pt">&nbsp;depends on it (as well as&nbsp;</span><b><font color="#38761d" face="courier new, monospace">classes</font></b><span style="line-height:1.6;font-size:10pt">).</span><br><br>In general, you will probably only ever call&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">assemble</b>&nbsp;or&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">check</b>, and ignore the other tasks.<br><br>You can see the full set of tasks and their descriptions for the Java plugin <a href="http://gradle.org/docs/current/userguide/java_plugin.html">here</a>.<br><h4><a name="TOC-Android-tasks"></a>Android tasks</h4></div><div>The Android plugin use the same convention to stay compatible with other plugins, and adds an additional anchor task:<br><ul><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">assemble</b><br></span><span style="font-size:10pt;line-height:1.6">The task to assemble the output(s) of the project</span></li><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">check</b><br></span><span style="font-size:10pt;line-height:1.6">The task to run all the checks.</span></li><li><b><font color="#38761d" face="courier new, monospace" size="2"><span style="line-height:1.6">connectedCheck</span></font><br></b>Runs checks that requires a connected device or emulator. they will run on all connected devices in parallel.</li><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">deviceCheck</b><br></span><span style="font-size:10pt;line-height:1.6">Runs checks using APIs to connect to remote devices. This is used on CI servers.</span></li><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">build</b><br></span><span style="font-size:10pt;line-height:1.6">This task does both assemble and check</span></li><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">clean</b><br></span><span style="font-size:10pt;line-height:1.6">This task cleans the output of the project</span></li></ul></div><div>The new anchor tasks are necessary in order to be able to run regular checks without needing a connected device.<br>Note that&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">build</b>&nbsp;does not depend on&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">deviceCheck</b>, or <b style="color:rgb(56,118,29);font-family:courier new,monospace">connectedCheck</b>.<br><br>An Android project has at least two outputs: a debug APK and a release APK. Each of these has its own anchor task to facilitate building them separately:<br><ul><li><b style="color:rgb(56,118,29);font-family:courier new,monospace">assemble</b></li><ul><li><b style="color:rgb(56,118,29);font-family:courier new,monospace">assembleDebug</b></li><li><b style="color:rgb(56,118,29);font-family:courier new,monospace">assembleRelease</b></li></ul></ul></div><div>They both depend on other tasks that execute the multiple steps needed to build an APK.&nbsp;The&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">assemble</b>&nbsp;task depends on both, so calling it will build both APKs.<br><br>Tip: Gradle support camel case shortcuts for task names on the command line. For instance:<br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace"> gradle aR</font></span></div></blockquote><div>is the same as typing<br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace"> gradle assembleRelease</font></span></div></blockquote><div>as long as no other task match ‘aR’<br><br>The check anchor tasks have their own dependencies:<br><ul><li><b style="color:rgb(56,118,29);font-family:courier new,monospace">check</b></li><ul><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>lint</b></font></span></li></ul><li><b style="color:rgb(56,118,29);font-family:courier new,monospace">connectedCheck</b></li><ul><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>connectedA</b></font></span><b style="color:rgb(56,118,29);font-family:courier new,monospace">ndroidTest</b></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>connectedUiAutomatorTest</b></font> (not implemented yet)</span></li></ul><li><b style="color:rgb(56,118,29);font-family:courier new,monospace">deviceCheck</b></li><ul><li>This depends on tasks created when other plugins implement test extension points.</li></ul></ul>Finally, the plugin creates install/uninstall tasks for all build types (<font color="#38761d" face="courier new, monospace"><b>debug</b></font>, <b><font color="#38761d" face="courier new, monospace">release</font></b>, <b><font color="#38761d" face="courier new, monospace">test</font></b>), as long as they can be installed (which requires signing).<br><h3><a name="TOC-Basic-Build-Customization"></a>Basic Build Customization</h3></div><div>The Android plugin provides a broad DSL to customize most things directly from the build system.<br><h4><a name="TOC-Manifest-entries"></a>Manifest entries</h4></div><div>Through the DSL it is possible to configure the following manifest entries:<br><ul><li><span style="line-height:1.6;font-size:10pt">minSdkVersion</span></li><li><span style="line-height:1.6;font-size:10pt">targetSdkVersion</span></li><li><span style="line-height:1.6;font-size:10pt">versionCode</span></li><li><span style="line-height:1.6;font-size:10pt">versionName</span></li><li><span style="line-height:1.6;font-size:10pt">applicationId (the effective packageName -- see <a href="http://tools.android.com/tech-docs/new-build-system/applicationid-vs-packagename">ApplicationId versus PackageName</a>&nbsp;for more information)</span></li><li><span style="line-height:1.6;font-size:10pt">Package Name for the test application</span></li><li><span style="line-height:1.6;font-size:10pt">Instrumentation test runner</span></li></ul>Example:<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace" style="font-style:normal">android {</font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; compileSdkVersion 19</span></div></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; buildToolsVersion "19.0.0"</span></div></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><br></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp; &nbsp; defaultConfig {</font></div><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp; &nbsp;</span><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">versionCode 12</span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp; &nbsp;</span><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt;font-style:normal">&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">versionName "2.0"</span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">minSdkVersion 16<br></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">targetSdkVersion 16<br></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">}</span><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br>The <font color="#38761d" face="courier new, monospace"><b>defaultConfig</b></font> element inside the <font color="#38761d" face="courier new, monospace"><b>android</b></font> element is where all this configuration is defined.</div><div><br></div><div>Previous versions of the Android Plugin used packageName to configure the manifest 'packageName' attribute.</div><div>Starting in 0.11.0, you should use applicationId in the build.gradle to configure the manifest 'packageName' entry.</div><div>This was disambiguated to reduce confusion between the application's packageName (which is its ID) and&nbsp;</div><div>java packages.<br><br>The power of describing it in the build file is that it can be dynamic.<br>For instance, one could be reading the version name from a file somewhere or using some custom logic:<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">def computeVersionName() {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; ...</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; compileSdkVersion 19</span></div><div><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; buildToolsVersion "19.0.0"</span></div><div><br></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; defaultConfig {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; versionCode 12</span></div><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">versionName computeVersionName()<br></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">minSdkVersion 16<br></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">targetSdkVersion 16<br></span><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; </span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">}</span><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>Note: Do not use function names that could conflict with existing getters in the given scope. For instance instance defaultConfig { ...} calling getVersionName() will automatically use the getter of defaultConfig.getVersionName() instead of the custom method.</div><div><br>If a property is not set through the DSL, some default value will be used. Here’s a table of how this is processed.<br><table border="1" bordercolor="#888" cellspacing="0" style="border-collapse:collapse;border-color:rgb(136,136,136);border-width:1px"><tbody><tr><td style="width:208px;height:19px">&nbsp;Property Name</td><td style="width:168px;height:19px">&nbsp;Default value in DSL object</td><td style="width:251px;height:19px">&nbsp;Default value</td></tr><tr><td style="width:208px;height:20px">&nbsp;<font color="#38761d" face="courier new, monospace"><b>versionCode</b></font></td><td style="width:168px;height:20px">&nbsp;-1</td><td style="width:251px;height:20px">&nbsp;value from manifest if present</td></tr><tr><td style="width:208px;height:20px">&nbsp;<font color="#38761d" face="courier new, monospace"><b>versionName</b></font></td><td style="width:168px;height:20px">&nbsp;null</td><td style="width:251px;height:20px">&nbsp;value from manifest if present</td></tr><tr><td style="width:208px;height:20px">&nbsp;<font color="#38761d" face="courier new, monospace"><b>minSdkVersion</b></font></td><td style="width:168px;height:20px">&nbsp;-1</td><td style="width:251px;height:20px">&nbsp;value from manifest if present</td></tr><tr><td style="width:208px;height:20px">&nbsp;<font color="#38761d" face="courier new, monospace"><b>targetSdkVersion</b></font></td><td style="width:168px;height:20px">&nbsp;-1</td><td style="width:251px;height:20px">&nbsp;value from manifest if present</td></tr><tr><td style="width:208px;height:20px">&nbsp;<font color="#38761d" face="courier new, monospace"><b>applicationId</b></font></td><td style="width:168px;height:20px">&nbsp;null</td><td style="width:251px;height:20px">&nbsp;value from manifest if present</td></tr><tr><td style="width:208px;height:20px">&nbsp;<font color="#38761d" face="courier new, monospace"><b>testApplicationId</b></font></td><td style="width:168px;height:20px">&nbsp;null</td><td style="width:251px;height:20px">&nbsp;applicationId + “.test”</td></tr><tr><td style="width:208px;height:20px">&nbsp;<font color="#38761d" face="courier new, monospace"><b>testInstrumentationRunner</b></font></td><td style="width:168px;height:20px">&nbsp;null</td><td style="width:251px;height:20px">&nbsp;android.test.InstrumentationTestRunner</td></tr><tr><td style="width:208px;height:19px">&nbsp;<font color="#38761d" face="courier new, monospace"><b>signingConfig</b></font></td><td style="width:168px;height:19px">&nbsp;null</td><td style="width:251px;height:19px">&nbsp;null</td></tr><tr><td>&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">proguardFile</b></td><td>&nbsp;N/A (set only)</td><td>&nbsp;N/A (set only)</td></tr><tr><td>&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">proguardFiles</b></td><td>&nbsp;N/A (set only)</td><td>&nbsp;N/A (set only)&nbsp;</td></tr></tbody></table><br><br>The value of the 2nd column is important if you use custom logic in the build script that queries these properties. For instance, you could write:<br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace"><span style="line-height:1.6;font-size:10pt;font-style:normal">if (android.defaultConfig.testInstrumentationRunner == null) {</span></font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; // assign a better default...</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>If the value remains null, then it is replaced at build time by the actual default from column 3, but the DSL element does not contain this default value so you can't query against it.<br><span style="line-height:1.6;font-size:10pt">This is to prevent parsing the manifest of the application unless it’s really needed.&nbsp;</span><br><h4><a name="TOC-Build-Types"></a>Build Types</h4></div><div><span style="line-height:1.6;font-size:10pt">By default, the Android plugin automatically sets up the project to build both a debug and a release version of the application.</span></div><div><span style="line-height:1.6;font-size:10pt">These differ mostly around the ability to debug the application on a secure (non dev) devices, and how the APK is signed.</span><br><br>The debug version is signed with a key/certificate that is created automatically with a known name/password (to prevent required prompt during the build). The release is not signed during the build, this needs to happen after.<br><br>This configuration is done through an object called a <font color="#38761d" face="courier new, monospace"><b>BuildType</b></font>. By default, 2 instances are created, a <b><font color="#38761d" face="courier new, monospace">debug</font></b> and a <font color="#38761d" face="courier new, monospace"><b>release</b></font> one.<br><br>The Android plugin allows customizing those two instances as well as creating other <i>Build Types</i>. This is done with the <font color="#38761d" face="courier new, monospace"><b>buildTypes</b></font> DSL container:<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; buildTypes {</span></div><div><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">debug {</span></div><div><span style="line-height:1.6;font-size:10pt;font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="line-height:1.6;font-size:10pt;font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp;&nbsp;</span><span style="line-height:1.6;font-size:10pt;font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; applicationId</span><span style="line-height:1.6;font-size:10pt;font-family:courier new,monospace;font-style:normal">Suffix    ".debug"</span></div></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-family:courier new,monospace;font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; j</font></span><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">nidebug.initWith(buildTypes.debug)</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; jnidebug {</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; packageNameSuffix   ".jnidebug"</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jniDebuggable true</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br>The above snippet achieves the following:<br><ul><li><span style="line-height:1.6;font-size:10pt">Configures the default <font color="#38761d" face="courier new, monospace"><b>debug</b></font> <i>Build Type</i>:</span></li><ul><li><span style="line-height:1.6;font-size:10pt">set its package to be <font face="courier new, monospace">&lt;app appliationId&gt;.debug</font> to be able to install both <i>debug</i> and <i>release</i> apk on the same device</span></li></ul><li><span style="line-height:1.6;font-size:10pt">Creates a new <i>BuildType</i> called <font color="#38761d" face="courier new, monospace"><b>jnidebug</b></font> and configure it to be a copy of the <font color="#38761d" face="courier new, monospace"><b>debug</b></font> build type.</span></li><li><span style="line-height:1.6;font-size:10pt">Keep configuring the&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">jnidebug</b>, by enabling debug build of the JNI component, and add a different package suffix.</span></li></ul>Creating new <i>Build Types</i> is as easy as using a new element under the <font color="#38761d" face="courier new, monospace"><b>buildTypes</b></font> container, either to call <font color="#38761d" face="courier new, monospace"><b>initWith()</b></font> or to configure it with a closure.<br><br>The possible properties and their default values are:<br><br><table border="1" bordercolor="#888" cellspacing="0" style="border-collapse:collapse;border-color:rgb(136,136,136);border-width:1px"><tbody><tr><td style="width:198px;height:19px">&nbsp;Property name</td><td style="width:195px;height:19px">&nbsp;Default values for debug</td><td style="width:241px;height:19px">&nbsp;Default values for release / other</td></tr><tr><td style="width:198px;height:20px">&nbsp;<font color="#38761d" face="courier new, monospace"><b>debuggable</b></font></td><td style="width:195px;height:20px">&nbsp;true</td><td style="width:241px;height:20px">&nbsp;false</td></tr><tr><td style="width:198px;height:20px">&nbsp;<font color="#38761d" face="courier new, monospace"><b>jniDebuggable</b></font></td><td style="width:195px;height:20px">&nbsp;false</td><td style="width:241px;height:20px">&nbsp;false</td></tr><tr><td style="width:198px;height:19px">&nbsp;<b><font color="#38761d" face="courier new, monospace">renderscriptDebuggable</font></b></td><td style="width:195px;height:19px">&nbsp;false</td><td style="width:241px;height:19px">&nbsp;false</td></tr><tr><td style="width:198px;height:20px">&nbsp;<b><font color="#38761d" face="courier new, monospace">renderscriptOptimLevel</font></b></td><td style="width:195px;height:20px">&nbsp;3</td><td style="width:241px;height:20px">&nbsp;3</td></tr><tr><td style="width:198px;height:20px">&nbsp;<b><font color="#38761d" face="courier new, monospace">applicationIdSuffix</font></b></td><td style="width:195px;height:20px">&nbsp;null</td><td style="width:241px;height:20px">&nbsp;null</td></tr><tr><td style="width:198px;height:20px">&nbsp;<b><font color="#38761d" face="courier new, monospace">versionNameSuffix</font></b></td><td style="width:195px;height:20px">&nbsp;null</td><td style="width:241px;height:20px">&nbsp;null</td></tr><tr><td style="width:198px;height:20px">&nbsp;<b><font color="#38761d" face="courier new, monospace">signingConfig</font></b></td><td style="width:195px;height:20px">&nbsp;android.signingConfigs.debug</td><td style="width:241px;height:20px">&nbsp;null</td></tr><tr><td style="width:198px;height:20px">&nbsp;<b><font color="#38761d" face="courier new, monospace">zipAlignEnabled</font></b></td><td style="width:195px;height:20px">&nbsp;false</td><td style="width:241px;height:20px">&nbsp;true</td></tr><tr><td>&nbsp;<b><font color="#38761d" face="courier new, monospace">minifyEnabled</font></b></td><td>&nbsp;false</td><td>&nbsp;false</td></tr><tr><td>&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">proguardFile</b></td><td>&nbsp;N/A (set only)</td><td>&nbsp;N/A (set only)</td></tr><tr><td>&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">proguardFiles</b></td><td>&nbsp;N/A (set only)</td><td>&nbsp;N/A (set only)</td></tr></tbody></table><br><br>In addition to these properties, <i>Build Types</i> can contribute to the build with code and resources.<br>For each Build Type, a new matching <i>sourceSet</i> is created, with a default location of<br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace"> src/&lt;buildtypename&gt;/</font></span></div></blockquote><div>This means the <i>Build Type</i> names cannot be <i>main</i> or <i>androidTest</i> (this is enforced by the plugin), and that they have to be unique to each other.<br><br>Like any other source sets, the location of the build type source set can be relocated:<br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; sourceSets.jnidebug.setRoot('foo/jnidebug')</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div>Additionally, for each <i>Build Type</i>, a new <font face="courier new, monospace">assemble&lt;BuildTypeName&gt;</font> task is created.<br><br>The <font color="#38761d" face="courier new, monospace"><b>assembleDebug</b></font> and <font color="#38761d" face="courier new, monospace"><b>assembleRelease</b></font> tasks have already been mentioned, and this is where they come from. When the <font color="#38761d" face="courier new, monospace"><b>debug</b></font> and <font color="#38761d" face="courier new, monospace"><b>release</b></font>&nbsp;<i>Build Types</i> are pre-created, their tasks are automatically created as well.<br><br>The <i>build.gradle</i> snippet above would then also generate an <font color="#38761d" face="courier new, monospace"><b>assembleJnidebug</b></font> task, and <b><font color="#38761d" face="courier new, monospace">assemble</font></b> would be made to depend on it the same way it depends on the <font color="#38761d" face="courier new, monospace"><b>assembleDebug</b></font> and&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">assembleRelease</b>&nbsp;tasks.<br><br>Tip: remember that you can type <font face="courier new, monospace">gradle aJ</font> to run the&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">assembleJnidebug</b>&nbsp;task.<br><br>Possible use case:<br><ul><li><span style="font-size:10pt;line-height:1.6">Permissions in debug mode only, but not in release mode</span></li><li><span style="line-height:1.6;font-size:10pt">Custom implementation for debugging</span></li><li><span style="line-height:1.6;font-size:10pt">Different resources for debug mode (for instance when a resource value is tied to the signing certificate).</span></li></ul>The code/resources of the <i>BuildType</i> are used in the following way:<br><ul><li><span style="font-size:10pt;line-height:1.6">The manifest is merged into the app manifest</span></li><li><span style="line-height:1.6;font-size:10pt">The code acts as just another source folder</span></li><li><span style="line-height:1.6;font-size:10pt">The resources are overlayed over the main resources, replacing existing values.</span></li></ul><h4><a name="TOC-Signing-Configurations"></a>Signing Configurations</h4></div><div>Signing an application requires the following:<br><ul><li><span style="font-size:10pt;line-height:1.6">A keystore</span></li><li><span style="line-height:1.6;font-size:10pt">A keystore password</span></li><li><span style="line-height:1.6;font-size:10pt">A key alias name</span></li><li><span style="line-height:1.6;font-size:10pt">A key password</span></li><li><span style="line-height:1.6;font-size:10pt">The store type</span></li></ul>The location, as well as the key name, both passwords and store type form together a Signing Configuration (type <i>SigningConfig</i>)<br><br>By default, there is a <font color="#38761d" face="courier new, monospace"><b>debug</b></font> configuration that is setup to use a debug keystore, with a known password and a default key with a known password.<br>The debug keystore is located in <font face="courier new, monospace">$HOME/.android/debug.keystore</font>, and is created if not present.<br><br>The&nbsp;<b style="line-height:1.6;font-size:10pt;color:rgb(56,118,29);font-family:courier new,monospace">debug</b><span style="line-height:1.6;font-size:10pt">&nbsp;<i>Build Type</i> is set to use this&nbsp;</span><b style="color:rgb(56,118,29);font-family:courier new,monospace">debug</b><span style="line-height:1.6;font-size:10pt">&nbsp;<i>SigningConfig</i> automatically.</span></div><div><br>It is possible to create other configurations or customize the default built-in one. This is done through the <font color="#38761d" face="courier new, monospace"><b>signingConfigs</b></font> DSL container:<br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-size:10pt;line-height:1.6;font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; signingConfigs {</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; debug {</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; storeFile file("debug.keystore")</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; myConfig {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; storeFile file("other.keystore")</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; storePassword "android"</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; keyAlias "androiddebugkey"</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; keyPassword "android"</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; buildTypes {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; foo {</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; debuggable true</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jniDebuggable true</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; signingConfig signingConfigs.myConfig</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp;&nbsp;</font></span><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div>The above snippet changes the location of the debug keystore to be at the root of the project. This automatically impacts any <i>Build Types</i> that are set to using it, in this case the&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">debug</b>&nbsp;<i>Build Type</i>.<br><br>It also creates a new <i>Signing Config</i> and a new <i>Build Type</i> that uses the new configuration.<br><br>Note: Only debug keystores located in the default location will be automatically created. Changing the location of the debug keystore will not create it on-demand. Creating a <i>SigningConfig</i> with a different name that uses the default debug keystore location will create it automatically. In other words, it’s tied to the location of the keystore, not the name of the configuration.<br><br>Note: Location of keystores are usually relative to the root of the project, but could be absolute paths, thought it is not recommended (except for the debug one since it is automatically created).</div><div><br></div><div><b>Note: &nbsp;If you are checking these files into version control, you may not want the password in the file. The following Stack Overflow post shows ways to read the values from the console, or from environment variables.</b></div><div><a href="http://stackoverflow.com/questions/18328730/how-to-create-a-release-signed-apk-file-using-gradle">http://stackoverflow.com/questions/18328730/how-to-create-a-release-signed-apk-file-using-gradle</a></div><div><b>We'll update this guide with more detailed information later.</b><br><h4><a name="TOC-Running-ProGuard"></a>Running ProGuard</h4><div>ProGuard is supported through the Gradle plugin for ProGuard version 4.10. The ProGuard plugin is applied automatically, and the tasks are created automatically if the <i>Build Type</i> is configured to run ProGuard through the <i>minifyEnabled</i> property.</div><div><br></div></div><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt">android {</span><br><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; buildTypes {</span><br><span style="font-family:courier new,monospace;font-size:10pt;line-height:1.6">&nbsp; &nbsp; &nbsp; &nbsp; release {</span><br><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; minifyEnabled true</span><br><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; proguardFile getDefaultProguardFile('proguard-android.txt')</span><br><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span><br><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span><br><div><div><font face="courier new, monospace"><span style="font-style:normal"><br></span></font></div></div><div><div><font face="courier new, monospace"><span style="font-style:normal">&nbsp; &nbsp; productFlavors {</span></font></div></div><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; flavor1 {</span><br><div><div><font face="courier new, monospace"><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; }</span></font></div></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; flavor2 {</span></div><span style="font-family:courier new,monospace;font-size:10pt;line-height:1.6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; proguardFile 'some-other-rules.txt'</span><br><div><div><font face="courier new, monospace"><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; }</span></font></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div></div></blockquote></div><span style="font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span><br><div><div><span style="font-style:normal"><font face="courier new, monospace">}</font></span></div></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="arial, sans-serif">Variants use all the rules files declared in their build type, and product flavors.</font></span></div><div><span style="font-style:normal"><font face="arial, sans-serif"><br></font></span></div><div><span style="font-style:normal"><font face="arial, sans-serif">There are 2 default rules files</font></span></div><div><ul><li><font face="arial, sans-serif">proguard-android.txt</font></li><li><font face="arial, sans-serif">proguard-android-optimize.txt</font></li></ul><div><font face="arial, sans-serif">They are located in the SDK. Using <i>getDefaultProguardFile()</i> will return the full path to the files. They are identical except for enabling optimizations.</font></div></div><div><h2><a name="TOC-Dependencies-Android-Libraries-and-Multi-project-setup"></a>Dependencies, Android Libraries and Multi-project setup</h2></div><div>Gradle projects can have dependencies on other components. These components can be external binary packages, or other Gradle projects.<br><h3><a name="TOC-Dependencies-on-binary-packages"></a>Dependencies on binary packages</h3><h4><a name="TOC-Local-packages"></a>Local packages</h4></div><div>To configure a dependency on an external library jar, you need to add a dependency on the <font color="#38761d" face="courier new, monospace"><b>compile</b></font> configuration.<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">dependencies {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; compile files('libs/foo.jar')</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">android {</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; ...</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br>Note: the <font color="#38761d" face="courier new, monospace"><b>dependencies</b></font> DSL element is part of the standard Gradle API and does not belong inside the <b><font color="#38761d" face="courier new, monospace">android</font></b> element.<br><br>The&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">compile</b>&nbsp;configuration is used to compile the main application. Everything in it is added to the compilation classpath <b>and</b> also packaged in the final APK.<br>There are other possible configurations to add dependencies to:<br><ul><li><span style="font-size:10pt;line-height:1.6"><b style="color:rgb(56,118,29);font-family:courier new,monospace">compile</b>: main application</span></li><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace"><b>androidTest</b>Compile</b>: test application</span></li><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">debugCompile</b>: debug Build Type</span></li><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">releaseCompile</b>: release Build Type.</span></li></ul>Because it’s not possible to build an APK that does not have an associated <i>Build Type</i>, the APK is always configured with two (or more) configurations:&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">compile</b>&nbsp;and <font face="courier new, monospace">&lt;buildtype&gt;Compile</font>.<br><span style="line-height:1.6;font-size:10pt">Creating a new </span><i style="line-height:1.6;font-size:10pt">Build Type</i><span style="line-height:1.6;font-size:10pt"> automatically creates a new configuration based on its name.</span><br><br>This can be useful if the debug version needs to use a custom library (to report crashes for instance), while the release doesn’t, or if they rely on different versions of the same library.<br><h4><a name="TOC-Remote-artifacts"></a>Remote artifacts</h4></div><div>Gradle supports pulling artifacts from Maven and Ivy repositories.<br><br>First the repository must be added to the list, and then the dependency must be declared in a way that Maven or Ivy declare their artifacts.<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">repositories {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; mavenCentral()</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">dependencies {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; compile 'com.google.guava:guava:11.0.2'</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">android {</span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp;&nbsp;</font></span><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">...</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br>Note: <font color="#38761d" face="courier new, monospace"><b>mavenCentral()</b></font> is a shortcut to specifying the URL of the repository. Gradle supports both remote and local repositories.<br><span style="line-height:1.6;font-size:10pt">Note: Gradle will follow all dependencies transitively. This means that if a dependency has dependencies of its own, those are pulled in as well.</span><br><br>For more information about setting up dependencies, read the Gradle user guide <a href="http://gradle.org/docs/current/userguide/artifact_dependencies_tutorial.html">here</a>, and DSL documentation <a href="http://gradle.org/docs/current/dsl/org.gradle.api.artifacts.dsl.DependencyHandler.html">here</a>.<br><h3><a name="TOC-Multi-project-setup"></a>Multi project setup</h3></div><div>Gradle projects can also depend on other gradle projects by using a multi-project setup.<br><br>A multi-project setup usually works by having all the projects as sub folders of a given root project.<br><br>For instance, given to following structure:<br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">MyProject/</font></span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp;+ app/</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp;+ libraries/</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; + lib1/</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; + lib2/</span></div></blockquote><div><br></div><div>We can identify 3 projects. Gradle will reference them with the following name:<br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace"> :app</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace"> :libraries:lib1</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace"> :libraries:lib2</font></span></div></blockquote><div><br>Each projects will have its own build.gradle declaring how it gets built.<br>Additionally, there will be a file called <i>settings.gradle</i> at the root declaring the projects.<br>This gives the following structure:<br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">MyProject/</font></span></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp;| settings.gradle</font></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp;+ app/</font></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp; &nbsp; | build.gradle</font></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp;+ libraries/</font></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp; &nbsp; + lib1/</font></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp;| build.gradle</font></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp; &nbsp; + lib2/</font></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp;| build.gradle</font></div></blockquote><div><br>The content of settings.gradle is very simple:<br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><font face="courier new, monospace" style="font-style:normal"> include ':app', ':libraries:lib1', ':libraries:lib2'</font></div></blockquote><div><span style="line-height:1.6;font-size:10pt">This defines which folder is actually a Gradle project.</span></div><div><br>The <font color="#38761d" face="courier new, monospace"><b>:app</b></font> project is likely to depend on the libraries, and this is done by declaring the following dependencies:<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace"><span style="line-height:1.6;font-size:10pt;font-style:normal">dependencies {</span></font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; compile project(':libraries:lib1')</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br>More general information about multi-project setup <a href="http://gradle.org/docs/current/userguide/multi_project_builds.html">here</a>.<br><h3><a name="TOC-Library-projects"></a>Library projects</h3></div><div>In the above multi-project setup,&nbsp;<span style="font-family:courier new,monospace"><b><font color="#38761d">:libraries:lib1</font></b></span>&nbsp;and&nbsp;<b style="font-family:courier new,monospace"><font color="#38761d">:libraries:lib2</font></b>&nbsp;can be Java projects, and the&nbsp;<b style="line-height:1.6;font-size:10pt;color:rgb(56,118,29);font-family:courier new,monospace">:app</b><span style="line-height:1.6;font-size:10pt">&nbsp;Android project will use their <i>jar</i> output.</span></div><div><br>However, if you want to share code that accesses Android APIs or uses Android-style resources, these libraries cannot be regular Java project, they have to be Android Library Projects.<br><h4><a name="TOC-Creating-a-Library-Project"></a>Creating a Library Project</h4></div><div>A Library project is very similar to a regular Android project with a few differences.<br><br>Since building libraries is different than building applications, a different plugin is used. Internally both plugins share most of the same code and they are both provided by the same <font face="courier new, monospace">com.android.tools.build.gradle</font> jar.<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">buildscript {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; repositories {</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; mavenCentral()</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; dependencies {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; classpath 'com.android.tools.build:gradle:0.5.6'</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">apply plugin: 'android-library'</span></div><div><br></div><div><span style="font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; compileSdkVersion 15</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>This creates a library project that uses API 15 to compile. <i>SourceSets</i>, and dependencies are handled the same as they are in an application project and can be customized the same way.<br><h4><a name="TOC-Differences-between-a-Project-and-a-Library-Project"></a>Differences between a Project and a Library Project</h4></div><div>A Library project's main output is an&nbsp;<i>.aar</i> package (which stands for Android archive). It is a combination of compile code (as a jar file and/or native .so files) and resources (manifest, res, assets).</div><div>A library project can also generate a test apk to test the library independently from an application.</div><div><br>The same anchor tasks are used for this (<b><font color="#38761d" face="courier new, monospace" style="background-color:rgb(255,255,255)">assembleDebug</font></b>, <b><font color="#38761d" face="courier new, monospace">assembleRelease</font></b>) so there’s no difference in commands to build such a project.<br><br></div><div>For the rest, libraries behave the same as application projects. They have build types and product flavors, and can potentially generate more than one version of the aar.</div><div><div><span style="background-color:transparent;line-height:1.6;font-size:10pt">Note that most of the configuration of the&nbsp;</span><i style="background-color:transparent;line-height:1.6;font-size:10pt">Build Type</i><span style="background-color:transparent;line-height:1.6;font-size:10pt">&nbsp;do not apply to library projects. However you can use the custom&nbsp;</span><i style="background-color:transparent;line-height:1.6;font-size:10pt">sourceSet</i><span style="background-color:transparent;line-height:1.6;font-size:10pt">&nbsp;to change the content of the library depending on whether it’s used by a project or being tested.</span></div></div><h4><a name="TOC-Referencing-a-Library"></a><span style="background-color:transparent;font-size:1.2em;line-height:1.6">Referencing a Library</span></h4><div>Referencing a library is done the same way any other project is referenced:<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">dependencies {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; compile project(':libraries:lib1')</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; compile project(':libraries:lib2')</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>Note: if you have more than one library, then the order will be important. This is similar to the old build system where the order of the dependencies in the project.properties file was important.<br><h4><a name="TOC-Library-Publication"></a><font size="3">Library Publication</font></h4></div><div>By default a library only publishes its <i>release</i> variant. This variant will be used by all projects referencing the library, no matter which variant they build themselves. This is a temporary limitation due to Gradle limitations that we are working towards removing.</div><div><br></div><div>You can control which variant gets published with&nbsp;</div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp;&nbsp;defaultPublishConfig "debug"</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">}</font></span></div></blockquote><div><br></div><div>Note that this publishing configuration name references the full variant name. <i>Release</i> and <i>debug</i> are only applicable when there are no flavors. If you wanted to change the default published variant while using flavors, you would write:</div><div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp;&nbsp;defaultPublishConfig "flavor1Debug"</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">}</font></span></div></blockquote><div><font face="arial, sans-serif"><br></font></div><font face="arial, sans-serif">It is also possible to publish all variants of a library. We are planning to allow this while using a normal project-to-project dependency (like shown above), but this is not possible right now due to limitations in Gradle (we are working toward fixing those as well).</font></div><div><font face="arial, sans-serif">Publishing of all variants are not enabled by default. To enable them:<br></font><div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp;&nbsp;publishNonDefault true</font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">}</font></span></div></blockquote><font face="courier new, monospace"><br></font></div></div><div><font face="arial, sans-serif">It is important to realize that publishing multiple variants means publishing multiple aar files, instead of a single aar containing multiple variants. Each aar packaging contains a single variant.</font></div><div><font face="arial, sans-serif">Publishing an variant means making this aar available as an output artifact of the Gradle project. This can then be used either when publishing to a maven repository, or when another project creates a dependency on the library project.</font></div><div><font face="arial, sans-serif"><br></font></div><div><font face="arial, sans-serif">Gradle has a concept of default" artifact. This is the one that is used when writing:</font></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="font-family:courier new,monospace;font-style:normal">compile project(':libraries:lib2')</span></div></blockquote><div><font face="arial, sans-serif"><br></font></div><div><font face="arial, sans-serif">To create a dependency on another published artifact, you need to specify which one to use:</font></div><div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">dependencies {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; flavor1Compile project(path: ':lib1', configuration: 'flavor1Release')</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; flavor2Compile project(path: ':lib1', configuration: 'flavor2Release')</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><font face="arial, sans-serif"><b><div><font face="arial, sans-serif"><b><br></b></font></div>Important:</b> Note that the published configuration is a full variant, including the build type, and needs to be referenced as such.&nbsp;</font></div><div><b style="font-family:arial,sans-serif">Important:</b><span style="font-family:arial,sans-serif">&nbsp;When enabling publishing of non default, the Maven publishing plugin will publish these additional variants as extra packages (with classifier). This means that this is not really compatible with publishing to a maven repository. You should either publish a single variant to a repository OR enable all config publishing for inter-project dependencies.</span></div><div><h2><a name="TOC-Testing"></a>Testing</h2></div><div>Building a test application is integrated into the application project. There is no need for a separate test project anymore.<br><h3><a name="TOC-Basics-and-Configuration"></a>Basics and Configuration</h3></div><div>As mentioned previously, next to the <b><font color="#38761d" face="courier new, monospace">main</font></b> <i>sourceSet</i> is the&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">androidTest</b>&nbsp;<i>sourceSet</i>, located by default in <font face="courier new, monospace">src/</font><span style="font-family:courier new,monospace">androidTest</span><font face="courier new, monospace">/</font><br><span style="line-height:1.6;font-size:10pt">From this&nbsp;</span><i style="line-height:1.6;font-size:10pt">sourceSet</i><span style="line-height:1.6;font-size:10pt">&nbsp;is built a test apk that can be deployed to a device to test the application using the Android testing framework. This can contain unit tests, instrumentation tests, and later uiautomator tests.</span><br><span style="line-height:1.6;font-size:10pt">The&nbsp;</span><i style="line-height:1.6;font-size:10pt">sourceSet</i><span style="line-height:1.6;font-size:10pt">&nbsp;should not contain an </span><font face="courier new, monospace" style="line-height:1.6;font-size:10pt">AndroidManifest.xml</font><span style="line-height:1.6;font-size:10pt"> as it is automatically generated.</span><br><br>There are a few values that can be configured for the test app:<br><ul><li><span style="font-size:10pt;line-height:1.6"><font color="#38761d" face="courier new, monospace"><b>testPackageName</b></font></span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>testInstrumentationRunner</b></font></span></li><li><b style="color:rgb(56,118,29);font-family:courier new,monospace;font-size:10pt;line-height:1.6;background-color:transparent"><p style="display:inline!important">testHandleProfiling</p></b></li><li><b style="background-color:transparent;line-height:1.6;font-size:10pt;color:rgb(56,118,29);font-family:courier new,monospace"><p style="display:inline!important">testFunctionalTest</p></b></li></ul>As seen previously, those are configured in the <font color="#38761d" face="courier new, monospace"><b>defaultConfig</b></font> object:<br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; defaultConfig {</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; testPackageName "com.test.foo"</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; testInstrumentationRunner "android.test.InstrumentationTestRunner"</span></div><div><span style="background-color:transparent;line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; testHandleProfiling true</font></span></div>
<div><span style="font-style:normal"><font face="courier new, monospace"><span style="background-color:transparent;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="background-color:transparent;line-height:1.6;font-size:10pt">testFunctionalTest true</span></font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>The value of the <font face="courier new, monospace">targetPackage</font> attribute of the <font face="courier new, monospace">instrumentation</font> node in the test application manifest is automatically filled with the package name of the tested app, even if it is customized through the&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">defaultConfig</b>&nbsp;and/or the<i> Build Type</i> objects. This is one of the reason the manifest is generated automatically.<br><br>Additionally, the <i>sourceSet</i> can be configured to have its own dependencies.<br>By default, the application and its own dependencies are added to the test app classpath, but this can be extended with <br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace"><span style="line-height:1.6;font-size:10pt;font-style:normal">dependencies {</span></font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal">androidTest</span><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">Compile 'com.google.guava:guava:11.0.2'</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>The test app is built by the task <b><font color="#38761d" face="courier new, monospace">assembleTest</font></b>. It is not a dependency of the main&nbsp;<b><font color="#38761d" face="courier new, monospace">assemble</font></b>&nbsp;task, and is instead called automatically when the tests are set to run.<br><br>Currently only one <i>Build Type</i> is tested. By default it is the <b><font color="#38761d" face="courier new, monospace">debug</font></b> <i>Build Type</i>, but this can be reconfigured with:<br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace"><span style="line-height:1.6;font-size:10pt;font-style:normal">android {</span></font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; ...</span></div><div><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6">&nbsp; &nbsp; testBuildType  "staging"</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><h3><a name="TOC-Running-tests"></a>Running tests</h3><div>As mentioned previously, checks requiring a connected device are launched with the anchor task called&nbsp;<b style="background-color:transparent;line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace">connectedCheck</font></b><span style="background-color:transparent;line-height:1.6;font-size:10pt">.</span></div><div><span style="line-height:1.6;font-size:10pt">This depends on the task&nbsp;</span><b style="color:rgb(56,118,29);font-family:courier new,monospace">androidTest</b><span style="line-height:1.6;font-size:10pt">&nbsp;and therefore will run it. This task does the following:</span><br><ul><li><span style="line-height:1.6;font-size:10pt">Ensure the app and the test app are built (depending on&nbsp;</span><b style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace">assembleDebug</font></b><span style="line-height:1.6;font-size:10pt">&nbsp;and&nbsp;</span><b style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace">assembleTest</font></b><span style="line-height:1.6;font-size:10pt">)</span></li><li><span style="line-height:1.6;font-size:10pt">Install both apps</span></li><li><span style="line-height:1.6;font-size:10pt">Run the tests</span></li><li><span style="line-height:1.6;font-size:10pt">Uninstall both apps.</span></li></ul>If more than one device is connected, all tests are run in parallel on all connected devices.&nbsp;<span style="line-height:1.6;font-size:10pt">If one of the test fails, on any device, the build will fail.</span><br><br>All test results are stored as XML files under<br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><font face="courier new, monospace"> build/androidTest-results</font></div></blockquote><div>(This is similar to regular jUnit results that are stored under build/test-results)<br><br>This can be configured with<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; ...</span></div><div><br></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; testOptions {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; resultsDir = "$project.buildDir/foo/results"</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>The value of <b><font color="#38761d" face="courier new, monospace">android.testOptions.resultsDir</font></b> is evaluated with <b><font color="#38761d" face="courier new, monospace">Project.file(String)</font></b><br><h3><a name="TOC-Testing-Android-Libraries"></a>Testing Android Libraries</h3></div><div>Testing Android Library project is done exactly the same way as application projects.<br><br>The only difference is that the whole library (and its dependencies) is automatically added as a Library dependency to the test app. The result is that the test APK includes not only its own code, but also the library itself and all its dependencies.<br>The manifest of the Library is merged into the manifest of the test app (as is the case for any project referencing this Library).<br><br>The&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">androidTest</b>&nbsp;task is changed to only install (and uninstall) the test APK (since there are no other APK to install.)<br><br>Everything else is identical.</div><div><h3><a name="TOC-Test-reports"></a>Test reports</h3></div><div>When running unit tests, Gradle outputs an HTML report to easily look at the results.<br><span style="line-height:1.6;font-size:10pt">The Android plugins build on this and extends the HTML report to aggregate the results from all connected devices.</span><br><h4><a name="TOC-Single-projects"></a>Single projects</h4></div><div>The project is automatically generated upon running the tests. Its default location is<br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace"> build/reports/</font></span><span style="font-family:courier new,monospace;font-style:normal">androidTest</span><span style="font-style:normal"><font face="courier new, monospace">s</font></span></div></blockquote><div><br>This is similar to the jUnit report location, which is <font face="courier new, monospace">build/reports/tests</font>, or other reports usually located in <font face="courier new, monospace">build/reports/&lt;plugin&gt;/</font><br><br>The location can be customized with<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; ...</span></div><div><br></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; testOptions {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; reportDir = "$project.buildDir/foo/report"</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div>The report will aggregate tests that ran on different devices.<br><h4><a name="TOC-Multi-projects-reports"></a>Multi-projects reports</h4></div><div>In a multi project setup with application(s) and library(ies) projects, when running all tests at the same time, it might be useful to generate a single reports for all tests.<br><br>To do this, a different plugin is available in the same artifact. It can be applied with:<br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace"><span style="line-height:1.6;font-size:10pt;font-style:normal">buildscript {</span></font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; repositories {</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; mavenCentral()</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><font face="courier new, monospace" style="font-style:normal"><br></font></div><div><font face="courier new, monospace" style="font-style:normal">&nbsp; &nbsp; dependencies {</font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; classpath 'com.android.tools.build:gradle:0.5.6'</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div><div><br></div><div><font face="courier new, monospace" style="font-style:normal">apply plugin: 'android-reporting'</font></div></blockquote><div><br></div><div>This should be applied to the root project, ie in <i>build.gradle</i> next to <i>settings.gradle</i><br><br>Then from the root folder, the following command line will run all the tests and aggregate the reports:<br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="font-style:normal"><font face="courier new, monospace"> gradle deviceCheck mergeAndroidReports --continue</font></span></div></blockquote><div><br>Note: the <font face="courier new, monospace">--continue</font> option ensure that all tests, from all sub-projects will be run even if one of them fails. Without it the first failing test will interrupt the run and not all projects may have their tests run.<br><h3><a name="TOC-Lint-support"></a>Lint support</h3></div><div>As of version 0.7.0, you can run lint for a specific variant, or for all variants, in which case it produces a report which describes which specific variants a given issue applies to.</div><div><br></div><div>You can configure lint by adding a lintOptions section like following. You typically only specify a few of these; this section shows all the available options.</div><div><br></div><div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">android {</font></span></div></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6;background-color:transparent">&nbsp; &nbsp; lintOptions {</span></div></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace"><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// set to true to turn off analysis progress reporting by lint</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; quiet true</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// if true, stop the gradle build if errors are found</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; abortOnError false</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// if true, only report errors</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; ignoreWarnings true</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// if true, emit full/absolute paths to files with errors (true by default)</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; //absolutePaths true</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// if true, check all issues, including those that are off by default</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; checkAllWarnings true</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// if true, treat all warnings as errors</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; warningsAsErrors true</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// turn off checking the given issue id's</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; disable 'TypographyFractions','TypographyQuotes'</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// turn on the given issue id's</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; enable 'RtlHardcoded','RtlCompat', 'RtlEnabled'</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// check *only* the given issue id's</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; check 'NewApi', 'InlinedApi'</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// if true, don't include source code lines in the error output</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; noLines true</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// if true, show all locations for an error, do not truncate lists, etc.</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; showAll true</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// Fallback lint configuration (default severities, etc.)</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; lintConfig file("default-lint.xml")</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// if true, generate a text report of issues (false by default)</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; textReport true</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// location to write the output; can be a file or 'stdout'</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; textOutput 'stdout'</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// if true, generate an XML report for use by for example Jenkins</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; xmlReport false</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// file to write report to (if not specified, defaults to lint-results.xml)</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; xmlOutput file("lint-report.xml")</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// if true, generate an HTML report (with issue explanations, sourcecode, etc)</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; htmlReport true</div><div><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; </span>// optional path to report (default will be lint-results.html in the builddir)</div><div style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; htmlOutput file("lint-report.html")</div><div style="font-style:normal"><br></div><div style="font-style:normal"><blockquote style="font-family:Arial,Verdana,sans-serif;font-size:21px;line-height:34.133331298828125px;margin:0px 0px 0px 40px;border:none;padding:0px"><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp;// set to true to have all release builds run lint on issues with severity=fatal</span></font></blockquote><blockquote style="font-family:Arial,Verdana,sans-serif;font-size:21px;line-height:34.133331298828125px;margin:0px 0px 0px 40px;border:none;padding:0px"><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp;// and abort the build (controlled by abortOnError above) if fatal issues are found</span></font></blockquote><blockquote style="font-family:Arial,Verdana,sans-serif;font-size:21px;line-height:34.133331298828125px;margin:0px 0px 0px 40px;border:none;padding:0px"><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp;checkReleaseBuilds true</span></font></blockquote><div style="font-family:Arial,Verdana,sans-serif;font-size:21px;font-style:italic;line-height:34.133331298828125px"><div><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp; &nbsp; &nbsp; // Set the severity of the given issues to fatal (which means they will be</span></font></div><div><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp; &nbsp; &nbsp; // checked during release builds (even if the lint target is not included)</span></font></div><div><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp; &nbsp; &nbsp; fatal 'NewApi', 'InlineApi'</span></font></div><div><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp; &nbsp; &nbsp; // Set the severity of the given issues to error</span></font></div><div><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp; &nbsp; &nbsp; error 'Wakelock', 'TextViewEdits'</span></font></div><div><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp; &nbsp; &nbsp; // Set the severity of the given issues to warning</span></font></div><div><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp; &nbsp; &nbsp; warning 'ResourceAsColor'</span></font></div><div><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp; &nbsp; &nbsp; // Set the severity of the given issues to ignore (same as disabling the check)</span></font></div><div><font face="courier new, monospace" size="2"><span style="font-style:normal;line-height:21.333332061767578px">&nbsp; &nbsp; &nbsp; &nbsp; ignore 'TypographyQuotes'</span></font></div><div><span style="font-style:normal;font-family:courier new,monospace;font-size:10pt;line-height:1.6;background-color:transparent">&nbsp; &nbsp; }</span></div></div></div></font></span></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-family:courier new,monospace;font-size:10pt;font-style:normal;line-height:1.6;background-color:transparent">}</span></div></blockquote><h2><a name="TOC-Build-Variants"></a>Build Variants</h2></div><div>One goal of the new build system is to enable creating different versions of the same application.<br><br>There are two main use cases:<br><ol><li><span style="line-height:1.6;font-size:10pt">Different versions of the same application<br></span><span style="font-size:10pt;line-height:1.6">For instance, a free/demo version vs the “pro” paid application.</span></li><li><span style="line-height:1.6;font-size:10pt">Same application packaged differently for multi-apk in Google Play Store.<br></span><span style="line-height:1.6;font-size:10pt">See </span><a href="http://developer.android.com/google/play/publishing/multiple-apks.html" style="line-height:1.6;font-size:10pt">http://developer.android.com/google/play/publishing/multiple-apks.html</a><span style="line-height:1.6;font-size:10pt"> for more information.</span></li><li><span style="line-height:1.6;font-size:10pt">A combination of 1. and 2.&nbsp;</span></li></ol>The goal was to be able to generate these different APKs from the same project, as opposed to using a single Library Projects and 2+ Application Projects.<br><h3><a name="TOC-Product-flavors"></a>Product flavors</h3></div><div>A product flavor defines a customized version of the application build by the project. A single project can have different flavors which change the generated application.<br><br>This new concept is designed to help when the differences are very minimum. If the answer to “Is this the same application?” is yes, then this is probably the way to go over Library Projects.<br><br>Product flavors are declared using a <b><font color="#38761d" face="courier new, monospace">productFlavors</font></b> DSL container:<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace" style="font-style:normal">android {</font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; ....</span></div><div><font face="courier new, monospace" style="font-style:normal"><br></font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; productFlavors {</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; flavor1 {</span></div><div><font face="courier new, monospace"><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...</span></font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt"><br></span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; flavor2 {</span></div><div><font face="courier new, monospace"><span style="font-style:normal">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...</span></font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>This creates two flavors, called <font color="#38761d" face="courier new, monospace"><b>flavor1</b></font> and&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">flavor2</b>.<br>Note: The name of the flavors cannot collide with existing <i>Build Type</i> names, or with the&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">androidTest</b>&nbsp;<i>sourceSet</i>.<br><h3><a name="TOC-Build-Type-Product-Flavor-Build-Variant"></a>Build Type + Product Flavor = Build Variant</h3></div><div>As we have seen before, each <i>Build Type</i> generates a new APK.<br><br><i>Product Flavors</i> do the same:&nbsp;the output of the project becomes all possible combinations of <i>Build Types</i> and, if applicable, <i>Product Flavors</i>.<br><br>Each (<i>Build Type</i>, <i>Product Flavor</i>) combination is called a <i>Build Variant</i>.<br><br>For instance, with the default <b><font color="#38761d" face="courier new, monospace">debug</font></b> and <b><font color="#38761d" face="courier new, monospace">release</font></b> <i>Build Types</i>, the above example generates four <i>Build Variants</i>:<br><ul><li><span style="font-size:10pt;line-height:1.6">Flavor1 - debug</span></li><li><span style="line-height:1.6;font-size:10pt">Flavor1 - release</span></li><li><span style="line-height:1.6;font-size:10pt">Flavor2 - debug</span></li><li><span style="line-height:1.6;font-size:10pt">Flavor2 - release</span></li></ul>Projects with no flavors still have <i>Build Variants</i>, but the single <font color="#38761d" face="courier new, monospace"><b>default</b></font> flavor/config is used, nameless, making the list of variants similar to the list of <i>Build Types</i>.<br><h3><a name="TOC-Product-Flavor-Configuration"></a>Product Flavor Configuration</h3></div><div>Each flavors is configured with a closure:<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace" style="font-style:normal">android {</font></div><div><font face="courier new, monospace"><span style="font-style:normal">&nbsp; &nbsp; ...</span></font></div><div><font face="courier new, monospace" style="font-style:normal"><br></font></div><div><span style="font-style:normal;line-height:1.6;font-size:10pt"><font face="courier new, monospace">&nbsp; &nbsp; defaultConfig {</font></span></div><div><span style="font-style:normal;line-height:1.6;font-size:10pt"><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; minSdkVersion 8</font></span></div><div><span style="font-style:normal;line-height:1.6;font-size:10pt"><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; versionCode 10</font></span></div><div><span style="font-style:normal;line-height:1.6;font-size:10pt"><font face="courier new, monospace">&nbsp; &nbsp; }</font></span></div><div><font face="courier new, monospace" style="font-style:normal"><br></font></div><div><span style="font-style:normal;line-height:1.6;font-size:10pt"><font face="courier new, monospace">&nbsp; &nbsp; productFlavors {</font></span></div><div><span style="font-style:normal;line-height:1.6;font-size:10pt"><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; flavor1 {</font></span></div><div><span style="font-style:normal;line-height:1.6;font-size:10pt"><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; packageName "com.example.flavor1"</font></span></div><div><font face="courier new, monospace"><span style="line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="font-style:normal;line-height:1.6;font-size:10pt">versionCode 20</span></font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt"><br></span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; flavor2 {</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; packageName "com.example.flavor2"</span></div><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></span><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">minSdkVersion 14</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>Note that the <font color="#38761d" face="courier new, monospace"><b>android.productFlavors.*</b></font> objects are of type <i>ProductFlavor</i> which is the same type as the <font color="#38761d" face="courier new, monospace"><b>android.defaultConfig</b></font> object. This means they share the same properties.<br><br><font color="#38761d" face="courier new, monospace"><b>defaultConfig</b></font> provides the base configuration for all flavors and each flavor can override any value. In the example above, the configurations end up being:<br><br><ul><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>flavor1</b></font></span></li><ul><li><span style="line-height:1.6;font-size:10pt"><b><font color="#38761d" face="courier new, monospace">packageName</font></b>: com.example.flavor1</span></li><li><span style="line-height:1.6;font-size:10pt"><b><font color="#38761d" face="courier new, monospace">minSdkVersion</font></b>: 8</span></li><li><span style="line-height:1.6;font-size:10pt"><b><font color="#38761d" face="courier new, monospace">versionCode</font></b>: 20</span></li></ul><li><b style="color:rgb(56,118,29);font-family:courier new,monospace">flavor2</b></li><ul><li><span style="line-height:1.6;font-size:10pt"><b><font color="#38761d" face="courier new, monospace">packageName</font></b>: com.example.flavor2</span></li><li><span style="line-height:1.6;font-size:10pt"><b><font color="#38761d" face="courier new, monospace">minSdkVersion</font></b>: 14</span></li><li><span style="line-height:1.6;font-size:10pt"><b><font color="#38761d" face="courier new, monospace">versionCode</font></b>: 10</span></li></ul></ul>Usually, the <i>Build Type</i> configuration is an overlay over the other configuration. For instance, the <i>Build Type</i>'s&nbsp;<b><font color="#38761d" face="courier new, monospace">packageNameSuffix</font></b>&nbsp;is appended to the <i>Product Flavor</i>'s&nbsp;<b><font color="#38761d" face="courier new, monospace">packageName</font></b>.<br><br>There are cases where a setting is settable on both the <i>Build Type</i> and the <i>Product Flavor</i>. In this case, it’s is on a case by case basis.<br><br>For instance,&nbsp;<b><font color="#38761d" face="courier new, monospace">signingConfig</font></b> is one of these properties.<br>This enables either having all release packages share the same S<i>igningConfig</i>, by setting <font color="#38761d" face="courier new, monospace"><b>android.buildTypes.release.signingConfig</b></font>, or have each release package use their own S<i>igningConfig</i> by setting each <font color="#38761d" face="courier new, monospace"><b>android.productFlavors.*.signingConfig</b></font> objects separately.<br><h3><a name="TOC-Sourcesets-and-Dependencies"></a>Sourcesets and Dependencies</h3></div><div>Similar to <i>Build Types</i>, <i>Product Flavors</i> also contribute code and resources through their own <i>sourceSets</i>.<br><br>The above example creates four <i>sourceSets</i>:<br><ul><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>android.sourceSets.flavor1</b></font><br></span><span style="font-size:10pt;line-height:1.6">Location <font face="courier new, monospace">src/flavor1/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">android.sourceSets.flavor2</b><br></span><span style="font-size:10pt;line-height:1.6">Location <font face="courier new, monospace">src/flavor2/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">android.sourceSets.<b>androidTest</b>Flavor1</b><br></span><span style="font-size:10pt;line-height:1.6">Location <font face="courier new, monospace">src/androidTestFlavor1/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">android.sourceSets.<b>androidTest</b>Flavor2</b><br></span><span style="font-size:10pt;line-height:1.6">Location <font face="courier new, monospace">src/androidTestFlavor2/</font></span></li></ul>Those <i>sourceSets</i> are used to build the APK, alongside <font color="#38761d" face="courier new, monospace"><b>android.sourceSets.main</b></font> and the <i>Build Type sourceSet</i>.<br><br>The following rules are used when dealing with all the sourcesets used to build a single APK:<br><ul><li><span style="font-size:10pt;line-height:1.6">All source code (<font face="courier new, monospace">src/*/java</font>) are used together as multiple folders generating a single output.</span></li><li><span style="line-height:1.6;font-size:10pt">Manifests are all merged together into a single manifest. This allows <i>Product Flavors</i> to have different components and/or permissions, similarly to <i>Build Types</i>.</span></li><li><span style="line-height:1.6;font-size:10pt">All resources (Android res and assets) are used using overlay priority where the <i>Build Type</i> overrides the <i>Product Flavor</i>, which overrides the <font color="#38761d" face="courier new, monospace"><b>main</b></font> <i>sourceSet</i>.</span></li><li><span style="line-height:1.6;font-size:10pt">Each <i>Build Variant</i>&nbsp;generates its own R class (or other generated source code) from the resources. Nothing is shared between variants.</span></li></ul><br></div><div>Finally, like <i>Build Types</i>, <i>Product Flavors</i> can have their own dependencies. For instance, if the flavors are used to generate a ads-based app and a paid app, one of the flavors could have a dependency on an Ads SDK, while the other does not.<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace" style="font-style:normal">dependencies {</font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; flavor1Compile "..."</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div>In this particular case, the file <font face="courier new, monospace">src/flavor1/AndroidManifest.xml</font> would probably need to include the internet permission.</div><div><br></div><div>Additional sourcesets are also created for each variants:</div><div><ul><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>android.sourceSets.flavor1Debug</b></font><br></span><span style="font-size:10pt;line-height:1.6">Location&nbsp;<font face="courier new, monospace">src/flavor1Debug/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>android.sourceSets.flavor1Release</b></font><br></span><span style="font-size:10pt;line-height:1.6">Location&nbsp;<font face="courier new, monospace">src/flavor1Release/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>android.sourceSets.flavor2Debug</b></font><br></span><span style="font-size:10pt;line-height:1.6">Location&nbsp;<font face="courier new, monospace">src/flavor2Debug/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>android.sourceSets.flavor2Release</b></font><br></span><span style="font-size:10pt;line-height:1.6">Location&nbsp;<font face="courier new, monospace">src/flavor2Release/</font></span></li></ul><div><font face="arial, sans-serif">These have higher priority than the build type sourcesets, and allow customization at the variant level.</font></div><h3><a name="TOC-Building-and-Tasks"></a>Building and Tasks</h3></div><div>We previously saw that each <i>Build Type</i> creates its own <font face="courier new, monospace">assemble&lt;name&gt;</font> task, but that <i>Build Variants</i> are a combination of <i>Build Type</i> and <i>Product Flavor</i>.<br><br>When <i>Product Flavors</i> are used, more assemble-type tasks are created. These are:<br><ol><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">assemble&lt;Variant Name&gt;</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">assemble&lt;Build Type Name&gt;</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">assemble&lt;Product Flavor Name&gt;</font></span></li></ol>#1 allows directly building a single variant. For instance <font color="#38761d" face="courier new, monospace"><b>assembleFlavor1Debug</b></font>.<br><br>#2 allows building all APKs for a given Build Type. For instance&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">assembleDebug</b>&nbsp;will build both <font face="courier new, monospace">Flavor1Debug</font> and <font face="courier new, monospace">Flavor2Debug</font> variants.<br><br>#3 allows building all APKs for a given flavor. For instance&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">assembleFlavor1</b>&nbsp;will build both <font face="courier new, monospace">Flavor1Debug</font> and <font face="courier new, monospace">Flavor1Release</font> variants.<br><br>The task&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">assemble</b>&nbsp;will build all possible variants.<br><h3><a name="TOC-Testing1"></a>Testing</h3>Testing multi-flavors project is very similar to simpler projects.<br><br>The&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">androidTest</b>&nbsp;sourceset is used for common tests across all flavors, while each flavor can also have its own tests.<br><br>As mentioned above, <i>sourceSets</i> to test each flavor are created:<br><ul><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">android.sourceSets.<b>androidTest</b>Flavor1</b><br></span><span style="font-size:10pt;line-height:1.6">Location&nbsp;<font face="courier new, monospace">src/androidTestFlavor1/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><b style="color:rgb(56,118,29);font-family:courier new,monospace">android.sourceSets.<b>androidTest</b>Flavor2</b><br></span><span style="font-size:10pt;line-height:1.6">Location&nbsp;<font face="courier new, monospace">src/androidTestFlavor2/</font></span></li></ul><br>Similarly, those can have their own dependencies:<br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">dependencies {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal">androidTest</span><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">Flavor1Compile "..."</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>Running the tests can be done through the main <font color="#38761d" face="courier new, monospace"><b>deviceCheck</b></font> anchor task, or the main&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">androidTest</b>&nbsp;tasks which acts as an anchor task when flavors are used.<br><br>Each flavor has its own task to run tests:&nbsp;<span style="font-family:courier new,monospace">androidTest</span><font face="courier new, monospace">&lt;VariantName&gt;</font>. For instance:<br><ul><li><span style="font-size:10pt;line-height:1.6"><font color="#38761d" face="courier new, monospace"><b><b>androidTest</b>Flavor1Debug</b></font></span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b><b>androidTest</b>Flavor2Debug</b></font></span></li></ul>Similarly, test APK building tasks and install/uninstall tasks are per variant:<br><ul><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>assembleFlavor1Test</b></font></span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>installFlavor1Debug</b></font></span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>installFlavor1Test</b></font></span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>uninstallFlavor1Debug</b></font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">...</font></span></li></ul>Finally the HTML report generation supports aggregation by flavor.<br>The location of the test results and reports is as follows, first for the per flavor version, and then for the aggregated one:<br><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">build/androidTest-results/flavors/&lt;FlavorName&gt;</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">build/androidTest-results/all/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">build/reports/androidTests/flavors&lt;FlavorName&gt;</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">build/reports/androidTests/all/</font></span></li></ul>Customizing either path, will only change the root folder and still create sub folders per-flavor and aggregated results/reports.<br><h3><a name="TOC-Multi-flavor-variants"></a>Multi-flavor variants</h3></div><div>In some case, one may want to create several versions of the same apps based on more than one criteria.<br>For instance, multi-apk support in Google Play supports 4 different filters. Creating different APKs split on each filter requires being able to use more than one dimension of <i>Product Flavors</i>.<br><br>Consider the example of a game that has a demo and a paid version and wants to use the ABI filter in the multi-apk support. With 3 ABIs and two versions of the application, 6 APKs needs to be generated (not counting the variants introduced by the different <i>Build Types</i>).<br>However, the code of the paid version is the same for all three ABIs, so creating simply 6 flavors is not the way to go.<br>Instead, there are two dimensions of flavors, and variants should automatically build all possible combinations.<br><br>This feature is implemented using Flavor Dimensions. Flavors are assigned to a specific dimension<br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">android {</font></span></div><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; ...</font></span></div><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; flavorDimensions "abi", "version"</span></div><div><br></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; productFlavors {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; freeapp {</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flavorDimension "version"</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span></div><div><span style="font-style:normal"><font face="courier new, monospace"><br></font></span></div><div><span style="font-style:normal"><font face="courier new, monospace">&nbsp; &nbsp; &nbsp; &nbsp; x86 {</font></span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="font-family:courier new,monospace;font-style:normal;line-height:21.3333320617676px">flavorDimension</span><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp;"abi"</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; }</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-family:courier new,monospace;font-style:normal;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>The <b><font color="#38761d" face="courier new, monospace">android.flavorDimensions</font></b>&nbsp;array defines the possible dimensions, as well as the order. Each defined <i>Product Flavor</i> is assigned to a dimension.<br><br>From the following dimensioned&nbsp;<i>Product Flavors</i> [freeapp, paidapp] and [x86, arm, mips] and the [debug, release] <i>Build Types</i>, the following build variants will be created:<br><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">x86-freeapp-debug</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">x86-freeapp-release</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">arm-freeapp-debug</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">arm-freeapp-release</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">mips-freeapp-debug</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">mips-freeapp-release</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">x86-paidapp-debug</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">x86-paidapp-release</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">arm-paidapp-debug</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">arm-paidapp-release</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">mips-paidapp-debug</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">mips-paidapp-release</font></span></li></ul>The order of the dimension as defined by&nbsp;<b><font color="#38761d" face="courier new, monospace">android.flavorDimensions&nbsp;</font></b>is very important.<br><br>Each variant is configured by several <i>Product Flavor</i> objects:<br><ul><li><span style="font-size:10pt;line-height:1.6"><font color="#38761d" face="courier new, monospace"><b>android.defaultConfig</b></font></span></li><li><span style="line-height:1.6;font-size:10pt">One from the abi dimension</span></li><li><span style="line-height:1.6;font-size:10pt">One from the version dimension</span></li></ul>The order of the dimension drives which flavor override the other, which is important for resources when a value in a flavor replaces a value defined in a lower priority flavor.<br><span style="line-height:1.6;font-size:10pt">The flavor dimension is defined with higher priority first. So in this case:</span><br></div><blockquote style="margin:0 0 0 40px;border:none;padding:0px"><div><span style="line-height:1.6;font-size:10pt;font-style:normal"><font face="courier new, monospace">abi &gt; version &gt; defaultConfig</font></span></div></blockquote><div><br></div><div>Multi-flavors projects also have additional sourcesets, similar to the variant sourcesets but without the build type:</div><div><br></div><div><ul><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>android.sourceSets.x86Freeapp</b></font><br></span><span style="font-size:10pt;line-height:1.6">Location&nbsp;<font face="courier new, monospace">src/x86Freeapp/</font></span></li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>android.sourceSets.armPaidapp</b></font><br></span><span style="font-size:10pt;line-height:1.6">Location&nbsp;<font face="courier new, monospace">src/armPaidapp/</font></span></li><li><font face="arial, sans-serif">etc...</font></li></ul></div><div>These allow customization at the flavor-combination level. They have higher priority than the basic flavor sourcesets, but lower priority than the build type sourcesets.</div><div><h2><a name="TOC-Advanced-Build-Customization"></a>Advanced Build Customization</h2><h3><a name="TOC-Build-options"></a>Build options</h3><h4><a name="TOC-Java-Compilation-options"></a>Java Compilation options</h4></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace" style="font-style:normal">android {</font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; compileOptions {</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; sourceCompatibility = "1.6"</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; targetCompatibility = "1.6"</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div>Default value is “1.6”. This affect all tasks compiling Java source code.<br><br><h4><a name="TOC-aapt-options"></a>aapt options</h4></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace" style="font-style:normal">android {</font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; aaptOptions {</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; noCompress 'foo', 'bar'</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; ignoreAssetsPattern "!.svn:!.git:!.ds_store:!*.scc:.*:&lt;dir&gt;_*:!CVS:!thumbs.db:!picasa.ini:!*~"</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>This affects all tasks using <font face="courier new, monospace">aapt</font>.</div><div><h4><a name="TOC-dex-options"></a>dex options</h4></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace" style="font-style:normal">android {</font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; dexOptions {</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; &nbsp; &nbsp; incremental false</span></div></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt"><span>&nbsp;&nbsp; &nbsp;<span>&nbsp; &nbsp; preDexLibraries = false</span></span><br></span></div></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt"><span><span><span>&nbsp;&nbsp; &nbsp;<span>&nbsp; &nbsp; jumboMode = false</span></span><br></span></span></span></div></blockquote><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">&nbsp; &nbsp; }</span></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div>This affects all tasks using dex.<br><h3><a name="TOC-Manipulating-tasks"></a>Manipulating tasks</h3></div><div>Basic Java projects have a finite set of tasks that all work together to create an output.<br>The <font color="#38761d" face="courier new, monospace"><b>classes</b></font> task is the one that compile the Java source code.<br>It’s easy to access from <i>build.gradle</i> by simply using&nbsp;<b style="color:rgb(56,118,29);font-family:courier new,monospace">classes</b>&nbsp;in a script. This is a shortcut for <font color="#38761d" face="courier new, monospace"><b>project.tasks.classes</b></font>.<br><br>In Android projects, this is a bit more complicated because there could be a large number of the same task and their name is generated based on the <i>Build Types</i> and <i>Product Flavors</i>.<br><br>In order to fix this, the <b><font color="#38761d" face="courier new, monospace">android</font></b> object has two properties:<br><ul><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>applicationVariants</b></font></span> (only for the app plugin)</li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>libraryVariants</b></font></span>&nbsp;(only for the library plugin)</li><li><span style="line-height:1.6;font-size:10pt"><font color="#38761d" face="courier new, monospace"><b>testVariants</b></font></span>&nbsp;(for both plugins)</li></ul>All three return a <a href="http://www.gradle.org/docs/current/javadoc/org/gradle/api/DomainObjectCollection.html">DomainObjectCollection</a> of&nbsp;<font face="courier new, monospace">ApplicationVariant</font>, <font face="courier new, monospace">LibraryVariant</font>, and <font face="courier new, monospace">TestVariant</font> objects respectively.<br><br>Note that accessing any of these collections will trigger the creations of all the tasks. This means no (re)configuration should take place after accessing the collections.<br><br>The <font face="courier new, monospace">DomainObjectCollection</font> gives access to all the objects directly, or through filters which can be convenient.<br><br></div><blockquote style="margin:0px 0px 0px 40px;border:none;padding:0px"><div><font face="courier new, monospace"><span style="line-height:1.6;font-size:10pt;font-style:normal">android.applicationVariants.each { variant -&gt;</span></font></div><div><font face="courier new, monospace"><span style="font-style:normal">&nbsp; &nbsp; ....</span></font></div><div><span style="font-style:normal;font-family:courier new,monospace;line-height:1.6;font-size:10pt">}</span></div></blockquote><div><br></div><div>All three variant classes share the following properties:<br><br><table border="1" bordercolor="#888" cellspacing="0" style="border-collapse:collapse;border-color:rgb(136,136,136);border-width:1px"><tbody><tr><td style="width:180px;height:19px">&nbsp;Property Name</td><td style="width:173px;height:19px">&nbsp;Property Type</td><td style="width:461px;height:19px">&nbsp;Description</td></tr><tr><td style="width:180px;height:19px">&nbsp;name</td><td style="width:173px;height:19px">&nbsp;String</td><td style="width:461px;height:19px">&nbsp;The name of the variant. Guaranteed to be unique.</td></tr><tr><td style="width:180px;height:19px">&nbsp;description</td><td style="width:173px;height:19px">&nbsp;String</td><td style="width:461px;height:19px">&nbsp;Human readable description of the variant.</td></tr><tr><td style="width:180px;height:19px">&nbsp;dirName</td><td style="width:173px;height:19px">&nbsp;String</td><td style="width:461px;height:19px">&nbsp;subfolder name for the variant. Guaranteed to be unique. Maybe more than one folder, ie “debug/flavor1”</td></tr><tr><td style="width:180px;height:19px">&nbsp;baseName</td><td style="width:173px;height:19px">&nbsp;String</td><td style="width:461px;height:19px">&nbsp;Base name of the output(s) of the variant. Guaranteed to be unique.</td></tr><tr><td style="width:180px;height:19px">&nbsp;outputFile</td><td style="width:173px;height:19px">&nbsp;File</td><td style="width:461px;height:19px">&nbsp;The output of the variant. This is a read/write property</td></tr><tr><td style="width:180px;height:19px">&nbsp;processManifest</td><td style="width:173px;height:19px">&nbsp;ProcessManifest</td><td style="width:461px;height:19px">&nbsp;The task that processes the manifest.</td></tr><tr><td style="width:180px;height:19px">&nbsp;aidlCompile</td><td style="width:173px;height:19px">&nbsp;AidlCompile</td><td style="width:461px;height:19px">&nbsp;The task that compiles the AIDL files.</td></tr><tr><td style="width:180px;height:19px">&nbsp;renderscriptCompile</td><td style="width:173px;height:19px">&nbsp;RenderscriptCompile</td><td style="width:461px;height:19px">&nbsp;The task that compiles the Renderscript files.</td></tr><tr><td style="width:180px;height:19px">&nbsp;mergeResources</td><td style="width:173px;height:19px">&nbsp;MergeResources</td><td style="width:461px;height:19px">&nbsp;The task that merges the resources.</td></tr><tr><td style="width:180px;height:19px">&nbsp;mergeAssets</td><td style="width:173px;height:19px">&nbsp;MergeAssets</td><td style="width:461px;height:19px">&nbsp;The task that merges the assets.</td></tr><tr><td style="width:180px;height:19px">&nbsp;processResources</td><td style="width:173px;height:19px">&nbsp;ProcessAndroidResources</td><td style="width:461px;height:19px">&nbsp;The task that processes and compile the Resources.</td></tr><tr><td style="width:180px;height:19px">&nbsp;generateBuildConfig</td><td style="width:173px;height:19px">&nbsp;GenerateBuildConfig</td><td style="width:461px;height:19px">&nbsp;The task that generates the BuildConfig class.</td></tr><tr><td>&nbsp;javaCompile</td><td>&nbsp;JavaCompile</td><td>&nbsp;The task that compiles the Java code.</td></tr><tr><td>&nbsp;processJavaResources</td><td>&nbsp;Copy</td><td>&nbsp;The task that process the Java resources.</td></tr><tr><td>&nbsp;assemble</td><td>&nbsp;DefaultTask</td><td>&nbsp;The assemble anchor task for this variant.</td></tr></tbody></table><br>The <font face="courier new, monospace">ApplicationVariant</font> class adds the following:<br><br><table border="1" bordercolor="#888" cellspacing="0" style="border-collapse:collapse;border-color:rgb(136,136,136);border-width:1px"><tbody><tr><td style="width:180px;height:19px">&nbsp;Property Name</td><td style="width:173px;height:19px">&nbsp;Property Type</td><td style="width:461px;height:19px">&nbsp;Description</td></tr><tr><td style="width:180px;height:19px">&nbsp;buildType</td><td style="width:173px;height:19px">&nbsp;BuildType</td><td style="width:461px;height:19px">&nbsp;The BuildType of the variant.</td></tr><tr><td style="width:180px;height:19px">&nbsp;productFlavors</td><td style="width:173px;height:19px">&nbsp;List&lt;ProductFlavor&gt;</td><td style="width:461px;height:19px">&nbsp;The ProductFlavors of the variant. Always non Null but could be empty.</td></tr><tr><td style="width:180px;height:19px">&nbsp;mergedFlavor</td><td style="width:173px;height:19px">&nbsp;ProductFlavor</td><td style="width:461px;height:19px">&nbsp;The merging of android.defaultConfig and variant.productFlavors</td></tr><tr><td style="width:180px;height:19px">&nbsp;signingConfig</td><td style="width:173px;height:19px">&nbsp;SigningConfig</td><td style="width:461px;height:19px">&nbsp;The SigningConfig object used by this variant</td></tr><tr><td style="width:180px;height:19px">&nbsp;isSigningReady</td><td style="width:173px;height:19px">&nbsp;boolean</td><td style="width:461px;height:19px">&nbsp;true if the variant has all the information needed to be signed.</td></tr><tr><td style="width:180px;height:19px">&nbsp;testVariant</td><td style="width:173px;height:19px">&nbsp;BuildVariant</td><td style="width:461px;height:19px">&nbsp;The TestVariant that will test this variant.</td></tr><tr><td>&nbsp;dex</td><td>&nbsp;Dex</td><td>&nbsp;The task that dex the code. Can be null if the variant is a library.</td></tr><tr><td>&nbsp;packageApplication</td><td>&nbsp;PackageApplication</td><td>&nbsp;The task that makes the final APK. Can be null if the variant is a library.</td></tr><tr><td>&nbsp;zipAlign</td><td>&nbsp;ZipAlign</td><td>&nbsp;The task that zipaligns the apk. Can be null if the variant is a library or if the APK cannot be signed.</td></tr><tr><td style="width:180px;height:19px">&nbsp;install</td><td style="width:173px;height:19px">&nbsp;DefaultTask</td><td style="width:461px;height:19px">&nbsp;The installation task. Can be null.</td></tr><tr><td style="width:180px;height:19px">&nbsp;uninstall</td><td style="width:173px;height:19px">&nbsp;DefaultTask</td><td style="width:461px;height:19px">&nbsp;The uninstallation task.</td></tr></tbody></table><br>The <font face="courier new, monospace">LibraryVariant</font> class adds the following:<br><br><table border="1" bordercolor="#888" cellspacing="0" style="border-collapse:collapse;border-color:rgb(136,136,136);border-width:1px"><tbody><tr><td style="width:180px;height:19px">&nbsp;Property Name</td><td style="width:173px;height:19px">&nbsp;Property Type</td><td style="width:461px;height:19px">&nbsp;Description</td></tr><tr><td style="width:180px;height:19px">&nbsp;buildType</td><td style="width:173px;height:19px">&nbsp;BuildType</td><td style="width:461px;height:19px">&nbsp;The BuildType of the variant.</td></tr><tr><td style="width:180px;height:19px">&nbsp;mergedFlavor</td><td style="width:173px;height:19px">&nbsp;ProductFlavor</td><td style="width:461px;height:19px">&nbsp;The defaultConfig values</td></tr><tr><td style="width:180px;height:19px">&nbsp;testVariant</td><td style="width:173px;height:19px">&nbsp;BuildVariant</td><td style="width:461px;height:19px">&nbsp;The Build Variant that will test this variant.</td></tr><tr><td>&nbsp;packageLibrary</td><td>&nbsp;Zip</td><td>&nbsp;The task that packages the Library AAR archive. Null if not a library.</td></tr></tbody></table><br>The <font face="courier new, monospace">TestVariant</font> class adds the following:<br><br><table border="1" bordercolor="#888" cellspacing="0" style="border-collapse:collapse;border-color:rgb(136,136,136);border-width:1px"><tbody><tr><td style="width:180px;height:19px">&nbsp;Property Name</td><td style="width:173px;height:19px">&nbsp;Property Type</td><td style="width:461px;height:19px">&nbsp;Description</td></tr><tr><td style="width:180px;height:19px">&nbsp;buildType</td><td style="width:173px;height:19px">&nbsp;BuildType</td><td style="width:461px;height:19px">&nbsp;The BuildType of the variant.</td></tr><tr><td style="width:180px;height:19px">&nbsp;productFlavors</td><td style="width:173px;height:19px">&nbsp;List&lt;ProductFlavor&gt;</td><td style="width:461px;height:19px">&nbsp;The ProductFlavors of the variant. Always non Null but could be empty.</td></tr><tr><td style="width:180px;height:19px">&nbsp;mergedFlavor</td><td style="width:173px;height:19px">&nbsp;ProductFlavor</td><td style="width:461px;height:19px">&nbsp;The merging of android.defaultConfig and variant.productFlavors</td></tr><tr><td style="width:180px;height:19px">&nbsp;signingConfig</td><td style="width:173px;height:19px">&nbsp;SigningConfig</td><td style="width:461px;height:19px">&nbsp;The SigningConfig object used by this variant</td></tr><tr><td style="width:180px;height:19px">&nbsp;isSigningReady</td><td style="width:173px;height:19px">&nbsp;boolean</td><td style="width:461px;height:19px">&nbsp;true if the variant has all the information needed to be signed.</td></tr><tr><td style="width:180px;height:19px">&nbsp;testedVariant</td><td style="width:173px;height:19px">&nbsp;BaseVariant</td><td style="width:461px;height:19px">&nbsp;The BaseVariant that is tested by this TestVariant.</td></tr><tr><td>&nbsp;dex</td><td>&nbsp;Dex</td><td>&nbsp;The task that dex the code. Can be null if the variant is a library.</td></tr><tr><td>&nbsp;packageApplication</td><td>&nbsp;PackageApplication</td><td>&nbsp;The task that makes the final APK. Can be null if the variant is a library.</td></tr><tr><td>&nbsp;zipAlign</td><td>&nbsp;ZipAlign</td><td>&nbsp;The task that zipaligns the apk. Can be null if the variant is a library or if the APK cannot be signed.</td></tr><tr><td style="width:180px;height:19px">&nbsp;install</td><td style="width:173px;height:19px">&nbsp;DefaultTask</td><td style="width:461px;height:19px">&nbsp;The installation task. Can be null.</td></tr><tr><td>&nbsp;uninstall</td><td>&nbsp;DefaultTask</td><td>&nbsp;The uninstallation task.</td></tr><tr><td style="width:180px;height:19px">&nbsp;connectedAndroidTest</td><td style="width:173px;height:19px">&nbsp;DefaultTask</td><td style="width:461px;height:19px">&nbsp;The task that runs the android tests on connected devices.</td></tr><tr><td>&nbsp;providerAndroidTest</td><td>&nbsp;DefaultTask</td><td>&nbsp;The task that runs the android tests using the extension API.<br><br></td></tr></tbody></table><span style="line-height:1.6;font-size:10pt"><br></span></div><div><span style="line-height:1.6;font-size:10pt">API for Android specific task types.</span><br><ul><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">ProcessManifest</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File manifestOutputFile</font></span></li></ul><li><span style="line-height:1.6;font-size:10pt"><font face="courier new, monospace">AidlCompile</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File sourceOutputDir</font></span></li></ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">RenderscriptCompile</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File sourceOutputDir</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File resOutputDir</font></span></li></ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">MergeResources</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File outputDir</font></span></li></ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">MergeAssets</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File outputDir</font></span></li></ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">ProcessAndroidResources</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File manifestFile</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File resDir</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File assetsDir</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File sourceOutputDir</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File textSymbolOutputDir</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File packageOutputFile</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File proguardOutputFile</font></span></li></ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">GenerateBuildConfig</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File sourceOutputDir</font></span></li></ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">Dex</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File outputFolder</font></span></li></ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">PackageApplication</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File resourceFile</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File dexFile</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File javaResourceDir</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File jniDir</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File outputFile</font></span></li><ul><li><font face="arial, sans-serif">To change the final output file use "outputFile" on the variant object directly.</font></li></ul></ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">ZipAlign</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File inputFile</font></span></li><li><span style="font-size:10pt;line-height:1.6"><font face="courier new, monospace">File outputFile</font></span></li><ul><li><span style="font-size:10pt;line-height:1.6">To change the final output file use "outputFile" on the variant object directly.</span></li></ul></ul></ul></div><div><br>The API for each task type is limited due to both how Gradle works and how the Android plugin sets them up.</div><div>First, Gradle is meant to have the tasks be only configured for input/output location and possible optional flags. So here, the tasks only define (some of) the inputs/outputs.</div><div><br></div><div>Second, the input for most of those tasks is non-trivial, often coming from mixing values from the <i>sourceSets</i>, the <i>Build Types</i>, and the <i>Product Flavors</i>. To keep build files simple to read and understand, the goal is to let developers modify the build by tweak these objects through the DSL, rather than diving deep in the inputs and options of the tasks and changing them.</div><div><br></div><div>Also note, that except for the ZipAlign task type, all other types require setting up private data to make them work. This means it’s not possible to manually create new tasks of these types.<br> <br>This API is subject to change. In general the current API is around giving access to the outputs and inputs (when possible) of the tasks to add extra processing when required). Feedback is appreciated, especially around needs that may not have been foreseen.<br><br>For Gradle tasks (DefaultTask, JavaCompile, Copy, Zip), refer to the Gradle documentation.<br><br><h3><a name="TOC-BuildType-and-Product-Flavor-property-reference"></a>BuildType and Product Flavor property reference</h3></div><div>coming soon.</div><div><div>For Gradle tasks (DefaultTask, JavaCompile, Copy, Zip), refer to the Gradle documentation.<br><br><h3><a name="TOC-Using-sourceCompatibility-1.7"></a>Using sourceCompatibility 1.7</h3></div><div>With Android KitKat (buildToolsVersion 19) you can use the diamond operator, multi-catch, strings in switches, try with resources, etc. To do this, add the following to your build file:</div></div><div><br></div><div><div></div></div><div class="sites-codeblock sites-codesnippet-block"><div><div><code>android {</code></div><div><code><b>&nbsp; &nbsp; compileSdkVersion 19</b></code></div><div><code><b>&nbsp; &nbsp; buildToolsVersion "19.0.0"</b></code></div><div><br></div><div><code>&nbsp; &nbsp; defaultConfig {</code></div><div><code>&nbsp; &nbsp; &nbsp; &nbsp; minSdkVersion 7</code></div><div><code>&nbsp; &nbsp; &nbsp; &nbsp; targetSdkVersion 19</code></div><div><code>&nbsp; &nbsp; }</code></div><div><br></div><div><code>&nbsp; &nbsp; <b>compileOptions {</b></code></div><div><code><b>&nbsp; &nbsp; &nbsp; &nbsp; sourceCompatibility JavaVersion.VERSION_1_7</b></code></div><div><code><b>&nbsp; &nbsp; &nbsp; &nbsp; targetCompatibility JavaVersion.VERSION_1_7</b></code></div><div><code><b>&nbsp; &nbsp; }</b></code></div><div><code>}</code></div></div><div></div></div><div><br></div><div>Note that you can use <code>minSdkVersion</code> with a value earlier than 19, for all language features except try with resources. If you want to use try with resources, you will need to also use a <code>minSdkVersion</code> of 19.</div><div><br></div><div>You also need to make sure that Gradle is using version 1.7 or later of the JDK. (And version 0.6.1 or later of the Android Gradle plugin.)</div></div></td></tr></tbody></table>
</div> 
</div> 
<div id="sites-canvas-bottom-panel">
<div id="sites-attachments-container">
</div>
</div>
</div> 
</td> 
</tr>
</tbody></table> 
</div> 
</div> 
<div id="sites-chrome-footer-wrapper">
<div id="sites-chrome-footer-wrapper-inside">
<div id="sites-chrome-footer">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-subfooter"><div class="sites-subfooter-content"><br></div></div>
</div>
</div>
</div>
</div> 
</div> 
<div id="sites-chrome-adminfooter-container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sites-adminfooter" role="navigation"><p><a class="sites-system-link" href="https://www.google.com/a/UniversalLogin?service=jotspot&continue=http://sites.google.com/a/android.com/tools/tech-docs/new-build-system/user-guide">登录</a><span aria-hidden="true">|</span><a class="sites-system-link" href="http://tools.android.com/system/app/pages/recentChanges">最近的网站活动</a><span aria-hidden="true">|</span><a class="sites-system-link" href="http://tools.android.com/system/app/pages/reportAbuse" target="_blank">举报滥用行为</a><span aria-hidden="true">|</span><a class="sites-system-link" href="javascript:;" onclick="window.open(webspace.printUrl)">打印页面</a><span aria-hidden="true">|</span><span class="sites-system-link">由</span> <b class="powered-by"><a href="http://sites.google.com/">Google 协作平台强力驱动</a></b></p></div>
</div>
</div> 
</div> 
<div id="sites-chrome-onebar-footer">
</div>

<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('sjl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" src="./../source-others/jot_min_view__en.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    window.jstiming.load.tick('jl');
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
    
        sites.core.Analytics.createTracker();
        sites.core.Analytics.trackPageview();
      
  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
                    sites.Searchbox.initialize(
                        'sites-searchbox-search-button',
                        {"object":[]}['object'],
                        'search-site',
                        {"label":"Configure search options...","url":"/system/app/pages/admin/settings"});
                  </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
      gsites.HoverPopupMenu.createSiteDropdownMenus('sites-header-nav-dropdown', false);
    </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("2bd", "Project Info", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_2bd');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("09830101249604128", "Navigation", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_09830101249604128');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
            JOT_setupNav("42875732108950615", "Contrib info", false);
            JOT_addListener('titleChange', 'JOT_NAVIGATION_titleChange', 'COMP_42875732108950615');
          </script>
<script xmlns="http://www.w3.org/1999/xhtml">
                    window.onload = function() {
                      if (false) {
                        JOT_setMobilePreview();
                      }
                      var loadTimer = window.jstiming.load;
                      loadTimer.tick("ol");
                      loadTimer["name"] = "load," + webspace.page.type + ",user_page";
                      window.jstiming.report(loadTimer, {}, 'http://csi.gstatic.com/csi');
                    }
                  </script>

<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
        JOT_insertAnalyticsCode(false,
            false);
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    var maestroRunner = new gsites.pages.view.SitesMaestroRunner(
        webspace, "en");
    maestroRunner.initListeners();
    maestroRunner.installEditRender();
  </script>
<script xmlns="http://www.w3.org/1999/xhtml">
        JOT_insertTranslateCode('zh_CN', 'en');
      </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript" defer="true">
  //<![CDATA[
    // Decorate any fastUI buttons on the page with a class of 'goog-button'.
    if (webspace.user.hasWriteAccess) {
      JOT_decorateButtons();
    }

    // Fires delayed events.
    (function() {
      JOT_fullyLoaded = true;
      var delayedEvents = JOT_delayedEvents;
      for (var x = 0; x < delayedEvents.length; x++) {
        var event = delayedEvents[x];
        JOT_postEvent(event.eventName, event.eventSrc, event.payload);
      }
      JOT_delayedEvents = null;
      JOT_postEvent('pageLoaded');
    })();
 //]]>
</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="text/javascript">
    JOT_postEvent('decorateGvizCharts');
  </script>
<script type="text/javascript">
          JOT_setupNoticeManager();
        </script>
<script type="text/javascript">
          JOT_postEvent('renderPlus', null, 'sites-chrome-main');
        </script>
<div id="server-timer-div" style="display:none"> </div>
<script type="text/javascript">
          window.jstiming.load.tick('render');
          JOT_postEvent('usercontentrendered', this);
        </script>


</body></html>